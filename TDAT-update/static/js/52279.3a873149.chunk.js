"use strict";(self.webpackChunkegis_tdat=self.webpackChunkegis_tdat||[]).push([[35617,52279,54787,63391,97265],{54787:(t,e,i)=>{i.d(e,{c:()=>n,g:()=>o});var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function o(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}},79650:(t,e,i)=>{i.d(e,{a:()=>m,b:()=>$,c:()=>b,f:()=>x,u:()=>M});i(81806);var n=i(76460),o=i(15941),r=i(97467),s=i(34761),a=i(13191),l=i(20664),c=i(9392),h=i(2413),u=i(5568),d=i(44230),p=i(13927),f=i(95925),g=i(96190),_=i(75762);const v=()=>n.A.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");const y=class{constructor(){this.plane=(0,p.vt)(),this.origin=(0,c.vt)(),this.basis1=(0,c.vt)(),this.basis2=(0,c.vt)()}};function m(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G;return{plane:(0,p.vt)(t.plane),origin:(0,c.o8)(t.origin),basis1:(0,c.o8)(t.basis1),basis2:(0,c.o8)(t.basis2)}}function b(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m();return x(t.origin,t.basis1,t.basis2,e)}function x(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m();return(0,l.c)(n.origin,t),(0,l.c)(n.basis1,e),(0,l.c)(n.basis2,i),M(n),function(t,e){Math.abs((0,l.f)(t.basis1,t.basis2)/((0,l.l)(t.basis1)*(0,l.l)(t.basis2)))>1e-6&&v().warn(e,"Provided basis vectors are not perpendicular"),Math.abs((0,l.f)(t.basis1,Z(t)))>1e-6&&v().warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,l.f)(Z(t),t.origin)-t.plane[3])>1e-6&&v().warn(e,"Plane offset is not consistent with plane origin")}(n,"fromValues()"),n}function M(t){(0,p.mR)(t.basis2,t.basis1,t.origin,t.plane)}function w(t,e,i){t!==i&&b(t,i);const n=(0,l.h)(_.rq.get(),Z(t),e);return(0,l.g)(i.origin,i.origin,n),i.plane[3]-=e,i}function T(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m();const i=(t[2]-t[0])/2,n=(t[3]-t[1])/2;return(0,l.i)(e.origin,t[0]+i,t[1]+n,0),(0,l.i)(e.basis1,i,0,0),(0,l.i)(e.basis2,0,n,0),(0,p.fA)(0,0,1,0,e.plane),e}function A(t,e,i){return!!(0,p.Ui)(t.plane,e,i)&&V(t,i)}function E(t,e,i){const n=z.get();L(t,e,n,z.get());let r=Number.POSITIVE_INFINITY;for(const s of H){const a=O(t,s,D.get()),c=_.rq.get();if((0,p.T7)(n,a,c)){const t=(0,l.o)(_.rq.get(),e.origin,c),n=Math.abs((0,o.XM)((0,l.f)(e.direction,t)));n<r&&(r=n,(0,l.c)(i,c))}}return r===Number.POSITIVE_INFINITY?S(t,e,i):i}function S(t,e,i){if(A(t,e,i))return i;const n=z.get(),o=z.get();L(t,e,n,o);let r=Number.POSITIVE_INFINITY;for(const s of H){const a=O(t,s,D.get()),c=_.rq.get();if((0,p.gv)(n,a,c)){const t=(0,f.kb)(e,c);if(!(0,p.Tj)(o,c))continue;t<r&&(r=t,(0,l.c)(i,c))}}return k(t,e.origin)<r&&P(t,e.origin,i),i}function P(t,e,i){const n=(0,p._I)(t.plane,e,_.rq.get()),o=(0,d.H6)(I(t,t.basis1),n,-1,1,_.rq.get()),r=(0,d.H6)(I(t,t.basis2),n,-1,1,_.rq.get());return(0,l.d)(i,(0,l.g)(_.rq.get(),o,r),t.origin),i}function C(t,e,i){const{origin:n,basis1:o,basis2:r}=t,s=(0,l.d)(_.rq.get(),e,n),a=(0,g.gr)(o,s),c=(0,g.gr)(r,s),h=(0,g.gr)(Z(t),s);return(0,l.i)(i,a,c,h)}function k(t,e){const i=C(t,e,_.rq.get()),{basis1:n,basis2:o}=t,r=(0,l.l)(n),s=(0,l.l)(o),a=Math.max(Math.abs(i[0])-r,0),c=Math.max(Math.abs(i[1])-s,0),h=i[2];return a*a+c*c+h*h}function R(t,e){const i=-t.plane[3];return(0,g.gr)(Z(t),e)-i}function Z(t){return(0,p.Qj)(t.plane)}function V(t,e){const i=(0,l.d)(_.rq.get(),e,t.origin),n=(0,l.k)(t.basis1),o=(0,l.k)(t.basis2),r=(0,l.f)(t.basis1,i),s=(0,l.f)(t.basis2,i);return-r-n<0&&r-n<0&&-s-o<0&&s-o<0}function I(t,e){const i=D.get();return(0,l.c)(i.origin,t.origin),(0,l.c)(i.vector,e),i}function O(t,e,i){const{basis1:n,basis2:o,origin:r}=t,s=(0,l.h)(_.rq.get(),n,e.origin[0]),a=(0,l.h)(_.rq.get(),o,e.origin[1]);(0,l.g)(i.origin,s,a),(0,l.g)(i.origin,i.origin,r);const c=(0,l.h)(_.rq.get(),n,e.direction[0]),h=(0,l.h)(_.rq.get(),o,e.direction[1]);return(0,l.h)(i.vector,(0,l.g)(c,c,h),2),i}function L(t,e,i,n){const o=Z(t);(0,p.mR)(o,e.direction,e.origin,i),(0,p.mR)((0,p.Qj)(i),o,e.origin,n)}const G={plane:(0,p.vt)(),origin:(0,c.fA)(0,0,0),basis1:(0,c.fA)(1,0,0),basis2:(0,c.fA)(0,1,0)},z=new r.I(p.vt),D=new r.I(d.vt),N=(0,c.vt)(),U=new r.I((()=>m())),H=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],F=(0,a.vt)(),q=(0,a.vt)(),$=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:y,altitudeAt:R,axisAt:function(t,e,i,n){return function(t,e,i){switch(e){case u._.X:(0,l.c)(i,t.basis1),(0,l.n)(i,i);break;case u._.Y:(0,l.c)(i,t.basis2),(0,l.n)(i,i);break;case u._.Z:(0,l.c)(i,Z(t))}return i}(t,i,n)},cameraFrustumCoverage:function(t,e){return(e-t)/e},closestPoint:S,closestPointOnSilhouette:E,copy:b,copyWithoutVerify:function(t,e){(0,l.c)(e.origin,t.origin),(0,l.c)(e.basis1,t.basis1),(0,l.c)(e.basis2,t.basis2),(0,p.C)(e.plane,t.plane)},create:m,distance:function(t,e){return Math.sqrt(k(t,e))},distance2:k,distanceToSilhouette:function(t,e){let i=Number.NEGATIVE_INFINITY;for(const n of H){const o=O(t,n,D.get()),r=(0,d.kb)(o,e);r>i&&(i=r)}return Math.sqrt(i)},elevate:w,equals:function(t,e){return(0,l.p)(t.basis1,e.basis1)&&(0,l.p)(t.basis2,e.basis2)&&(0,l.p)(t.origin,e.origin)},extrusionContainsPoint:function(t,e){return(0,p.Tj)(t.plane,e)&&V(t,e)},fromAABoundingRect:T,fromValues:x,getExtent:function(t,e){const i=t.basis1[0],n=t.basis2[1],[o,r]=t.origin;return(0,h.fA)(o-i,r-n,o+i,r+n,e)},intersectRay:A,intersectRayClosestSilhouette:function(t,e,i){if(A(t,e,i))return i;const n=E(t,e,_.rq.get());return(0,l.g)(i,e.origin,(0,l.h)(_.rq.get(),e.direction,(0,l.j)(e.origin,n)/(0,l.l)(e.direction))),i},normal:Z,projectPoint:P,projectPointLocal:C,rotate:function(t,e,i,n){return t!==n&&b(t,n),(0,s.$0)(q,e,i),(0,l.t)(n.basis1,t.basis1,q),(0,l.t)(n.basis2,t.basis2,q),M(n),n},setAltitudeAt:function(t,e,i,n){const o=R(t,e),r=(0,l.h)(N,Z(t),i-o);return(0,l.g)(n,e,r),n},setExtent:function(t,e,i){return T(e,i),w(i,R(t,t.origin),i),i},transform:function(t,e,i){return t!==i&&b(t,i),(0,s.B8)(F,e),(0,s.mg)(F,F),(0,l.t)(i.basis1,t.basis1,F),(0,l.t)(i.basis2,t.basis2,F),(0,l.t)((0,p.Qj)(i.plane),(0,p.Qj)(t.plane),F),(0,l.t)(i.origin,t.origin,e),(0,p.mP)(i.plane,i.plane,i.origin),i},up:G,updateUnboundedPlane:M,wrap:function(t,e,i){const n=U.get();return n.origin=t,n.basis1=e,n.basis2=i,n.plane=(0,p.LV)(0,0,0,0),M(n),n}},Symbol.toStringTag,{value:"Module"}))},60767:(t,e,i)=>{i.d(e,{A:()=>r});var n=i(99486),o=i(99702);class r{constructor(t){this._observable=new o.I,this._set=new Set(t)}get size(){return(0,n.gc)(this._observable),this._set.size}add(t){const e=this._set.size;return this._set.add(t),this._set.size!==e&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(t){const e=this._set.delete(t);return e&&this._observable.notify(),e}entries(){return(0,n.gc)(this._observable),this._set.entries()}forEach(t,e){(0,n.gc)(this._observable),this._set.forEach(((i,n)=>t.call(e,i,n,this)),e)}has(t){return(0,n.gc)(this._observable),this._set.has(t)}keys(){return(0,n.gc)(this._observable),this._set.keys()}values(){return(0,n.gc)(this._observable),this._set.values()}[Symbol.iterator](){return(0,n.gc)(this._observable),this._set[Symbol.iterator]()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}}},60008:(t,e,i)=>{i.d(e,{A6:()=>_,B8:()=>p,Xd:()=>h,Xr:()=>f,Yc:()=>R,hZ:()=>y,lw:()=>u,t2:()=>C,x8:()=>c});var n=i(44680),o=i(4336),r=i(9392),s=i(53494),a=i(20664),l=i(43047);function c(t,e,i){i*=.5;const n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t}function h(t,e){const i=2*Math.acos(e[3]),n=Math.sin(i/2);return n>(0,s.FD)()?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),i}function u(t,e,i){const n=e[0],o=e[1],r=e[2],s=e[3],a=i[0],l=i[1],c=i[2],h=i[3];return t[0]=n*h+s*a+o*c-r*l,t[1]=o*h+s*l+r*a-n*c,t[2]=r*h+s*c+n*l-o*a,t[3]=s*h-n*a-o*l-r*c,t}function d(t,e,i,n){const o=e[0],r=e[1],a=e[2],l=e[3];let c,h,u,d,p,f=i[0],g=i[1],_=i[2],v=i[3];return h=o*f+r*g+a*_+l*v,h<0&&(h=-h,f=-f,g=-g,_=-_,v=-v),1-h>(0,s.FD)()?(c=Math.acos(h),u=Math.sin(c),d=Math.sin((1-n)*c)/u,p=Math.sin(n*c)/u):(d=1-n,p=n),t[0]=d*o+p*f,t[1]=d*r+p*g,t[2]=d*a+p*_,t[3]=d*l+p*v,t}function p(t,e){const i=e[0],n=e[1],o=e[2],r=e[3],s=i*i+n*n+o*o+r*r,a=s?1/s:0;return t[0]=-i*a,t[1]=-n*a,t[2]=-o*a,t[3]=r*a,t}function f(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function g(t,e){const i=e[0]+e[4]+e[8];let n;if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);const o=(i+1)%3,r=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*o+o]-e[3*r+r]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*o+r]-e[3*r+o])*n,t[o]=(e[3*o+i]+e[3*i+o])*n,t[r]=(e[3*r+i]+e[3*i+r])*n}return t}function _(t,e,i,n){const o=.5*Math.PI/180;e*=o,i*=o,n*=o;const r=Math.sin(e),s=Math.cos(e),a=Math.sin(i),l=Math.cos(i),c=Math.sin(n),h=Math.cos(n);return t[0]=r*l*h-s*a*c,t[1]=s*a*h+r*l*c,t[2]=s*l*c-r*a*h,t[3]=s*l*h+r*a*c,t}const v=l.c,y=l.s,m=l.g,b=u,x=l.d,M=l.h,w=l.l,T=l.j,A=T,E=l.b,S=E,P=l.n,C=l.a,k=l.e;function R(t,e,i){const n=(0,a.f)(e,i);return n<-.999999?((0,a.e)(Z,V,e),(0,a.G)(Z)<1e-6&&(0,a.e)(Z,I,e),(0,a.n)(Z,Z),c(t,Z,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):((0,a.e)(Z,e,i),t[0]=Z[0],t[1]=Z[1],t[2]=Z[2],t[3]=1+n,P(t,t))}const Z=(0,r.vt)(),V=(0,r.fA)(1,0,0),I=(0,r.fA)(0,1,0);const O=(0,o.vt)(),L=(0,o.vt)();const G=(0,n.vt)();Object.freeze(Object.defineProperty({__proto__:null,add:m,calculateW:function(t,e){const i=e[0],n=e[1],o=e[2];return t[0]=i,t[1]=n,t[2]=o,t[3]=Math.sqrt(Math.abs(1-i*i-n*n-o*o)),t},conjugate:f,copy:v,dot:M,equals:k,exactEquals:C,fromEuler:_,fromMat3:g,getAxisAngle:h,identity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},invert:p,len:A,length:T,lerp:w,mul:b,multiply:u,normalize:P,random:function(t){const e=s.Ov,i=e(),n=e(),o=e(),r=Math.sqrt(1-i),a=Math.sqrt(i);return t[0]=r*Math.sin(2*Math.PI*n),t[1]=r*Math.cos(2*Math.PI*n),t[2]=a*Math.sin(2*Math.PI*o),t[3]=a*Math.cos(2*Math.PI*o),t},rotateX:function(t,e,i){i*=.5;const n=e[0],o=e[1],r=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=n*l+s*a,t[1]=o*l+r*a,t[2]=r*l-o*a,t[3]=s*l-n*a,t},rotateY:function(t,e,i){i*=.5;const n=e[0],o=e[1],r=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=n*l-r*a,t[1]=o*l+s*a,t[2]=r*l+n*a,t[3]=s*l-o*a,t},rotateZ:function(t,e,i){i*=.5;const n=e[0],o=e[1],r=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=n*l+o*a,t[1]=o*l-n*a,t[2]=r*l+s*a,t[3]=s*l-r*a,t},rotationTo:R,scale:x,set:y,setAxes:function(t,e,i,n){const o=G;return o[0]=i[0],o[3]=i[1],o[6]=i[2],o[1]=n[0],o[4]=n[1],o[7]=n[2],o[2]=-e[0],o[5]=-e[1],o[8]=-e[2],P(t,g(t,o))},setAxisAngle:c,slerp:d,sqlerp:function(t,e,i,n,o,r){return d(O,e,o,r),d(L,i,n,r),d(t,O,L,2*r*(1-r)),t},sqrLen:S,squaredLength:E,str:function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}},Symbol.toStringTag,{value:"Module"}))},35617:(t,e,i)=>{i.r(e),i.d(e,{hydratedAdapter:()=>l});var n=i(76797),o=i(66388),r=i(19247),s=i(65215),a=i(23701);const l={convertToGEGeometry:function(t,e){if(null==e)return null;let i="cache"in e?e.cache._geVersion:void 0;return null==i&&(i=t.convertJSONToGeometry(e),"cache"in e&&(e.cache._geVersion=i)),i},exportPoint:function(t,e,i){const n=t.hasZ(e),o=t.hasM(e),s=new r.A({x:t.getPointX(e),y:t.getPointY(e),spatialReference:i});return n&&(s.z=t.getPointZ(e)),o&&(s.m=t.getPointM(e)),s.cache._geVersion=e,s},exportPolygon:function(t,e,i){const n=new s.A({rings:t.exportPaths(e),hasZ:t.hasZ(e),hasM:t.hasM(e),spatialReference:i});return n.cache._geVersion=e,n},exportPolyline:function(t,e,i){const n=new a.A({paths:t.exportPaths(e),hasZ:t.hasZ(e),hasM:t.hasM(e),spatialReference:i});return n.cache._geVersion=e,n},exportMultipoint:function(t,e,i){const n=new o.A({hasZ:t.hasZ(e),hasM:t.hasM(e),points:t.exportPoints(e),spatialReference:i});return n.cache._geVersion=e,n},exportExtent:function(t,e,i){const o=t.hasZ(e),r=t.hasM(e),s=new n.A({xmin:t.getXMin(e),ymin:t.getYMin(e),xmax:t.getXMax(e),ymax:t.getYMax(e),spatialReference:i});if(o){const i=t.getZExtent(e);s.zmin=i.vmin,s.zmax=i.vmax}if(r){const i=t.getMExtent(e);s.mmin=i.vmin,s.mmax=i.vmax}return s.cache._geVersion=e,s}}},63391:(t,e,i)=>{i.r(e),i.d(e,{buffer:()=>C,changeDefaultSpatialReferenceTolerance:()=>K,clearDefaultSpatialReferenceTolerance:()=>j,clip:()=>c,contains:()=>u,convexHull:()=>w,crosses:()=>d,cut:()=>h,densify:()=>D,difference:()=>T,disjoint:()=>y,distance:()=>p,equals:()=>f,extendedSpatialReferenceInfo:()=>l,flipHorizontal:()=>L,flipVertical:()=>G,generalize:()=>z,geodesicArea:()=>F,geodesicBuffer:()=>k,geodesicDensify:()=>N,geodesicLength:()=>q,intersect:()=>E,intersectLinesToPoints:()=>$,intersects:()=>g,isSimple:()=>x,nearestCoordinate:()=>R,nearestVertex:()=>Z,nearestVertices:()=>V,offset:()=>P,overlaps:()=>m,planarArea:()=>U,planarLength:()=>H,relate:()=>b,rotate:()=>O,simplify:()=>M,symmetricDifference:()=>A,touches:()=>_,union:()=>S,within:()=>v});i(35238);var n=i(40565),o=i(52612),r=i(35617),s=i(13312);function a(t){const e=Array.isArray(t)?t[0].spatialReference:t.spatialReference;return e?(0,n.PZ)(s.A,e):s.A.WGS84}function l(t){return o.G.extendedSpatialReferenceInfo(t)}function c(t,e){return o.G.clip(r.hydratedAdapter,a(t),t,e)}function h(t,e){return o.G.cut(r.hydratedAdapter,a(t),t,e)}function u(t,e){return o.G.contains(r.hydratedAdapter,a(t),t,e)}function d(t,e){return o.G.crosses(r.hydratedAdapter,a(t),t,e)}function p(t,e,i){return o.G.distance(r.hydratedAdapter,a(t),t,e,i)}function f(t,e){return o.G.equals(r.hydratedAdapter,a(t),t,e)}function g(t,e){return o.G.intersects(r.hydratedAdapter,a(t),t,e)}function _(t,e){return o.G.touches(r.hydratedAdapter,a(t),t,e)}function v(t,e){return o.G.within(r.hydratedAdapter,a(t),t,e)}function y(t,e){return o.G.disjoint(r.hydratedAdapter,a(t),t,e)}function m(t,e){return o.G.overlaps(r.hydratedAdapter,a(t),t,e)}function b(t,e,i){return o.G.relate(r.hydratedAdapter,a(t),t,e,i)}function x(t){return o.G.isSimple(r.hydratedAdapter,a(t),t)}function M(t){return o.G.simplify(r.hydratedAdapter,a(t),t)}function w(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return o.G.convexHull(r.hydratedAdapter,a(t),t,e)}function T(t,e){return o.G.difference(r.hydratedAdapter,a(t),t,e)}function A(t,e){return o.G.symmetricDifference(r.hydratedAdapter,a(t),t,e)}function E(t,e){return o.G.intersect(r.hydratedAdapter,a(t),t,e)}function S(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return o.G.union(r.hydratedAdapter,a(t),t,e)}function P(t,e,i,n,s,l){return o.G.offset(r.hydratedAdapter,a(t),t,e,i,n,s,l)}function C(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return o.G.buffer(r.hydratedAdapter,a(t),t,e,i,n)}function k(t,e,i,n,s,l){return o.G.geodesicBuffer(r.hydratedAdapter,a(t),t,e,i,n,s,l)}function R(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return o.G.nearestCoordinate(r.hydratedAdapter,a(t),t,e,i)}function Z(t,e){return o.G.nearestVertex(r.hydratedAdapter,a(t),t,e)}function V(t,e,i,n){return o.G.nearestVertices(r.hydratedAdapter,a(t),t,e,i,n)}function I(t){return"xmin"in t?"center"in t?t.center:null:"x"in t?t:"extent"in t?t.extent?.center??null:null}function O(t,e,i){if(null==t)throw new W;const n=t.spatialReference;if(null==(i=i??I(t)))throw new W;const r=t.constructor.fromJSON(o.G.rotate(t,e,i));return r.spatialReference=n,r}function L(t,e){if(null==t)throw new W;const i=t.spatialReference;if(null==(e=e??I(t)))throw new W;const n=t.constructor.fromJSON(o.G.flipHorizontal(t,e));return n.spatialReference=i,n}function G(t,e){if(null==t)throw new W;const i=t.spatialReference;if(null==(e=e??I(t)))throw new W;const n=t.constructor.fromJSON(o.G.flipVertical(t,e));return n.spatialReference=i,n}function z(t,e,i,n){return o.G.generalize(r.hydratedAdapter,a(t),t,e,i,n)}function D(t,e,i){return o.G.densify(r.hydratedAdapter,a(t),t,e,i)}function N(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return o.G.geodesicDensify(r.hydratedAdapter,a(t),t,e,i,n)}function U(t,e){return o.G.planarArea(r.hydratedAdapter,a(t),t,e)}function H(t,e){return o.G.planarLength(r.hydratedAdapter,a(t),t,e)}function F(t,e,i){return o.G.geodesicArea(r.hydratedAdapter,a(t),t,e,i)}function q(t,e,i){return o.G.geodesicLength(r.hydratedAdapter,a(t),t,e,i)}function $(t,e){return o.G.intersectLinesToPoints(r.hydratedAdapter,a(t),t,e)}function K(t,e){o.G.changeDefaultSpatialReferenceTolerance(t,e)}function j(t){o.G.clearDefaultSpatialReferenceTolerance(t)}class W extends Error{constructor(){super("Illegal Argument Exception")}}},64232:(t,e,i)=>{i.d(e,{g:()=>s});var n=i(9392),o=i(26346),r=i(45308);function s(t,e,i,n){if((0,o.canProjectWithoutEngine)(t.spatialReference,i)){a[0]=t.x,a[1]=t.y;const o=t.z;return a[2]=o??n??0,(0,r.projectBuffer)(a,t.spatialReference,0,e,i,0)}const s=(0,o.tryProjectWithZConversion)(t,i);return!!s&&(e[0]=s?.x,e[1]=s?.y,e[2]=s?.z??n??0,!0)}const a=(0,n.vt)()},14487:(t,e,i)=>{i.d(e,{F:()=>r});i(26346);var n=i(13312),o=i(64232);function r(t,e,i,n,r){return!(null==e||null==n||t.length<2)&&(s.x=t[0],s.y=t[1],s.z=t[2],s.spatialReference=e,(0,o.g)(s,i,n,r))}const s=(0,i(18117).T)(0,0,0,n.A.WGS84)},98510:(t,e,i)=>{i.d(e,{Y0:()=>c,lO:()=>h});var n=i(34111),o=i(13312),r=i(80963);const s=new o.A(n.fv),a=new o.A(n.FY),l=new o.A(n.LJ),c=new o.A(n.Ro);function h(t){const e=u.get(t);if(e)return e;let i=s;if(t)if(t===a)i=a;else if(t===l)i=l;else{const e=t.wkid,n=t.latestWkid;if(null!=e||null!=n)(0,r.tl)(e)||(0,r.tl)(n)?i=a:((0,r.ZL)(e)||(0,r.ZL)(n))&&(i=l);else{const e=t.wkt2??t.wkt;if(e){const t=e.toUpperCase();t===d?i=a:t===p&&(i=l)}}}return u.set(t,i),i}const u=new Map,d=a.wkt.toUpperCase(),p=l.wkt.toUpperCase()},14894:(t,e,i)=>{i.d(e,{A:()=>u});var n,o=i(35143),r=i(69098),s=i(42553),a=i(46053),l=(i(81806),i(76460),i(47249),i(6409)),c=i(85842);let h=n=class extends((0,r.O)(s.oY)){constructor(t){super(t),this.type="georeferenced",this.origin=null}};h.absolute=new n,(0,o._)([(0,l.e)({georeferenced:"georeferenced"},{readOnly:!0})],h.prototype,"type",void 0),(0,o._)([(0,a.MZ)({type:[Number],nonNullable:!1,json:{write:!0}})],h.prototype,"origin",void 0),h=n=(0,o._)([(0,c.$)("esri.geometry.support.MeshGeoreferencedVertexSpace")],h);const u=h},5845:(t,e,i)=>{i.d(e,{A:()=>u});var n=i(35143),o=i(69098),r=i(42553),s=i(46053),a=(i(81806),i(76460),i(47249),i(6409)),l=i(85842),c=i(9392);let h=class extends((0,o.O)(r.oY)){constructor(t){super(t),this.type="local",this.origin=(0,c.vt)()}};(0,n._)([(0,a.e)({local:"local"},{readOnly:!0})],h.prototype,"type",void 0),(0,n._)([(0,s.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],h.prototype,"origin",void 0),h=(0,n._)([(0,l.$)("esri.geometry.support.MeshLocalVertexSpace")],h);const u=h},32186:(t,e,i)=>{i.d(e,{A:()=>_});var n,o=i(35143),r=i(42553),s=i(46053),a=(i(81806),i(76460),i(47249),i(85842)),l=i(34761),c=i(13191),h=i(60008),u=i(4336),d=i(9392),p=i(52896);let f=n=class extends r.oY{constructor(t){super(t),this.translation=(0,d.vt)(),this.rotationAxis=(0,d.ci)(p.up),this.rotationAngle=0,this.scale=(0,d.fA)(1,1,1)}get rotation(){return(0,p.i4)(this.rotationAxis,this.rotationAngle)}set rotation(t){this.rotationAxis=(0,d.o8)((0,p.yo)(t)),this.rotationAngle=(0,p.g7)(t)}get localMatrix(){const t=(0,c.vt)();return(0,h.x8)(g,(0,p.yo)(this.rotation),(0,p.$I)(this.rotation)),(0,l.o1)(t,g,this.translation,this.scale),t}get localMatrixInverse(){return(0,l.B8)((0,c.vt)(),this.localMatrix)}equals(t){return this===t||null!=t&&(0,l.t2)(this.localMatrix,t.localMatrix)}clone(){const t={translation:(0,d.o8)(this.translation),rotationAxis:(0,d.o8)(this.rotationAxis),rotationAngle:this.rotationAngle,scale:(0,d.o8)(this.scale)};return new n(t)}};(0,o._)([(0,s.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"translation",void 0),(0,o._)([(0,s.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"rotationAxis",void 0),(0,o._)([(0,s.MZ)({type:Number,nonNullable:!0,json:{write:!0}})],f.prototype,"rotationAngle",void 0),(0,o._)([(0,s.MZ)({type:[Number],nonNullable:!0,json:{write:!0}})],f.prototype,"scale",void 0),(0,o._)([(0,s.MZ)()],f.prototype,"rotation",null),(0,o._)([(0,s.MZ)()],f.prototype,"localMatrix",null),(0,o._)([(0,s.MZ)()],f.prototype,"localMatrixInverse",null),f=n=(0,o._)([(0,a.$)("esri.geometry.support.MeshTransform")],f);const g=(0,u.vt)(),_=f},52896:(t,e,i)=>{i.d(e,{$I:()=>_,AU:()=>p,g7:()=>g,i4:()=>h,ui:()=>u,up:()=>y,vt:()=>c,yo:()=>f});var n=i(15941),o=i(34761),r=i(60008),s=i(4336),a=i(20664),l=i(9392);function c(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y;return[t[0],t[1],t[2],t[3]]}function h(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c();return(0,a.c)(i,t),i[3]=e,i}function u(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c();const i=(0,o.l)(m,t);return v(e,(0,n.KJ)((0,r.Xd)(e,i))),e}function d(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c();return(0,r.x8)(m,t,_(t)),(0,r.x8)(b,e,_(e)),(0,r.lw)(m,b,m),v(i,(0,n.KJ)((0,r.Xd)(i,m)))}function p(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c();return h(l.Cw,t,x),h(l.JP,e,M),h(l.Cb,i,w),d(x,M,x),d(x,w,n),n}function f(t){return t}function g(t){return t[3]}function _(t){return(0,n.kU)(t[3])}function v(t,e){return t[3]=e,t}const y=[0,0,1,0],m=(0,s.vt)(),b=(0,s.vt)(),x=(c(),c()),M=c(),w=c()},7137:(t,e,i)=>{i.d(e,{TT:()=>f,Xn:()=>x,Zj:()=>y,_3:()=>b,l1:()=>_,qy:()=>g,vN:()=>m});i(35238);var n=i(50076),o=i(31633),r=i(40565),s=i(63885),a=i(80963),l=i(13312),c=i(23701),h=i(65215);i(19247);function u(t){if(!t)return null;const e=t.wkid;if(e)return s.uw[e];const i=t.wkt2??t.wkt;return i?function(t){const e=s._f.exec(t);if(!e||2!==e.length)return null;const i=e[1].split(",");if(!i||i.length<3)return null;const n=parseFloat(i[1]),o=parseFloat(i[2]);return isNaN(n)||isNaN(o)?null:{a:n,f:0===o?0:1/o}}(i):null}function d(t){const e=u(t);if(function(t){return null!=t&&"b"in t&&"eSq"in t&&"radius"in t}(e))return e;const i=e.a*(1-e.f);return Object.assign(e,{b:i,eSq:1-(i/e.a)**2,radius:(2*e.a+i)/3,densificationRatio:1e4/((2*e.a+i)/3)})}function p(t,e,i){const{a:n,eSq:o}=d(i),r=Math.sqrt(o),a=Math.sin(e[1]*s.eh),l=n*e[0]*s.eh;let c;return c=o>0?n*((1-o)*(a/(1-o*(a*a))-1/(2*r)*Math.log((1-r*a)/(1+r*a))))*.5:n*a,t[0]=l,t[1]=c,t}function f(t){return(0,a.EA)(t)&&!!u(t)}function g(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"square-meters";if(t.some((t=>!f(t.spatialReference))))throw new n.A("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let n=0;n<t.length;n++){const e=t[n],o=e.spatialReference,{radius:r,densificationRatio:s}=d(o),a=r*s;i.push(v(e,a))}const r=[],s=[0,0],a=[0,0];for(let n=0;n<i.length;n++){const{rings:t,spatialReference:l}=i[n];let c=0;for(let e=0;e<t.length;e++){const i=t[e];p(s,i[0],l),p(a,i[i.length-1],l);let n=a[0]*s[1]-s[0]*a[1];for(let t=0;t<i.length-1;t++)p(s,i[t+1],l),p(a,i[t],l),n+=a[0]*s[1]-s[0]*a[1];c+=n}c=(0,o.oU)(c,"square-meters",e),r.push(c/-2)}return r}function _(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"meters";if(!t)throw new n.A("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(t.some((t=>!f(t.spatialReference))))throw new n.A("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let n=0;n<t.length;n++){const r=t[n],{spatialReference:s}=r,a="polyline"===r.type?r.paths:r.rings;let l=0;for(let t=0;t<a.length;t++){const e=a[t];let i=0;for(let t=1;t<e.length;t++){const n=e[t-1][0],o=e[t][0],r=e[t-1][1],a=e[t][1];if(r!==a||n!==o){const t=new y;b(t,[n,r],[o,a],s),i+=t.distance}}l+=i}l=(0,o.oU)(l,"meters",e),i.push(l)}return i}function v(t,e){if("polyline"!==t.type&&"polygon"!==t.type)throw new n.A("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const{spatialReference:i}=t;if(!f(i))throw new n.A("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");const o="polyline"===t.type?t.paths:t.rings,s=[],a=[0,0],u=new y;for(const n of o){const t=[];s.push(t),t.push([n[0][0],n[0][1]]);let o,r,l=n[0][0],c=n[0][1];for(let s=0;s<n.length-1;s++){if(o=n[s+1][0],r=n[s+1][1],l===o&&c===r)continue;const h=[l,c];b(u,[l,c],[o,r],i);const{azimuth:d,distance:p}=u,f=p/e;if(f>1){for(let n=1;n<=f-1;n++)m(a,h,d,n*e,i),t.push(a.slice());m(a,h,d,(p+Math.floor(f-1)*e)/2,i),t.push(a.slice())}m(a,h,d,p,i),t.push(a.slice()),l=a[0],c=a[1]}}const d=(0,r.PZ)(l.A,i);return"polyline"===t.type?new c.A({paths:s,spatialReference:d}):new h.A({rings:s,spatialReference:d})}class y{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this.distance=t,this.azimuth=e,this.reverseAzimuth=i}}function m(t,e,i,n,o){const r=e[0],a=e[1],l=r*s.eh,c=a*s.eh,h=(i??0)*s.eh,{a:u,b:p,f:f}=d(o),g=Math.sin(h),_=Math.cos(h),v=(1-f)*Math.tan(c),y=1/Math.sqrt(1+v*v),m=v*y,b=Math.atan2(v,_),x=y*g,M=x*x,w=1-M,T=w*(u*u-p*p)/(p*p),A=1+T/16384*(4096+T*(T*(320-175*T)-768)),E=T/1024*(256+T*(T*(74-47*T)-128));let S,P,C,k,R=n/(p*A),Z=2*Math.PI;for(;Math.abs(R-Z)>1e-12;)C=Math.cos(2*b+R),S=Math.sin(R),P=Math.cos(R),k=E*S*(C+E/4*(P*(2*C*C-1)-E/6*C*(4*S*S-3)*(4*C*C-3))),Z=R,R=n/(p*A)+k;const V=m*S-y*P*_,I=Math.atan2(m*P+y*S*_,(1-f)*Math.sqrt(M+V*V)),O=Math.atan2(S*g,y*P-m*S*_),L=f/16*w*(4+f*(4-3*w)),G=I/s.eh,z=(l+(O-(1-L)*f*x*(R+L*S*(C+L*P*(2*C*C-1)))))/s.eh;return t[0]=z,t[1]=G,t}function b(t,e,i,n){const o=e[0]*s.eh,r=e[1]*s.eh,a=i[0]*s.eh,l=i[1]*s.eh,{a:c,b:h,f:u,radius:p}=d(n),f=a-o,g=Math.atan((1-u)*Math.tan(r)),_=Math.atan((1-u)*Math.tan(l)),v=Math.sin(g),y=Math.cos(g),m=Math.sin(_),b=Math.cos(_);let x,M,w,T,A,E,S,P,C,k,R=1e3,Z=f;do{if(S=Math.sin(Z),P=Math.cos(Z),w=Math.sqrt(b*S*(b*S)+(y*m-v*b*P)*(y*m-v*b*P)),0===w)return t.distance=0,t.azimuth=void 0,t.reverseAzimuth=void 0,t;A=v*m+y*b*P,E=Math.atan2(w,A),C=y*b*S/w,M=1-C*C,T=A-2*v*m/M,isNaN(T)&&(T=0),k=u/16*M*(4+u*(4-3*M)),x=Z,Z=f+(1-k)*u*C*(E+k*w*(T+k*A*(2*T*T-1)))}while(Math.abs(Z-x)>1e-12&&--R>0);if(0===R){const e=p,i=Math.acos(Math.sin(r)*Math.sin(l)+Math.cos(r)*Math.cos(l)*Math.cos(a-o))*e,n=a-o,c=Math.sin(n)*Math.cos(l),h=Math.cos(r)*Math.sin(l)-Math.sin(r)*Math.cos(l)*Math.cos(n),u=Math.atan2(c,h);return t.azimuth=u/s.eh,t.distance=i,t.reverseAzimuth=void 0,t}const V=M*(c*c-h*h)/(h*h),I=V/1024*(256+V*(V*(74-47*V)-128)),O=h*(1+V/16384*(4096+V*(V*(320-175*V)-768)))*(E-I*w*(T+I/4*(A*(2*T*T-1)-I/6*T*(4*w*w-3)*(4*T*T-3)))),L=Math.atan2(b*Math.sin(Z),y*m-v*b*Math.cos(Z)),G=Math.atan2(y*Math.sin(Z),y*m*Math.cos(Z)-v*b);return t.azimuth=L/s.eh,t.distance=O,t.reverseAzimuth=G/s.eh,t}function x(t){return f(t)?t:(0,a.K8)(t)?l.A.WGS84:null}},44230:(t,e,i)=>{i.d(e,{Cr:()=>c,H6:()=>d,_I:()=>u,kb:()=>h,vt:()=>l});var n=i(15941),o=i(97467),r=i(20664),s=i(9392),a=i(75762);function l(t){return t?{origin:(0,s.o8)(t.origin),vector:(0,s.o8)(t.vector)}:{origin:(0,s.vt)(),vector:(0,s.vt)()}}function c(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l();return(0,r.c)(i.origin,t),(0,r.d)(i.vector,e,t),i}function h(t,e){const i=(0,r.d)(a.rq.get(),e,t.origin),o=(0,r.f)(t.vector,i),s=(0,r.f)(t.vector,t.vector),l=(0,n.qE)(o/s,0,1),c=(0,r.d)(a.rq.get(),(0,r.h)(a.rq.get(),t.vector,l),i);return(0,r.f)(c,c)}function u(t,e,i){return d(t,e,0,1,i)}function d(t,e,i,o,s){const{vector:l,origin:c}=t,h=(0,r.d)(a.rq.get(),e,c),u=(0,r.f)(l,h)/(0,r.k)(l);return(0,r.h)(s,l,(0,n.qE)(u,i,o)),(0,r.g)(s,s,t.origin)}(0,s.vt)(),(0,s.vt)(),new o.I((()=>l()))},99773:(t,e,i)=>{i.d(e,{CK:()=>u,Hq:()=>h,MW:()=>d,TE:()=>p,yJ:()=>f});var n=i(63241),o=i(76460),r=i(20664),s=i(19247),a=i(14894),l=i(5845);function c(){return o.A.getLogger("esri.geometry.Mesh")}function h(t){return null!=t.origin}function u(t){return h(t.vertexSpace)}function d(t,e){if(!h(t))return null;const[i,n,o]=t.origin;return new s.A({x:i,y:n,z:o,spatialReference:e})}function p(t,e){const{x:i,y:o,z:r,spatialReference:s}=t,h=[i,o,r??0];return void 0!==e?.geographic&&((0,n.io)(c(),"option: geographic",{replacement:"Use the `vertexSpace` option instead.",version:"4.29",warnOnce:!0}),e.vertexSpace&&c().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")),"local"===(e?.vertexSpace??function(t){return null==t?void 0:t?"local":"georeferenced"}(e?.geographic)??function(t){return t.isGeographic||t.isWebMercator?"local":"georeferenced"}(s))?new l.A({origin:h}):new a.A({origin:h})}function f(t,e){return t.type===e.type&&(t.origin===e.origin||null!=t.origin&&null!=e.origin&&(0,r.p)(t.origin,e.origin))}},45097:(t,e,i)=>{i.d(e,{Fm:()=>l,Q7:()=>c});var n=i(97467),o=i(20664),r=i(9392),s=i(44230);i(75762);function a(t){return t?{p0:(0,r.o8)(t.p0),p1:(0,r.o8)(t.p1),p2:(0,r.o8)(t.p2)}:{p0:(0,r.vt)(),p1:(0,r.vt)(),p2:(0,r.vt)()}}function l(t,e,i){const n=e[0]-t[0],o=e[1]-t[1],r=i[0]-t[0],s=i[1]-t[1];return.5*Math.abs(n*s-o*r)}function c(t,e,i){return(0,o.d)(h,e,t),(0,o.d)(u,i,t),.5*(0,o.l)((0,o.e)(h,h,u))}new n.I(s.vt),new n.I((()=>a()));const h=(0,r.vt)(),u=(0,r.vt)()},63733:(t,e,i)=>{i.d(e,{A:()=>p});var n=i(35143),o=i(46053),r=(i(81806),i(76460),i(47249),i(85842)),s=i(5364),a=i(25515),l=i(65624),c=i(5682),h=i(64519),u=i(731);let d=class extends((0,l.dM)((0,c.j)(a.A))){constructor(t){super(t),this.elevationInfo=null,this.graphics=new h.Y,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(t){return this.graphics.add(t),this}addMany(t){return this.graphics.addMany(t),this}removeAll(){return this.graphics.removeAll(),this}remove(t){this.graphics.remove(t)}removeMany(t){this.graphics.removeMany(t)}on(t,e){return super.on(t,e)}graphicChanged(t){this.emit("graphic-update",t)}};(0,n._)([(0,o.MZ)({type:u.A})],d.prototype,"elevationInfo",void 0),(0,n._)([(0,o.MZ)((0,s.C)(h.Y,"graphics"))],d.prototype,"graphics",void 0),(0,n._)([(0,o.MZ)({type:["show","hide"]})],d.prototype,"listMode",void 0),(0,n._)([(0,o.MZ)()],d.prototype,"screenSizePerspectiveEnabled",void 0),(0,n._)([(0,o.MZ)({readOnly:!0})],d.prototype,"type",void 0),(0,n._)([(0,o.MZ)({constructOnly:!0})],d.prototype,"internal",void 0),d=(0,n._)([(0,r.$)("esri.layers.GraphicsLayer")],d);const p=d},74e3:(t,e,i)=>{i.d(e,{CI:()=>r,fk:()=>s});i(81806);var n=i(15941),o=i(80963);function r(t,e){return t===e||null!=t&&null!=e&&(0,o.aI)(t.spatialReference,e.spatialReference)&&t.x===e.x&&t.y===e.y&&t.z===e.z&&t.m===e.m}function s(t,e,i){return t===e||null!=t&&null!=e&&(0,o.aI)(t.spatialReference,e.spatialReference)&&(0,n.Sp)(t.x,e.x,i)&&(0,n.Sp)(t.y,e.y,i)&&(0,n.Sp)(t.z??0,e.z??0,i)&&(0,n.Sp)(t.m??0,e.m??0,i)}},18117:(t,e,i)=>{function n(t,e,i,n){return{x:t,y:e,z:i,hasZ:null!=i,hasM:!1,spatialReference:n,type:"point"}}function o(t,e,i,n,o){t.x=e,t.y=i,t.z=n,t.hasZ=null!=n,t.spatialReference=o}i.d(e,{J:()=>o,T:()=>n})},32535:(t,e,i)=>{i.d(e,{EL:()=>r});i(35238),i(39356),i(81806),i(53084),i(78393),i(19902);var n=i(18117);i(13312);function o(t){return"declaredClass"in t}function r(t,e){if(!t)return null;let i;if(o(t)){if(null==e)return t.clone();if(o(e))return e.copy(t)}return null!=e?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=void 0,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=(0,n.T)(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}},4955:(t,e,i)=>{function n(t,e){return e?"xoffset"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):"yoffset"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function o(t,e){return"number"==typeof t?t:t?.stops?.length?function(t){let e=0,i=0;for(let n=0;n<t.length;n++){const o=t[n].size;"number"==typeof o&&(e+=o,i++)}return e/i}(t.stops):e}function r(t,e){if(!e)return t;const i=e.filter((t=>"size"===t.type)).map((e=>{const{maxSize:i,minSize:n}=e;return(o(i,t)+o(n,t))/2}));let n=0;const r=i.length;if(0===r)return t;for(let o=0;o<r;o++)n+=i[o];const s=Math.floor(n/r);return Math.max(s,t)}function s(t){const e=t?.renderer,i=t?.pointerType,o="touch"===i?9:6;if(!e)return o;const s="visualVariables"in e?r(o,e.visualVariables):o;if("simple"===e.type)return n(s,e.symbol);if("unique-value"===e.type){let t=s;return e.uniqueValueInfos?.forEach((e=>{t=n(t,e.symbol)})),t}if("class-breaks"===e.type){let t=s;return e.classBreakInfos.forEach((e=>{t=n(t,e.symbol)})),t}return"dot-density"===e.type||e.type,s}i.d(e,{o:()=>s})},12482:(t,e,i)=>{i.d(e,{$7:()=>y,B:()=>v,Fo:()=>g,M7:()=>x,Q5:()=>_,XF:()=>b,bK:()=>s,bh:()=>c,id:()=>d,ky:()=>l,qt:()=>M,tW:()=>m,w7:()=>a,wS:()=>p,xS:()=>f});var n=i(31633),o=i(59097);function r(t){return t?M:w}function s(t,e){return null!=e?e:r(t)}function a(t,e){return function(t,e){return e?.mode?e.mode:r(t).mode}(null==t||(t.hasZ??!1),e)}function l(t){const e=h(t);return a(t.geometry,e)}function c(t){const e=h(t),i=a(t.geometry,e),n=null!=e&&"on-the-ground"!==i?x(e):0,o=e?.featureExpressionInfo;return{mode:i,offset:n,featureExpressionInfo:o}}function h(t){return t.layer&&"elevationInfo"in t.layer?t.layer.elevationInfo:null}function u(t,e){if(!t?.offset)return 0;const{offset:i,unit:o}=t;if("decimal-degrees"===o)return 0;const r="unknown"!==o&&o?o:"meters",s=(0,n.mq)(e);return s?(0,n.oU)(i,r,s):0}function d(t,e,i){if(!i?.mode)return;const n=t.hasZ?t.z:0,o=u(i,t.spatialReference);switch(i.mode){case"absolute-height":return n-o;case"on-the-ground":return 0;case"relative-to-ground":return n-((e.elevationProvider.getElevation(t.x,t.y,n,t.spatialReference,"ground")??0)+o);case"relative-to-scene":return n-((e.elevationProvider.getElevation(t.x,t.y,n,t.spatialReference,"scene")??0)+o)}}function p(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return g(t,e.x,e.y,e.hasZ?e.z:0,e.spatialReference,i,n)}function f(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return g(t,e[0],e[1],e.length>2?e[2]:0,i,n,o)}function g(t,e,i,n,o,r){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if(null==r)return;const a=null!=s?s.mode:"absolute-height";if("on-the-ground"===a)return 0;const{absoluteZ:l}=_(e,i,n,o,t,r);return function(t,e,i,n,o,r,s,a){const l=u(s,o);switch(a){case"absolute-height":return t-l;case"relative-to-ground":return t-((r.elevationProvider.getElevation(e,i,n,o,"ground")??0)+l);case"relative-to-scene":return t-((r.elevationProvider.getElevation(e,i,n,o,"scene")??0)+l)}}(l,e,i,n,o,t,s,a)}function _(t,e,i,n,o,r){const s=u(r,n);switch(r.mode){case"absolute-height":return{absoluteZ:i+s,elevation:0};case"on-the-ground":{const i=o.elevationProvider.getElevation(t,e,0,n,"ground")??0;return{absoluteZ:i,elevation:i}}case"relative-to-ground":{const r=o.elevationProvider.getElevation(t,e,i,n,"ground")??0;return{absoluteZ:i+r+s,elevation:r}}case"relative-to-scene":{const r=o.elevationProvider.getElevation(t,e,i,n,"scene")??0;return{absoluteZ:i+r+s,elevation:r}}}}function v(t,e,i){return i&&i.mode!==e?`${t} only support ${e} elevation mode`:null}function y(t,e,i){return i?.mode===e?`${t} do not support ${e} elevation mode`:null}function m(t,e){return null!=e?.featureExpressionInfo&&"0"!==e.featureExpressionInfo.expression?`${t} do not support featureExpressionInfo`:null}function b(t,e){e&&t.warn(".elevationInfo=",e)}function x(t){return(t?.offset??0)*(0,o.Ao)(t?.unit)}const M={mode:"absolute-height",offset:0},w={mode:"on-the-ground",offset:null}},65453:(t,e,i)=>{i.d(e,{ControlPointsTransformTool:()=>Kl,TransformTool:()=>uc});var n,o=i(35143),r=(i(35238),i(39356)),s=i(54901),a=i(30726),l=i(68134),c=i(46053),h=(i(81806),i(76460),i(47249),i(85842)),u=(i(95444),i(76931)),d=i(40565),p=i(19555),f=i(72745),g=i(9392),_=i(28808),v=i(18117),y=i(12482);function m(t,e,i){return b(t,e,i)}function b(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,g.fA)(t,e,i)}function x(t,e,i){return(0,g.fA)(t,e,i)}function M(t){const[e,i,n]=t;return t.length>3?[e,i,n,t[3]]:[e,i,n]}function w(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:b();return n[0]=t.x,n[1]=t.y,n[2]=t.z??0,null==e||("2d"===e.type?n[2]=0:n[2]=(0,y.wS)(e,t,i,y.qt)??0),n}!function(t){t[t.NONE=0]="NONE",t[t.TARGET=1]="TARGET"}(n||(n={}));(0,v.T)(0,0,0,null);var T=i(69539),A=i(42553);let E=class extends A.oY{constructor(){super(...arguments),this.enabled=!0}};(0,o._)([(0,c.MZ)({type:Boolean})],E.prototype,"enabled",void 0),E=(0,o._)([(0,h.$)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],E);let S=class extends A.oY{constructor(t){super(t),this.lineSnapper=new E,this.parallelLineSnapper=new E,this.rightAngleSnapper=new E,this.rightAngleTriangleSnapper=new E,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new T.A([255,127,0]),this.orangeTransparent=new T.A([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};(0,o._)([(0,c.MZ)({type:E,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"lineSnapper",void 0),(0,o._)([(0,c.MZ)({type:E,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"parallelLineSnapper",void 0),(0,o._)([(0,c.MZ)({type:E,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"rightAngleSnapper",void 0),(0,o._)([(0,c.MZ)({type:E,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"rightAngleTriangleSnapper",void 0),(0,o._)([(0,c.MZ)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],S.prototype,"shortLineThreshold",void 0),(0,o._)([(0,c.MZ)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],S.prototype,"distance",void 0),(0,o._)([(0,c.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"pointThreshold",void 0),(0,o._)([(0,c.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"intersectionParallelLineThreshold",void 0),(0,o._)([(0,c.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"parallelLineThreshold",void 0),(0,o._)([(0,c.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],S.prototype,"verticalLineThresholdMeters",void 0),(0,o._)([(0,c.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"touchSensitivityMultiplier",void 0),(0,o._)([(0,c.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"pointOnLineThreshold",void 0),(0,o._)([(0,c.MZ)({type:T.A,nonNullable:!0})],S.prototype,"orange",void 0),(0,o._)([(0,c.MZ)({type:T.A,nonNullable:!0})],S.prototype,"orangeTransparent",void 0),(0,o._)([(0,c.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"lineHintWidthReference",void 0),(0,o._)([(0,c.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"lineHintWidthTarget",void 0),(0,o._)([(0,c.MZ)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],S.prototype,"lineHintFadedExtensions",void 0),(0,o._)([(0,c.MZ)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"parallelLineHintWidth",void 0),(0,o._)([(0,c.MZ)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],S.prototype,"parallelLineHintLength",void 0),(0,o._)([(0,c.MZ)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],S.prototype,"parallelLineHintOffset",void 0),(0,o._)([(0,c.MZ)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],S.prototype,"rightAngleHintSize",void 0),(0,o._)([(0,c.MZ)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],S.prototype,"rightAngleHintOutlineSize",void 0),(0,o._)([(0,c.MZ)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],S.prototype,"satisfiesConstraintScreenThreshold",void 0),S=(0,o._)([(0,h.$)("esri.views.interactive.snapping.Settings.Defaults")],S);const P=new S;var C,k=i(20664);!function(t){t[t.FEATURE=1]="FEATURE",t[t.SELF=2]="SELF",t[t.ALL=3]="ALL"}(C||(C={}));class R{constructor(t,e){this.isDraped=t,this.domain=e}}class Z extends R{constructor(t,e){super(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.ALL),this.intersectionPoint=t}equals(t){return t instanceof Z&&(0,k.p)(this.intersectionPoint,t.intersectionPoint)}}class V extends R{constructor(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:C.ALL,r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(n,o),this.type=t,this.lineStart=e,this.lineEnd=i,this.fadeLeft=r,this.fadeRight=s}equals(t){return t instanceof V&&this.type===t.type&&(0,k.p)(this.lineStart,t.lineStart)&&(0,k.p)(this.lineEnd,t.lineEnd)&&this.fadeLeft===t.fadeLeft&&this.fadeRight===t.fadeRight}get length(){return(0,k.j)(this.lineStart,this.lineEnd)}}class I extends R{constructor(t,e,i){super(i,arguments.length>3&&void 0!==arguments[3]?arguments[3]:C.ALL),this.lineStart=t,this.lineEnd=e}equals(t){return t instanceof I&&(0,k.p)(this.lineStart,t.lineStart)&&(0,k.p)(this.lineEnd,t.lineEnd)}}class O extends R{constructor(t,e,i){super(e,i),this.point=t}equals(t){return t instanceof O&&(0,k.p)(this.point,t.point)}}class L extends R{constructor(t,e,i,n){super(n,arguments.length>4&&void 0!==arguments[4]?arguments[4]:C.ALL),this.previousVertex=t,this.centerVertex=e,this.nextVertex=i}equals(t){return t instanceof L&&(0,k.p)(this.previousVertex,t.previousVertex)&&(0,k.p)(this.centerVertex,t.centerVertex)&&(0,k.p)(this.nextVertex,t.nextVertex)}}class G{draw(t,e){const i=function(t){const e=[];for(const i of t){let t=!0;for(const n of e)if(i.equals(n)){t=!1;break}t&&e.push(i)}return e}(t),n=this.sortUniqueHints(i),o=[];for(const r of n)r instanceof Z&&o.push(this.visualizeIntersectionPoint(r,e)),r instanceof V&&o.push(this.visualizeLine(r,e)),r instanceof I&&o.push(this.visualizeParallelSign(r,e)),r instanceof L&&o.push(this.visualizeRightAngleQuad(r,e)),r instanceof O&&o.push(this.visualizePoint(r,e));return(0,s.vE)(o)}sortUniqueHints(t){return t}}var z=i(19247),D=i(23701),N=i(13312),U=i(89465),H=i(76940),F=i(7246);class q extends G{constructor(t){super(),this._graphicsLayer=t,this._symbolPairingsByType=new Map}visualizeIntersectionPoint(t,e){return this._visualizeSnappingIndicator(new z.A({x:t.intersectionPoint[0],y:t.intersectionPoint[1],spatialReference:e.spatialReference}),this._getOrCreateSymbol("intersectionPoint",e.view.effectiveTheme.accentColor))}visualizePoint(t,e){return this._visualizeSnappingIndicator(new z.A({x:t.point[0],y:t.point[1],spatialReference:e.spatialReference}),this._getOrCreateSymbol("point",e.view.effectiveTheme.accentColor))}visualizeLine(t,e){return this._visualizeSnappingIndicator(new D.A({paths:[[[...t.lineStart],[...t.lineEnd]]],spatialReference:(0,d.PZ)(N.A,e.spatialReference)}),this._getOrCreateSymbol("line",e.view.effectiveTheme.accentColor))}visualizeParallelSign(t,e){return this._visualizeSnappingIndicator(new D.A({paths:[[[...t.lineStart],[...t.lineEnd]]],spatialReference:(0,d.PZ)(N.A,e.spatialReference)}),this._getOrCreateSymbol("parallelSign",e.view.effectiveTheme.accentColor))}visualizeRightAngleQuad(t,e){const i=(0,f.vt)(),n=(0,f.vt)(),o=(0,g.vt)();(0,p.Re)(i,t.centerVertex,t.previousVertex),(0,p.Re)(n,t.nextVertex,t.previousVertex),(0,p.$A)(o,i,n);const r="rightAngleQuad"+(o[2]<0?45:225);return this._visualizeSnappingIndicator(new D.A({paths:[[[...t.previousVertex],[...t.centerVertex],[...t.nextVertex]]],spatialReference:(0,d.PZ)(N.A,e.spatialReference)}),this._getOrCreateSymbol(r,e.view.effectiveTheme.accentColor))}_visualizeSnappingIndicator(t,e){const i=new r.default({geometry:t,symbol:e});return this._graphicsLayer.add(i),(0,s.hA)((()=>{this._graphicsLayer.remove(i)}))}_getOrCreateSymbol(t,e){const i=this._symbolPairingsByType;return i.get(t)?.color!==e&&i.set(t,{color:e,symbol:$(t,e)}),i.get(t).symbol}}function $(t,e){const i=[...e.toRgb(),255*e.a];switch(t){case"point":return new H.A({outline:{width:.5,color:[0,0,0,1]},size:10,color:e});case"intersectionPoint":return new H.A({outline:new F.A({width:1.5,color:e}),size:15,color:[0,0,0,0]});case"line":return new U.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:_.uT.Butt,joinStyle:_.wd.Round,miterLimit:10,width:(0,u.PN)(P.lineHintWidthTarget),color:i}]}}});case"parallelSign":return new U.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,1.5],[7,1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:i}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,-1.5],[7,-1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:i}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}});case"rightAngleQuad45":case"rightAngleQuad225":{const n="rightAngleQuad45"===t?45:225;return new U.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:.5,y:.5,z:0},anchorPointUnits:"Relative",size:(0,u.PN)(P.rightAngleHintSize),rotation:n,markerPlacement:{type:"CIMMarkerPlacementOnVertices",placePerPart:!0,angleToLine:!0,placeOnEndPoints:!1},frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[5,-5],[-5,-5],[-5,5],[5,5],[5,-5]]]},symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:(0,u.PN)(P.rightAngleHintOutlineSize),color:i},{type:"CIMSolidFill",enable:!0,color:[...e.toRgb(),255*e.a*.4]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}})}}}const K=new U.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[3.75,3.75],lineDashEnding:"HalfPattern",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:1.6,color:[255,255,255,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:2,color:[0,0,0,255]}]}}}),j=new H.A({style:"circle",size:6,color:[127,127,127,1],outline:{color:[50,50,50],width:1}}),W=new H.A({style:"circle",size:6,color:[255,127,0,1],outline:{color:[50,50,50],width:1}});var B,Y,X=i(91967),Q=i(94643),J=i(19451);!function(t){t[t.NeverApplied=0]="NeverApplied",t[t.Applied=1]="Applied",t[t.Undone=2]="Undone"}(B||(B={})),function(t){t.UndoRedoUpdating="UndoRedoUpdating",t.UndoInvalidError="UndoInvalidError",t.RedoInvalidError="RedoInvalidError",t.ApplyInvalidError="ApplyInvalidError"}(Y||(Y={}));const tt={[Y.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[Y.UndoInvalidError]:"There are no items to Undo",[Y.RedoInvalidError]:"There are no items to Redo",[Y.ApplyInvalidError]:"Cannot apply an item that is already applied"};class et extends Error{constructor(){super(tt[Y.UndoRedoUpdating]),this.type="undo-redo-updating-error"}}class it extends Error{constructor(){super(tt[Y.UndoInvalidError]),this.type="undo-redo-undo-error"}}class nt extends Error{constructor(){super(tt[Y.RedoInvalidError]),this.type="undo-redo-redo-error"}}class ot extends Error{constructor(){super(tt[Y.ApplyInvalidError]),this.type="undo-redo-apply-error"}}var rt;!function(t){t[t.Apply=0]="Apply",t[t.Undo=1]="Undo",t[t.Redo=2]="Redo"}(rt||(rt={}));let st=class extends X.A{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=B.NeverApplied}get canUndo(){return this.status===B.Applied}get canRedo(){return this.status===B.Undone}async executeUndoRedoOperation(t){switch(t){case rt.Apply:if(this.status!==B.NeverApplied)throw new ot;return await this.apply(),void(this.status=B.Applied);case rt.Undo:if(this.status!==B.Applied)throw new it;return await this.undo(),void(this.status=B.Undone);case rt.Redo:if(this.status!==B.Undone)throw new it;return await this.redo(),void(this.status=B.Applied)}}};(0,o._)([(0,c.MZ)()],st.prototype,"name",void 0),(0,o._)([(0,c.MZ)()],st.prototype,"tag",void 0),st=(0,o._)([(0,h.$)("esri.undoredo.UndoableOperation")],st);let at=class extends X.A{constructor(){super(...arguments),this._stack=new Q.A,this._stackPosition=-1,this._updatingHandles=new J.U}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach((t=>t.destroy()))}_drainStack(){this._stack.drain((t=>t.destroy())),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new it;if(this.updating)throw new et;const t=this._stack.getItemAt(this._stackPosition);t&&await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(rt.Undo),--this._stackPosition,t.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new nt;if(this.updating)throw new et;const t=this._stack.getItemAt(this._stackPosition+1);if(!t)throw new nt;await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(rt.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(t){if(this.updating)throw new et;await this._updatingHandles.addPromise((async()=>{t.status===B.NeverApplied&&await t.executeUndoRedoOperation(rt.Apply),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach((t=>t.destroy())),this._stackPosition=-1)})())}async add(t){if(this.updating)throw new et;await this._updatingHandles.addPromise((async()=>{t.status===B.NeverApplied&&await t.executeUndoRedoOperation(rt.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.updating&&!e)return;await(0,l.whenOnce)((()=>!this.updating));const i=new Q.A;for(let n=0;n<this._stack.length;n++){const e=this._stack.getItemAt(n);e&&(e.tag===t?(e.destroy(),n===this._stackPosition&&(this._stackPosition=i.length-1)):i.push(e))}this._stack=i,this._stackPosition>i.length-1&&(this._stackPosition=i.length-1)}async clear(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.updating&&!t)throw new et;await(0,l.whenOnce)((()=>!this.updating)),this._drainStack()}};(0,o._)([(0,c.MZ)()],at.prototype,"_stack",void 0),(0,o._)([(0,c.MZ)()],at.prototype,"_stackPosition",void 0),(0,o._)([(0,c.MZ)()],at.prototype,"updating",null),(0,o._)([(0,c.MZ)({readOnly:!0})],at.prototype,"canUndo",null),(0,o._)([(0,c.MZ)({readOnly:!0})],at.prototype,"hasUndo",null),(0,o._)([(0,c.MZ)({readOnly:!0})],at.prototype,"canRedo",null),(0,o._)([(0,c.MZ)({readOnly:!0})],at.prototype,"hasRedo",null),at=(0,o._)([(0,h.$)("esri.UndoRedo")],at);var lt=i(98773),ct=i(54099),ht=i(50076),ut=i(7724),dt=i(50265);function pt(){return(0,ut.i)()}function ft(t,e){const i=[];t=(t=(t=t.replaceAll(/[\u00B0\u00BA]/g,"^")).replaceAll("\u2032","'")).replaceAll("\u2033",'"');const n=gt(e);return ut.c.dmsToGeog(n,1,[t],i)?new z.A(i[0][0],i[0][1],e||N.A.WGS84):null}function gt(t){let e=null;if(t||(t=N.A.WGS84),t.wkid){if(e=ut.P.geogcs(t.wkid),!e)throw new ht.A("coordinate-formatter:invalid-spatial-reference","wkid is not valid")}else{if(!t.wkt2&&!t.wkt)throw new ht.A("coordinate-formatter:invalid-spatial-reference","wkid and wkt are missing");if(e=ut.P.fromString(ut.a.PE_TYPE_GEOGCS,t.wkt2||t.wkt),!e)throw new ht.A("coordinate-formatter:invalid-spatial-reference","wkt is not valid")}return e}var _t=i(63733),vt=i(74e3);class yt{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}}var mt,bt=i(18690),xt=i(53084),Mt=i(31633),wt=i(34111),Tt=i(65215),At=i(7137),Et=i(45417),St=i(85996);let Pt=mt=class extends Tt.A{constructor(t){super(t),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}initialize(){const t=this.center,e=this.numberOfPoints;if(this.hasZ=t?.hasZ??!1,0!==this.rings.length||!t)return;const i=(0,Mt.oU)(this.radius,this.radiusUnit,"meters"),n=t.spatialReference;let o,r="geographic";if(n.isWebMercator?r="webMercator":(null!=(n.wkid&&St.A[n.wkid])||(n.wkt2||n.wkt)&&(0,Mt.x1)(n.wkt2||n.wkt))&&(r="projected"),this.geodesic){let n;switch(r){case"webMercator":n=(0,Et.ci)(t);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":n=t}o=this._createGeodesicCircle(n,i,e),"webMercator"===r&&(o=(0,Et.Gh)(o))}else{let n;"webMercator"===r||"projected"===r?n=i/(0,Mt.Ao)(t.spatialReference):"geographic"===r&&(n=(0,Mt.vl)(i,"meters",(0,wt.tO)(t.spatialReference).radius)),o=this._createPlanarCircle(t,n,e)}this.spatialReference=o.spatialReference,this.addRing(o.rings[0])}clone(){const{center:t,numberOfPoints:e,radius:i,radiusUnit:n,geodesic:o}=this;return new mt({center:t?.clone(),numberOfPoints:e,radius:i,radiusUnit:n,geodesic:o})}_createGeodesicCircle(t,e,i){let n=0;const o=[];for(;n<360;){const r=[0,0],s=[t.x,t.y];(0,At.vN)(r,s,n,e,N.A.WGS84),this.hasZ&&r.push(t.z),o.push(r),n+=360/i}return o.push(o[0]),new Tt.A({rings:[o]})}_createPlanarCircle(t,e,i){const n=[],o=2*Math.PI/i;for(let r=0;r<i;++r){const i=o*r,s=[t.x+Math.cos(-i)*e,t.y+Math.sin(-i)*e];this.hasZ&&s.push(t.z),n.push(s)}return n.push(n[0]),new Tt.A({spatialReference:t.spatialReference,rings:[n]})}};(0,o._)([(0,c.MZ)({type:z.A})],Pt.prototype,"center",void 0),(0,o._)([(0,c.MZ)()],Pt.prototype,"geodesic",void 0),(0,o._)([(0,c.MZ)()],Pt.prototype,"numberOfPoints",void 0),(0,o._)([(0,c.MZ)()],Pt.prototype,"radius",void 0),(0,o._)([(0,c.MZ)()],Pt.prototype,"radiusUnit",void 0),Pt=mt=(0,o._)([(0,h.$)("esri.geometry.Circle")],Pt);const Ct=Pt;var kt=i(63391),Rt=i(5262),Zt=i(80963),Vt=i(94967),It=i(99809),Ot=i(60008),Lt=i(4336),Gt=i(5568);function zt(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return null!=i?[t,e,i]:[t,e]}function Dt(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return null!=i?{x:t,y:e,z:i}:{x:t,y:e}}class Nt{constructor(t){this.spatialReference=t}mapToLocalMultiple(t){return t.map((t=>this.mapToLocal(t))).filter(bt.Ru)}get doUnnormalization(){return!1}}class Ut extends Nt{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(e),this._defaultZ=i,this.transform=(0,It.vt)(),this.transformInv=(0,It.vt)(),this.transform=(0,It.o8)(t),(0,Vt.B8)(this.transformInv,this.transform)}makeMapPoint(t,e){return zt(t,e,this._defaultZ)}mapToLocal(t){return Dt(this.transform[0]*t[0]+this.transform[2]*t[1]+this.transform[4],this.transform[1]*t[0]+this.transform[3]*t[1]+this.transform[5])}localToMap(t){return zt(this.transformInv[0]*t.x+this.transformInv[2]*t.y+this.transformInv[4],this.transformInv[1]*t.x+this.transformInv[3]*t.y+this.transformInv[5],this._defaultZ)}}class Ht extends Nt{constructor(t,e){super(t.spatialReference),this.view=t,this.defaultZ=null,this.pWS=(0,g.vt)(),this.tangentFrameUpWS=(0,g.vt)(),this.tangentFrameRightWS=(0,g.vt)(),this.tangentFrameForwardWS=(0,g.vt)(),this.localFrameRightWS=(0,g.vt)(),this.localFrameUpWS=(0,g.vt)(),this.worldToLocalTransform=(0,Lt.vt)(),this.localToWorldTransform=(0,Lt.vt)(),this.scale=1,this.scale=t.resolution,this.referenceMapPoint=e,this.defaultZ=e.hasZ?e.z:null;const i=t.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Gt._.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Gt._.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Gt._.Z,this.tangentFrameForwardWS);const n=(0,g.vt)();(0,k.h)(n,this.tangentFrameForwardWS,(0,k.f)(i,this.tangentFrameForwardWS)),(0,k.d)(this.localFrameRightWS,i,n),(0,k.n)(this.localFrameRightWS,this.localFrameRightWS),(0,k.e)(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),(0,Ot.Yc)(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),(0,Ot.B8)(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(t,e){return zt(t,e,this.defaultZ)}mapToLocal(t){const e=(0,g.vt)();this.view.renderCoordsHelper.toRenderCoords(new z.A({x:t[0],y:t[1],spatialReference:this.spatialReference}),e),(0,k.w)(e,e,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(e,new z.A({spatialReference:this.view.spatialReference}));return null!=i?Dt(i.x/this.scale,i.y/this.scale):null}localToMap(t){const e=(0,g.vt)();this.view.renderCoordsHelper.toRenderCoords(new z.A({x:t.x*this.scale,y:t.y*this.scale,spatialReference:this.spatialReference}),e),(0,k.w)(e,e,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(e,new z.A({spatialReference:this.view.spatialReference}));return null!=i?zt(i.x,i.y,this.defaultZ):null}}var Ft=i(66388);function qt(t,e){const i=new z.A({x:t[0],y:t[1],spatialReference:e});return t.length>2&&(i.z=t[2]),i}function $t(t,e,i){const n=new D.A({paths:t,spatialReference:e});return i&&(0,Rt._7)(n),n}function Kt(t,e,i){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const o=(0,xt.o8)(t);o.forEach((t=>{const e=t[0],i=t[t.length-1];(0,bt.aI)(e,i)&&1!==t.length||t.push(t[0])}));let r=new Tt.A({rings:o,spatialReference:e});return r.rings.forEach((t=>{(0,Rt.$3)(t)||t.reverse()})),i&&(0,Rt._7)(r),n&&r.isSelfIntersecting&&(0,Zt.fn)(e)&&(r=(0,kt.simplify)(r)),r}function jt(t,e,i){const n=e.mapToLocalMultiple(t),o=[],r={x:n[0].x,y:n[0].y},s=n[1].x,a=n[1].y,l=Math.round(s-r.x),c=Math.round(a-r.y),h=Math.max(Math.abs(l),Math.abs(c));if(i){const t={x:r.x+h,y:r.y+h},e={x:r.x-h,y:r.y-h};o.push(Dt(t.x,e.y),Dt(e.x,e.y),Dt(e.x,t.y),Dt(t.x,t.y))}else{const t={x:l>0?r.x+h:r.x-h,y:c>0?r.y+h:r.y-h};o.push(Dt(r.x,r.y),Dt(t.x,r.y),Dt(t.x,t.y),Dt(r.x,t.y))}return Wt(Kt([o.map((t=>e.localToMap(t))).filter(bt.Ru)],e.spatialReference,e.doUnnormalization,!0),o,e)}function Wt(t,e,i){const n=Bt(e[3],e[2],i),o=Bt(e[1],e[2],i),r=Bt(e[0],e[1],i),s=Bt(e[0],e[3],i);return{geometry:t,midpoints:null!=n&&null!=o&&null!=r&&null!=s?{top:n,right:o,bottom:r,left:s}:null}}function Bt(t,e,i){Xt[0]=t.x,Xt[1]=t.y,Xt[2]=0,Qt[0]=e.x,Qt[1]=e.y,Qt[2]=0,(0,k.m)(Xt,Xt,Qt,.5),Yt.x=Xt[0],Yt.y=Qt[1],Yt.z=Qt[2];const n=i.localToMap(Yt);return null!=n?qt(n,i.spatialReference):null}const Yt=Dt(0,0,0),Xt=(0,g.vt)(),Qt=(0,g.vt)();function Jt(t,e,i,n){const o=e.mapToLocalMultiple(t);let r=null,s=null;if(i)r=o[0],s=o[1];else{const t=o[0],e=o[1],i=Math.round(e.x-t.x),n=Math.round(e.y-t.y),a=Math.max(Math.abs(i),Math.abs(n));r=Dt(i>0?t.x+a/2:t.x-a/2,n>0?t.y+a/2:t.y-a/2),s=Dt(Math.abs(i)>Math.abs(n)?r.x-a/2:r.x,Math.abs(i)>Math.abs(n)?r.y:r.y-a/2)}const a=e.localToMap(r),l=e.localToMap(s);if(null==a||null==l)return null;e.doUnnormalization&&(0,Rt.JM)([[a,l]],e.spatialReference);const c=qt(a,e.spatialReference),h=qt(l,e.spatialReference),u=(0,Mt.GA)(e.spatialReference);let d=0;if((0,Zt.fn)(e.spatialReference))d=u*(0,kt.distance)(c,h,null);else{const t=r.x-s.x,e=r.y-s.y;d=u*Math.sqrt(t*t+e*e)*(n||1)}const p=new Ct({center:c,radius:d,radiusUnit:"meters",spatialReference:e.spatialReference});return{geometry:Kt(p.rings,p.spatialReference,!1),center:c,edge:h}}var te=i(24648);function ee(t,e){switch(t){case"point":case"multipoint":return"point";case"polyline":return function(t){return(null!=t&&"polyline"===t.type&&t.paths.length?t.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex"}(e);case"polygon":return function(t){const e=null!=t&&"polygon"===t.type&&t.rings.length?t.rings[0].length:0;return e<3?"polylineZeroVertices":e<4?"polygonOneVertex":"polygonTwoVertices"}(e);default:return}}const ie=20,ne=1,oe=.1,re=(0,g.vt)();var se,ae=i(14487),le=i(15941),ce=i(43047),he=i(55855),ue=i(63885),de=i(13927),pe=i(78315),fe=i(94966),ge=i(53494);function _e(t,e){return t[0]*e[1]-t[1]*e[0]}!function(t){t[t.RAY=0]="RAY",t[t.LINE=1]="LINE"}(se||(se={}));const ve=1e-6,ye=(0,f.vt)(),me=(0,f.vt)(),be=(0,f.vt)(),xe=(0,f.vt)();function Me(t,e,i){let{start:n,end:o,type:r}=t;const s=[],a=(0,p.Re)(De,o,n),l=(0,p.Re)(Ne,n,e),c=(0,p.m3)(a),h=2*(0,p.Om)(a,l),u=h*h-4*c*((0,p.m3)(l)-i*i);if(0===u){const t=-h/(2*c);(r===Ge.PLANE||t>=0)&&s.push((0,p.Ln)((0,f.vt)(),n,a,t))}else if(u>0){const t=Math.sqrt(u),e=(-h+t)/(2*c);(r===Ge.PLANE||e>=0)&&s.push((0,p.Ln)((0,f.vt)(),n,a,e));const i=(-h-t)/(2*c);(r===Ge.PLANE||i>=0)&&s.push((0,p.Ln)((0,f.vt)(),n,a,i))}return s}function we(t,e){const i=t.start,n=t.end,o=(0,p.Re)(De,n,i),r=(0,k.i)(He,-o[1],o[0],0),s=e.start,a=e.end,l=(0,k.a)(Fe,a,s),c=(0,k.f)(l,r),h=(0,k.i)(qe,i[0],i[1],0),u=(0,k.a)($e,h,s),d=(0,k.f)(u,r),f=(0,ge.FD)();if(Math.abs(c)<f)return Math.abs(d),[];const _=(0,k.b)(Ke,s,l,d/c);if(e.type===se.RAY){const t=(0,k.a)(je,_,s);if((0,k.f)(t,l)<-f)return[]}if(t.type===Ge.HALF_PLANE){const t=(0,p.jb)(Ne,_,i);if((0,p.Om)(t,o)<-f)return[]}return[(0,g.o8)(_)]}function Te(t,e){return function(t,e){let{start:i,end:n,type:o}=t;const r=(0,k.a)(Ue,e,i),s=(0,k.a)(He,n,i),a=(0,k.e)(Fe,s,r),l=(0,k.z)(a)/(0,k.z)(s),c=(0,ge.FD)();if(l<c)switch(o){case se.LINE:return[(0,g.o8)(e)];case se.RAY:return(0,k.f)(s,r)<-c?[]:[(0,g.o8)(e)]}return[]}(Ve(Be,e[2],t),e)}function Ae(t,e){return Re(Ve(Be,0,t),Ve(Ye,0,e)).map((t=>{let[e,i]=t;return(0,f.fA)(e,i)}))}function Ee(t,e,i){return Pe(t,Ve(Be,t[2],e),i)}function Se(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,g.vt)();const o=(0,p.Re)(De,t,e),r=(0,p.Bw)(o);return(0,p.Ln)(n,e,o,0===r?1:i/r),n[2]=t[2],n}function Pe(t,e){let{start:i,end:n,type:o}=e,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,g.vt)();const s=(0,k.a)(Ue,t,i),a=(0,k.a)(He,n,i),l=(0,k.f)(s,a)/(0,k.f)(a,a);return(0,k.b)(r,i,a,o===se.RAY?Math.max(l,0):l)}const Ce=(()=>{const t=(0,g.vt)(),e=(0,g.vt)(),i=(0,g.vt)();return(n,o)=>{let{start:r,end:s}=n,{center:a,radius:l,normal:c,slicePlane:h}=o;const u=(0,de.O_)(a,c,We);if(Oe((0,de.Io)(u,r),0)&&Oe((0,de.Io)(u,s),0)){(0,fe.VV)(c,t,e);const n=(n,o)=>((0,k.d)(i,o,a),(0,p.hZ)(n,(0,k.f)(i,t),(0,k.f)(i,e)),n),o=function(t,e,i){const n=[],o=(0,p.Re)(ye,t.end,t.start),r=(0,p.Re)(me,t.start,e),s=(0,p.m3)(o),a=2*(0,p.Om)(o,r),l=a*a-4*s*((0,p.m3)(r)-i*i);if(0===l){const e=-a/(2*s);(t.type===se.LINE||e>=0)&&n.push((0,p.Ln)(xe,t.start,o,e))}else if(l>0){const e=Math.sqrt(l),i=(-a+e)/(2*s);(t.type===se.LINE||i>=0)&&n.push((0,p.Ln)(xe,t.start,o,i));const r=(-a-e)/(2*s);(t.type===se.LINE||r>=0)&&n.push((0,p.Ln)(be,t.start,o,r))}return n}({start:n(De,r),end:n(Ne,s),type:se.LINE},f.uY,l),u=[];for(const[i,r]of o){const n=(0,k.c)((0,g.vt)(),a);(0,k.b)(n,n,t,i),(0,k.b)(n,n,e,r),h&&!Le(h,n)||u.push(n)}return u}const d=(0,g.vt)();return(0,de.U5)(u,r,s,d)?!Oe((0,k.j)(d,a),l)||h&&!Le(h,d)?[]:[d]:[]}})();function ke(t,e,i){let{start:n,end:o,type:r}=t;const s=[],a=(0,k.d)(Ue,o,n),l=(0,p.Re)(Ne,n,e),c=(0,p.m3)(a),h=2*(0,p.Om)(a,l),u=h*h-4*c*((0,p.m3)(l)-i*i);if(0===u){const t=-h/(2*c);(r===se.LINE||t>=0)&&s.push((0,k.b)((0,g.vt)(),n,a,t))}else if(u>0){const t=Math.sqrt(u),e=(-h+t)/(2*c);(r===se.LINE||e>=0)&&s.push((0,k.b)((0,g.vt)(),n,a,e));const i=(-h-t)/(2*c);(r===se.LINE||i>=0)&&s.push((0,k.b)((0,g.vt)(),n,a,i))}return s}function Re(t,e){const i=t.start,n=t.end,o=e.start,r=e.end,s=(0,k.a)(Ue,n,i),a=(0,k.a)(He,r,o),l=(0,k.a)(Fe,o,i),c=(0,k.e)(qe,s,a);if(!Oe((0,k.f)(l,c),0))return[];const h=(0,k.z)(c);if(Oe(h,0))return[];const u=(0,k.e)($e,l,a),d=(0,k.f)(u,c)/h,p=(0,k.b)(Ke,i,s,d);if(t.type===se.RAY){const t=(0,k.a)(je,p,i);if((0,k.f)(s,t)<-(0,ge.FD)())return[]}if(e.type===se.RAY){const t=(0,k.a)(je,p,o);if((0,k.f)(a,t)<-(0,ge.FD)())return[]}return[(0,g.o8)(p)]}function Ze(t,e,i,n){const[o,r]=t,[s,a]=i,l=s-o,c=a-r,h=l*l+c*c,u=Math.sqrt(h);if(u>e+n)return[];if(u<Math.abs(e-n))return[];if(Oe(u,0)&&Oe(e,n))return[];const d=(e*e-n*n+h)/(2*u),g=Math.sqrt(e*e-d*d),_=g*c/u,v=g*l/u,[y,m]=(0,p.Cc)(De,t,i,d/u);return Oe(_,v)?[(0,f.fA)(y,m)]:[(0,f.fA)(y+_,m-v),(0,f.fA)(y-_,m+v)]}function Ve(t,e,i){let{start:n,end:o,type:r}=i;return(0,k.i)(t.start,n[0],n[1],e),(0,k.i)(t.end,o[0],o[1],e),t.type=ze[r],t}function Ie(t,e){return Oe(t[2],e[2])}function Oe(t,e){return(0,le.Sp)(Math.abs(t-e),0,(0,ge.FD)())}function Le(t,e){return(0,de.Tj)(t,e)}var Ge;!function(t){t[t.PLANE=0]="PLANE",t[t.HALF_PLANE=1]="HALF_PLANE"}(Ge||(Ge={}));const ze={[Ge.PLANE]:se.LINE,[Ge.HALF_PLANE]:se.RAY},De=(0,f.vt)(),Ne=(0,f.vt)(),Ue=(0,g.vt)(),He=(0,g.vt)(),Fe=(0,g.vt)(),qe=(0,g.vt)(),$e=(0,g.vt)(),Ke=(0,g.vt)(),je=(0,g.vt)(),We=(0,de.vt)(),Be={start:(0,g.vt)(),end:(0,g.vt)(),type:se.LINE},Ye={start:(0,g.vt)(),end:(0,g.vt)(),type:se.LINE};class Xe{intersect(t){return wi(this,t)}closestPoints(t){return[this.closestTo(t)]}}class Qe extends Xe{constructor(t){super(),this.point=t}equals(t){return this===t||Li(t)&&(0,k.p)(this.point,t.point)}closestTo(){return M(this.point)}}class Je extends Xe{constructor(t,e,i){super(),this.start=t,this.end=e,this.lineLike={start:t,end:e,type:i}}equals(t){return this===t||Gi(t)&&this.lineLike.type===t.lineLike.type&&(0,k.p)(this.start,t.start)&&(0,k.p)(this.end,t.end)}closestTo(t){const e=b();return Pe(t,this.lineLike,e),e}}class ti extends Je{constructor(t,e){super(t,e,se.LINE)}}class ei extends Je{constructor(t,e){super(t,e,se.RAY)}}class ii extends Xe{constructor(t){super(),this.constraints=t}equals(t){return this===t||Oi(t)&&(0,bt.aI)(this.constraints,t.constraints,((t,e)=>t.equals(e)))}closestTo(t){let e,i=1/0;for(const n of this.constraints){const o=n.closestTo(t),r=(0,k.s)(t,o);r<i&&(i=r,e=o)}return M(e??t)}closestPoints(t){return this.constraints.flatMap((e=>e===this?[]:e.closestPoints(t)))}}class ni extends Xe{constructor(t,e){super(),this.center=t,this.radius=e}equals(t){return this===t||Ni(t)&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius}closestTo(t){const e=b();return Se(t,this.center,this.radius,e),e}}class oi extends Xe{constructor(t,e){super(),this.center=t,this.radius=e}equals(t){return this===t||Ui(t)&&(0,k.p)(this.center,t.center)&&this.radius===t.radius}closestTo(t){const e=b();return Se(t,this.center,this.radius,e),e[2]=this.center[2],e}asCircle(){return new ri(M(this.center),this.radius,x(0,0,1))}}class ri extends Xe{constructor(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;super(),this.center=t,this.radius=e,this.normal=i,this.slicePlane=n}equals(t){return this===t||Hi(t)&&(0,k.p)(this.center,t.center)&&(0,k.p)(this.normal,t.normal)&&this.radius===t.radius}closestTo(t){const{center:e,radius:i}=this;(0,de._I)(this.getPlane(ai),t,si);const n=(0,k.a)(si,si,e),o=(0,k.k)(n);if(Oe(o,0))return M(t);const r=i/Math.sqrt(o),s=b();(0,k.b)(s,e,n,r);const{slicePlane:a}=this;if(a&&!Le(a,s)){const e=Ai(a,this);return e?.closestTo(t)??M(t)}return s}getPlane(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,de.vt)();return(0,de.O_)(this.center,this.normal,t)}}const si=(0,g.vt)(),ai=(0,de.vt)();class li extends Xe{constructor(t){super(),this.z=t}equals(t){return this===t||zi(t)&&this.z===t.z}closestTo(t){return x(t[0],t[1],this.z)}getPlane(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,de.vt)();return(0,k.i)(ci,0,0,this.z),(0,de.O_)(ci,g.Cb,t)}}const ci=(0,g.vt)();class hi extends Xe{constructor(t,e,i){super(),this.start=t,this.end=e,this.planeLike={start:t,end:e,type:i}}equals(t){return this===t||Di(t)&&this.planeLike.type===t.planeLike.type&&(0,k.p)(this.start,t.start)&&(0,k.p)(this.end,t.end)}closestTo(t){const e=b();return Ee(t,this.planeLike,e),e}closestEndTo(t){const{start:e,end:i}=this.planeLike;return Math.sign((0,p.Om)((0,p.Re)(ui,i,e),(0,p.Re)(di,t,e)))>0?this.end:this.start}getPlane(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,de.vt)();const e=(0,k.c)(pi,this.end);return e[2]+=1,(0,de.Cr)(this.start,this.end,e,t)}getSlicePlane(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,de.vt)();const{start:e,end:i,type:n}=this.planeLike;if(n===Ge.PLANE)return;const o=(0,k.i)(pi,e[0],e[1],0),r=(0,k.i)(fi,i[0],i[1],0),s=(0,k.d)(fi,r,o);return(0,de.O_)(o,s,t),t}}const ui=(0,f.vt)(),di=(0,f.vt)(),pi=(0,g.vt)(),fi=(0,g.vt)();class gi extends hi{constructor(t,e){super(t,e,Ge.HALF_PLANE)}}class _i extends Xe{constructor(t,e){super(),this.sphere=(0,pe.l)(t,e)}equals(t){return this===t||Fi(t)&&(0,pe.m)(this.sphere,t.sphere)}closestTo(t){const e=b();return(0,pe.p)(this.sphere,t,e),e}get center(){return(0,pe.a)(this.sphere)}get radius(){return this.sphere[3]}}class vi extends Xe{constructor(t,e,i){super(),this.start=t,this.end=e,this.getZ=i,this.planeLike={start:t,end:e,type:Ge.PLANE}}equals(t){return this===t||qi(t)&&(0,k.p)(this.start,t.start)&&(0,k.p)(this.end,t.end)&&this.getZ===t.getZ}closestTo(t){return function(t,e){const i=b();return Ee(e,t.planeLike,i),i[2]=t.getZ(i[0],i[1])??$i,i}(this,t)}addIfOnTheGround(t,e){for(const i of e){const e=this.getZ(i[0],i[1])??0;Oe(i[2],e)&&(i[2]=e,t.push(i))}}}class yi extends Xe{constructor(t,e,i){super(),this._x=t,this._y=e,this._z=i}equals(t){return this===t||function(t){return t instanceof yi}(t)&&this._x===t._x&&this._y===t._y&&this._z===t._z}closestTo(t){let[e,i,n]=t;return m(this._x??e,this._y??i,this._z??n)}}class mi extends Xe{constructor(t,e,i,n,o){super(),this._origin=t,this._spatialReference=e,this._distanceMeters=i,this._z=n,this._directionDegrees=o}equals(t){return this===t||function(t){return t instanceof mi}(t)&&(0,p.t2)(this._origin,t._origin)&&this._spatialReference===t._spatialReference&&this._distanceMeters===t._distanceMeters&&this._z===t._z&&this._directionDegrees===t._directionDegrees}closestTo(t){let[e,i,n]=t;return(0,p.hZ)(bi,e,i),(0,p.t2)(bi,this._origin)||this._applyDirectionAndDistance(bi),m(bi[0],bi[1],this._z??n)}_applyDirectionAndDistance(t){if(null!=this._directionDegrees&&null!=this._distanceMeters)(0,At.vN)(t,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(null!=this._directionDegrees)!function(t,e,i,n,o){let{azimuth:r,distance:s}=(0,At._3)(Mi,e,n,o);r??=0;let a=s*Math.cos((r-i)*ue.eh);a=Math.max(0,a),(0,At.vN)(t,e,i,a,o)}(t,this._origin,this._directionDegrees,t,this._spatialReference);else if(null!=this._distanceMeters){const{azimuth:e}=(0,At._3)(xi,this._origin,t,this._spatialReference);(0,At.vN)(t,this._origin,e??0,this._distanceMeters,this._spatialReference)}}}const bi=[0,0],xi=new At.Zj;const Mi=new At.Zj;function wi(t,e){if(Oi(t)){const i=[];for(const n of t.constraints){const t=n.intersect(e);t&&i.push(t)}return Ii(i)}if(Oi(e))return wi(e,t);if(qi(t))return ki(t,e);if(qi(e))return ki(e,t);if(Li(t)){const{point:i}=t;if(Li(e))return(0,k.p)(i,e.point)?t:void 0;const n=e.closestTo(i);return(0,k.H)(n,i)?t:void 0}if(Gi(t)){if(Li(e))return wi(e,t);if(Gi(e))return Zi(Re(t.lineLike,e.lineLike));if(zi(e))return Ti(t,e);if(Di(e))return Zi(we(e.planeLike,t.lineLike));if(Ni(e))return Zi(ke(t.lineLike,e.center,e.radius));if(Hi(e))return Zi(Ce(t.lineLike,e));if(Ui(e))return function(t,e){let{lineLike:i}=t,{center:n,radius:o}=e;const r=n[2];return Zi(ke(i,n,o).filter((t=>Oe(t[2],r))))}(t,e);if(Fi(e))return function(t,e){let{lineLike:i}=t,{sphere:n}=e;return Zi((0,pe.n)(n,i.start,i.end))}(t,e)}else if(zi(t)){if(Li(e)||Gi(e))return wi(e,t);if(zi(e))return function(t,e){return Oe(t.z,e.z)?t:void 0}(t,e);if(Di(e))return function(t,e){let{z:i}=t,{planeLike:n}=e;const[o,r]=n.start,[s,a]=n.end,l=x(o,r,i),c=x(s,a,i);return n.type===Ge.PLANE?new ti(l,c):new ei(l,c)}(t,e);if(Ni(e))return function(t,e){const[i,n]=e.center;return new oi(x(i,n,t.z),e.radius)}(t,e);if(Hi(e))return Ei(t,e);if(Ui(e))return function(t,e){return Oe(e.center[2],t.z)?e:void 0}(t,e);if(Fi(e))return function(t,e){let{center:i,radius:n}=e;const o=Math.abs(i[2]-t.z);if(o>n&&!Oe(o,n))return;const r=x(i[0],i[1],t.z),s=Math.sqrt(n**2-o**2);return Oe(s,0)?void 0:new oi(r,s)}(t,e)}else if(Di(t)){if(Li(e)||Gi(e)||zi(e))return wi(e,t);if(Di(e))return Ri(Ae(t.planeLike,e.planeLike));if(Ni(e))return Ri(Me(t.planeLike,e.center,e.radius));if(Hi(e))return Pi(t,e);if(Ui(e))return Si(t,e);if(Fi(e))return Ci(t,e)}else if(Ni(t)){if(Li(e)||Gi(e)||zi(e)||Di(e))return wi(e,t);if(Ni(e))return Ri(Ze(t.center,t.radius,e.center,e.radius));if(Hi(e))return;if(Ui(e))return function(t,e){const i=(0,p.hG)(t.center,e.center);return Oe(i,0)&&Oe(t.radius,e.radius)?e:Vi(Ze(t.center,t.radius,e.center,e.radius),e.center[2])}(t,e);if(Fi(e))return}else if(Hi(t)){if(Li(e)||Gi(e)||zi(e)||Di(e)||Ni(e))return wi(e,t);if(Hi(e))return;if(Ui(e))return void e.asCircle();if(Fi(e))return}else if(Ui(t)){if(Li(e)||Gi(e)||zi(e)||Di(e)||Ni(e)||Hi(e))return wi(e,t);if(Ui(e))return function(t,e){if(!Ie(t.center,e.center))return;const i=(0,p.hG)(t.center,e.center);return Oe(i,0)&&Oe(t.radius,e.radius)?t:Vi(Ze(t.center,t.radius,e.center,e.radius),t.center[2])}(e,t);if(Fi(e))return}else if(Fi(t)){if(Li(e)||Gi(e)||zi(e)||Di(e)||Ni(e)||Ui(e))return wi(e,t);if(Fi(e))return}}const Ti=(()=>{const t=(0,de.vt)();return(e,i)=>{const{start:n,end:o}=e;if(Ie(n,o)&&Oe(n[2],i.z))return e;const r=b();return(0,de.U5)(i.getPlane(t),n,o,r)?new Qe(r):void 0}})();const Ai=(()=>{const t=(0,he.vt)(),e=(0,g.vt)(),i=(0,g.vt)();return(n,o,r)=>{const{normal:s,center:a,radius:l}=o;(0,fe.VV)(s,e,i);const c=(0,de.Qj)(n),h=l*(0,k.f)(c,e),u=l*(0,k.f)(c,i);(0,ce.s)(t,a[0],a[1],a[2],1);const d=(0,ce.h)(n,t),p=Math.hypot(h,u),f=Oe(p,0);if(Oe((0,de.Io)(n,a),0)){if(f)return o;if(Oe(l,0))return!r||Le(r,a)?new Qe(M(a)):void 0;(0,k.e)(e,c,s),(0,k.n)(e,e);const t=new Array,i=(0,g.o8)(a);(0,k.b)(i,i,e,l),r&&!Le(r,i)||t.push(i);const n=(0,g.o8)(a);return(0,k.b)(n,n,e,-l),r&&!Le(r,n)||t.push(n),Zi(t)}if(f)return;const _=-d/p;if(Math.abs(_)>1||Oe(_,1))return;const v=Math.atan(h/u),y=(0,le.YN)(_)-v,m=Math.PI-y,b=new Array,x=(0,g.vt)();(0,k.b)(x,a,e,l*Math.cos(y)),(0,k.b)(x,x,i,l*Math.sin(y)),b.push(x);const w=(0,g.vt)();return(0,k.b)(w,a,e,l*Math.cos(m)),(0,k.b)(w,w,i,l*Math.sin(m)),b.push(w),Zi(r?function(t,e){return e.filter((e=>Le(t,e)))}(r,b):b)}})();const Ei=(()=>{const t=(0,de.vt)();return(e,i)=>Ai(e.getPlane(t),i,i.slicePlane)})();const Si=(()=>{const t=(0,de.vt)();return(e,i)=>{let{center:n,radius:o}=i;const r=Me(e.planeLike,n,o),s=n[2];e.getSlicePlane(t);const a=new Array;for(const[l,c]of r){const e=[l,c,s];Le(t,e)&&a.push(e)}return Zi(a)}})(),Pi=(()=>{const t=(0,de.vt)(),e=(0,de.vt)();return(i,n)=>Ai(i.getPlane(t),n,i.getSlicePlane(e))})(),Ci=(()=>{const t=(0,de.vt)();return(e,i)=>{let{center:n,radius:o}=i;const r=e.getPlane(t),s=(0,de.mN)(r,n),a=Math.abs(s);if(a>o&&!Oe(a,o))return;const l=Math.sqrt(o**2-s**2);if(Oe(l,0)){const t=b();return(0,de._I)(r,n,t),new Qe(t)}const c=b(),h=(0,g.o8)((0,de.Qj)(r));return(0,k.b)(c,n,h,s),new ri(c,l,h,e.getSlicePlane())}})();function ki(t,e){const{planeLike:i,getZ:n}=t,o=new Array;if(Li(e))t.addIfOnTheGround(o,Te(i,e.point));else if(Gi(e))t.addIfOnTheGround(o,we(i,e.lineLike));else if(Ni(e))for(const[r,s]of Me(i,e.center,e.radius)){const t=n(r,s);null!=t&&o.push((0,g.fA)(r,s,t))}else if(Di(e)||qi(e))for(const[r,s]of Ae(i,e.planeLike)){const t=n(r,s)??$i;o.push((0,g.fA)(r,s,t))}return Zi(o)}function Ri(t){return Ii(t.map((t=>{let[e,i]=t;const n=x(e,i,0),o=x(e,i,1);return new ti(n,o)})))}function Zi(t){return Ii(t.map((t=>t?new Qe(t):void 0)))}function Vi(t,e){return Zi(t.map((t=>{let[i,n]=t;return[i,n,e]})))}function Ii(t){if(0!==t.length)return 1===t.length?t[0]??void 0:new ii(t.filter(bt.Ru))}function Oi(t){return t instanceof ii}function Li(t){return t instanceof Qe}function Gi(t){return t instanceof Je}function zi(t){return t instanceof li}function Di(t){return t instanceof hi}function Ni(t){return t instanceof ni}function Ui(t){return t instanceof oi}function Hi(t){return t instanceof ri}function Fi(t){return t instanceof _i}function qi(t){return t instanceof vi}const $i=0;var Ki,ji=i(73582);function Wi(t,e){if(null==t||null==e)return;const i=Bi(t,e);return null!=i?(0,te.Wq)(i,"radians","geographic"):void 0}!function(t){t.Absolute="absolute",t.Relative="relative",t.RelativeBilateral="relative-bilateral"}(Ki||(Ki={}));const Bi=(()=>{const t=(0,g.vt)(),e=(0,g.vt)();return(i,n)=>((0,k.i)(t,i.x,i.y,i.z??0),(0,k.i)(e,n.x,n.y,n.z??0),Yi(t,e,i.spatialReference,n.spatialReference))})(),Yi=(()=>{const t=(0,f.vt)(),e=(0,g.vt)(),i=(0,g.vt)();return(n,o,r,s)=>{if((0,k.p)(n,o))return;const a=(0,At.Xn)(r),l=(0,At.Xn)(s);if(a&&l&&(0,Zt.aI)(a,l)&&(0,ae.F)(n,r,e,a)&&(0,ae.F)(o,s,i,l)){const{azimuth:t}=(0,At._3)(on,e,i,a);return null!=t?(0,Mt.oU)(t,"degrees","radians"):void 0}t[0]=o[0]-n[0],t[1]=o[1]-n[1];let c=(0,p.g7)(f.JP,t);return t[0]<0&&(c=rn-c),c}})();function Xi(t,e,i){if(!t||!e||!i)return;const n=Bi(t,e),o=Bi(e,i);return null!=n&&null!=o?(0,te.Wq)(o-n,"radians","geographic"):void 0}function Qi(t,e){if(null!=t)switch(e){case Ki.Absolute:return Ji(t);case Ki.Relative:{const e=en(t);let i=an.normalize(e,0,!0);return-180===i&&(i=180),(0,te.Wq)(i,"degrees","geographic")}case Ki.RelativeBilateral:{const e=en(t),i=Math.abs(an.normalize(e,0,!0));return(0,te.Wq)(i,"degrees","geographic")}}}function Ji(t){const e=en(t),i=sn.normalize(e,0,!0);return(0,te.Wq)(i,"degrees","geographic")}const tn=(()=>{const t=(0,g.vt)();return function(e,i,n,o,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"geodesic";(0,k.c)(t,i);const a=en(r);if("geodesic"===s){const r=(0,At.Xn)(n);if(r&&(0,ae.F)(t,n,t,r))return(0,At.vN)(e,t,a,o,r),e[2]=i[2],!!(0,ae.F)(e,r,e,n)}const l=(0,te.g2)(a,"geographic","arithmetic"),c=(0,Mt.oU)(l,"degrees","radians"),h=i[0]+o*Math.cos(c),u=i[1]+o*Math.sin(c),d=i[2];return(0,k.i)(e,h,u,d),!0}})();function en(t){if(null!=t)return(0,te.g2)(nn(t),t.rotationType,"geographic")}function nn(t){return(0,Mt.oU)(t.value,t.unit,"degrees")}const on=new At.Zj,rn=2*Math.PI,sn=ji.ie,an=new ji.hr(-180,180);function ln(t,e,i){if(null==e||null==t)return;const n=(0,Mt._H)(i.measurementSR);if(null==n)return;const o=gn(t,i);if(null==o)return;const r=(0,te.l3)(e,n);return new ni(o,r)}function cn(t,e,i,n){if(null==i||null==t)return;const o=gn(t,n);if(null==o)return;const r=en(i),s=t=>{if(null==t)return;const e=b(),i=(0,te.Wq)(t,"degrees","geographic");return tn(e,o,n.measurementSR,10,i,n.mode)?new gi(o,e):void 0},a=()=>{if(null!=e&&null!=t)return en(Wi(e,t))};switch(n.directionMode){case Ki.Absolute:return s(r);case Ki.Relative:{const t=a();if(null==t)return;return s(t+r)}case Ki.RelativeBilateral:{const t=a();if(null==t)return;return Ii([s(t+r),s(t-r)])}}}function hn(t,e){const i=vn(t,e);return null!=i?new li(i):void 0}function un(t,e,i){const{context:n,longitude:o,latitude:r,direction:s,distance:a,elevation:l}=i;if(null!=o||null!=r||null!=a||null!=l||null!=s){if(null!=o||null!=r){const t=en(o),e=en(r),i=vn(l,n);return new yi(t,e,i)}return function(t,e,i){let{context:n,direction:o,distance:r,elevation:s}=i;if(null==e)return hn(s,n);const{view:a,elevationInfo:l,measurementSR:c}=n,h=w(e,a,l);if(!c||!(0,ae.F)(h,e.spatialReference,yn,c))return;const[u,d]=yn,p=null!=r?(0,te.l3)(r,"meters"):void 0,f=en(o),g=vn(s,n),_=t=>{const e=new mi([u,d],c,p,g,t);return null==p||null==t||null==g&&n.hasZ?e:new Qe(e.closestTo(h))};if(null==f)return _(void 0);const v=()=>{if(null!=t&&null!=e)return en(Wi(t,e))};switch(n.directionMode){case Ki.Absolute:return _(f);case Ki.Relative:{const t=v();if(null==t)return;return _(t+f)}case Ki.RelativeBilateral:{const t=v();if(null==t)return;return Ii([_(t+f),_(t-f)])}}}(t,e,i)}}function dn(t){return"geodesic"===t.context.mode?un(null,null,t):fn(t)}function pn(t,e,i){const{context:n,x:o,y:r,distance:s,direction:a,elevation:l}=i;return"geodesic"===n.mode?un(e,t,i):null!=o||null!=r?fn(i):function(t){let e;for(const i of t)i&&(e=e?.intersect(i)??i);return e}([ln(t,s,n),cn(t,e,a,n),hn(l,n)])}function fn(t){let{x:e,y:i,elevation:n,context:o}=t;xn.x=e?.value??0,xn.y=i?.value??0,xn.spatialReference=o.spatialReference;const r=gn(xn,o,mn);return new yi(null!=e&&null!=r?r[0]:void 0,null!=i&&null!=r?r[1]:void 0,vn(n,o))}function gn(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b();const{view:n,elevationInfo:o,measurementSR:r,origin:s,mode:a}=e;if(w(t,n,o,i),(0,ae.F)(i,t.spatialReference,i,r))return"geodesic"!==a&&(0,k.d)(i,i,s),i}function _n(t,e,i,n){const{view:o,measurementSR:r,spatialReference:s,origin:a,mode:l}=i;if("geodesic"===l?(0,k.c)(bn,t):(0,k.g)(bn,t,a),(0,ae.F)(bn,r,bn,s))return function(t,e,i,n,o){let{z:r,m:s}=i;const{spatialReference:a,elevationInfo:l}=n;let c;c=null==r&&null==s?void 0:null==e||"2d"===e.type?r??void 0:(0,y.xS)(e,t,a,y.qt,l)??0;const[h,u]=t;return o?(0,v.J)(o,h,u,c,a):o=(0,v.T)(h,u,c,a),null!=s&&(o.m=s,o.hasM=!0),o}(bn,o,e,i,n)}function vn(t,e){return function(t,e){let{view:i,origin:n,elevationInfo:o,hasZ:r,measurementSR:s}=e;if(null==t||!r)return;const a=(0,Mt.mq)(s);if(null==a)return;const[l,c]=n,h=(0,te.l3)(t,a),u="3d"===i?.type?(0,y.Fo)(i,l,c,h,s,o):h;return null!=u?(0,te.d_)(u,a):void 0}(t,e)?.value??void 0}const yn=b(),mn=b(),bn=b(),xn=(0,v.T)(0,0,0,N.A.WGS84);i(32186);var Mn=i(99773),wn=i(87663),Tn=i(37583),An=i(41036);const En="Control",Sn="Tab",Pn="Enter",Cn="Escape",kn="Tab",Rn={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:An.i,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0},undo:"z",redo:"r"};class Zn{constructor(){this._bindings=new Map}add(t,e){return this.addToggle(t,(t=>{"key-down"===t.type&&e(t)}))}addToggle(t,e){const i=Vn.fromDefinition(t,e),n=(0,wn.tE)(this._bindings,i.key,(()=>[]));return n.push(i),(0,s.hA)((()=>(0,bt.TF)(n,i)))}register(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Tn.o.WIDGET;return(0,s.vE)([t.on("key-down",(e=>this.dispatch(t.inputManager,e)),e),t.on("key-up",(e=>this.dispatch(t.inputManager,e)),e)])}dispatch(t,e){const i=e.key,n=this._bindings.get(i);if(n)for(const o of n)o.process(t,e)}}class Vn{constructor(t,e,i,n,o){this.key=t,this.modifiers=e,this.repeats=i,this.continuePropagation=n,this.callback=o}process(t,e){if(!(e.key!==this.key||"repeat"in e&&e.repeat&&!this.repeats)){for(const e of this.modifiers)if(!t.isModifierKeyDown(e))return;this.continuePropagation||e.stopPropagation(),this.callback(e)}}static fromDefinition(t,e){if("string"==typeof t)return new Vn(t,[],!1,!1,e);const{key:i,modifier:n,repeats:o,continuePropagation:r}=t;return new Vn(i,n?Array.isArray(n)?n:[n]:[],!!o,!!r,e)}}var In=i(79053),On=i(91896);const Ln="esri-tooltip",Gn=`${Ln}-content`,zn=`${Ln}-content--input`,Dn=`${Ln}-content__header`,Nn=`${Ln}-content__header__spacer`,Un=`${Ln}-content__header__actions`,Hn=`${Ln}-draw-header-actions`,Fn=`${Ln}-table`,qn=`${Ln}-help-message`,$n=`${Ln}-help-message__text`,Kn=`${Ln}-help-message__icon`;var jn=i(25329),Wn=i(49716),Bn=i(54761);const Yn=`${Ln}-field`,Xn={base:Yn,inputMode:`${Yn}--input`,title:`${Yn}__title`,value:`${Yn}__value`};let Qn=class extends jn.A{constructor(){super(...arguments),this.hidden=!1,this.mode="feedback"}render(){return(0,Bn.K)("div",{class:this.classes({[Xn.base]:!0,[Xn.inputMode]:"input"===this.mode})},(0,Bn.K)("div",{class:Xn.title,key:"title"},this.title),(0,Bn.K)("div",{class:Xn.value,key:"value"},this.value))}};(0,o._)([(0,c.MZ)()],Qn.prototype,"hidden",void 0),(0,o._)([(0,c.MZ)()],Qn.prototype,"mode",void 0),(0,o._)([(0,c.MZ)()],Qn.prototype,"title",void 0),(0,o._)([(0,c.MZ)()],Qn.prototype,"value",void 0),Qn=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.components.TooltipField")],Qn);const Jn={base:`${Ln}-value-by-value`};let to=class extends jn.A{constructor(){super(...arguments),this.divider="\xd7"}render(){return(0,Bn.K)("div",{class:Jn.base},(0,Bn.K)("span",null,this.left),(0,Bn.K)("span",null,this.divider),(0,Bn.K)("span",null,this.right))}};(0,o._)([(0,c.MZ)()],to.prototype,"left",void 0),(0,o._)([(0,c.MZ)()],to.prototype,"divider",void 0),(0,o._)([(0,c.MZ)()],to.prototype,"right",void 0),to=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.components.ValueByValue")],to);var eo=i(17555);function io(t){let e,i,n=[],o=!1;return function(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return o&&e===this&&function(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}(s,n)||(i=t.apply(this,s),e=this,n=s,o=!0),i}}var no=i(50346),oo=i(52394),ro=i(96820),so=i(65308);function ao(t){const e="metric";if(null==t)return e;const i=t.map,n=(i&&"portalItem"in i?i.portalItem?.portal:null)??so.default.getDefault();switch(n.user?.units??n.units){case e:return e;case"english":return"imperial"}return(0,Mt.jM)(t.spatialReference)??e}function lo(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";return(0,ro.zJ)(t,(0,te.kM)(e,i).value,i,n,o)}function co(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";return(0,ro.nD)(t,(0,te.kM)(e,i).value,i,n,o)}function ho(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ji.ie,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return(0,ro.Me)(t.value,t.unit,t.rotationType,e,i,n,o)}function uo(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(n=n??2,i){case"imperial":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,ro.tr)(t,e.value,e.unit,i,n)}(t,e,n,o);case"metric":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,ro.Ee)(t,e.value,e.unit,i,n)}(t,e,n,o);default:return lo(t,e,i,n,o)}}function po(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i){case"imperial":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,ro.J1)(t,e.value,e.unit,i,n)}(t,e,n,o);case"metric":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,ro.Mm)(t,e.value,e.unit,i,n)}(t,e,n,o);default:return co(t,e,i,n,o)}}function fo(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i){case"imperial":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,ro.t_)(t,e.value,e.unit,i,n)}(t,e,n,o);case"metric":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,ro.W4)(t,e.value,e.unit,i,n)}(t,e,n,o);default:return lo(t,e,i,n,o)}}function go(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i){case"imperial":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,ro.LF)(t,e.value,e.unit,i,n)}(t,e,n,o);case"metric":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,ro.e_)(t,e.value,e.unit,i,n)}(t,e,n,o);default:return co(t,e,i,n,o)}}function _o(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";switch(i){case"imperial":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,ro.Sz)(t,e.value,e.unit,i,n)}(t,e,n,o);case"metric":return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"abbr";return(0,ro.zq)(t,e.value,e.unit,i,n)}(t,e,n,o);default:return lo(t,e,i,n,o)}}function vo(t,e){return{angleRelative:yo,direction:mo,directionRelative:bo,directionRelativeBilateral:xo,latitudeDecimalDegrees:wo,longitudeDecimalDegrees:Mo,area:(i,n)=>_o(t,i,n??e.area),length:(i,n,o)=>uo(t,i,n??e.length,o),lengthRelative:(i,n)=>po(t,i,n??e.length),totalLength:(i,n)=>uo(t,i,n??e.length),verticalLength:(i,n)=>fo(t,i,n??e.verticalLength),verticalLengthRelative:(i,n)=>go(t,i,n??e.verticalLength),percentage:Eo,scalar:Po,scale:So}}function yo(t){return(0,dt.ZV)(t,{signDisplay:"exceptZero",...Co(1)})}function mo(t){return ho(t,t.rotationType,1)}function bo(t){const e=en(t);return(0,dt.ZV)(e,{style:"unit",unitDisplay:"narrow",unit:"degree",signDisplay:e>0?"never":"exceptZero",...Co(1)})}function xo(t){return ho(t,t.rotationType,1)}function Mo(t){return To(t,zo)}function wo(t){return To(t,Do)}function To(t,e){return ho((0,te.kM)(t,"degrees"),"geographic",6,e,!1)}function Ao(t,e){const i=e.normalize((0,te.kM)(t,"degrees").value,void 0,!1);return Po((0,te.LF)(i),6)}function Eo(t){return(0,dt.ZV)(t.value,{style:"percent"})}function So(t){return(0,dt.ZV)(t,{style:"percent",maximumFractionDigits:0})}function Po(t,e){return(0,dt.ZV)(t.value,Co(e))}function Co(t){return{minimumFractionDigits:t,maximumFractionDigits:t}}function ko(t){let{createQuantity:e,sanitize:i}=t;return(t,n)=>{if(null==t)return null;i&&(t=i(t));const o=(0,dt.$J)(t);return null==o?null:e(o,n)}}function Ro(t){return t.replaceAll(/[*^~\xb0\xba]/g,"")}const Zo=t=>{let e=`[-+]?[0-9${t.thousands}]+`;return""!==t.decimal&&(e+=`${t.decimal}[0-9]+`),new RegExp(`^(${e}\\s*)${t.separator}(\\s*${e})$`,"i")},Vo=[];for(const gc of[",","\\|","\\s+"])for(const t of["\\.",",",""])for(const e of["",",","\\.","\u202f","\\s+"])gc!==t&&gc!==e&&t!==e&&Vo.push({separator:gc,decimal:t,thousands:e,pattern:Zo({decimal:t,thousands:e,separator:gc})});function Io(t,e,i){let n=t.replaceAll(/[\s+]/g,"");return""!==i&&(n=n.replaceAll(i,"")),""!==e&&(n=n.replaceAll(e,".")),n}function Oo(t){return Go(function(t){return t&&pt()?(0,dt.$J)(t)??ft(`0\xb0 0' 0" N | ${t}`)?.longitude??ft(`0 | ${t}`)?.longitude??null:null}(t))}function Lo(t){return Go(function(t){return t&&pt()?(0,dt.$J)(t)??ft(`${t} | 0\xb0 0' 0" E`)?.latitude??ft(`${t} | 0`)?.latitude??null:null}(t))}function Go(t){return null!=t?(0,te.Wq)(t,"degrees","geographic"):null}const zo=new ji.hr(-180,180),Do=new ji.hr(-90,90);var No=i(77666),Uo=i(63582);const Ho=Symbol("dragHandles");let Fo=class extends jn.A{constructor(){super(...arguments),this._focusAbortController=new AbortController,this._transitionInfo=null,this._mode="feedback",this._getFormatters=io(vo),this._onHeaderPointerDown=t=>{const e=t.target;e instanceof HTMLElement&&"calcite-button"!==e?.tagName?.toLowerCase()&&(this.removeHandles(Ho),e.setPointerCapture(t.pointerId),this.tooltip.onDragStart(t.clientX,t.clientY),this.addHandles([(0,In.on)(e,"pointermove",(t=>{let{clientX:e,clientY:i}=t;this.tooltip.onDrag(e,i)})),(0,In.on)(e,["pointerup","pointercancel"],(i=>{this.removeHandles(Ho),e.releasePointerCapture(t.pointerId),this.tooltip.onDragEnd()})),(0,In.on)(e,"touchstart",(t=>t.preventDefault()))],Ho))},this._onDiscard=()=>{this.destroyed||(this.tooltip.emit("discard"),this.info.clearInputValues(),this.exitInputMode())},this._onCommit=(t,e)=>{if(this.destroyed)return;if(this.tooltip.emit("commit",{type:e}),"commit-and-exit"===e)return void this.exitInputMode();if("commit-on-blur"===e)return;const i=this._getFocusableElements(),n=i.length,o=i.indexOf(t);if(-1===o)return void this.exitInputMode();const r=((o+("commit-and-next"===e?1:-1))%n+n)%n;qo(i.at(r))},this._onKeyDown=t=>{switch(t.code){case kn:return this._onNextKey(t);case Cn:return t.stopPropagation(),this._onDiscard()}}}get mode(){return this._mode}get _displayUnits(){const{displayUnits:t}=this.info.sketchOptions.values,e=ao(this.tooltip.view);return{length:t.length??e,verticalLength:t.verticalLength??e,area:t.area??e}}get _inputUnitInfos(){const t=this._messagesUnits,e=e=>({unit:e,abbreviation:(0,ro.Cq)(t,e,"abbr")}),{inputUnits:i}=this.info.sketchOptions.values,n=ao(this.tooltip.view),o=i.length??n,r=i.verticalLength??n,s=i.area??n;return{length:e((0,Mt.wL)(o)),verticalLength:e((0,Mt.m5)(r)),area:e((0,Mt.tW)(s)),angle:e("degrees")}}get _formatters(){return this._getFormatters(this._messagesUnits,this._displayUnits)}get fieldContext(){return{formatters:this._formatters,inputUnitInfos:this._inputUnitInfos,messages:this._messagesTooltip,sketchOptions:this.info.sketchOptions,onCommit:this._onCommit,onDiscard:this._onDiscard}}render(){const{visibleElements:t}=this.info.sketchOptions.tooltips,e=this._renderedContent,i=this._renderedActions,n=this._renderedHelpMessage,o=e.length>0,r=o||!!n,s="input"===this.mode;return(0,Bn.K)("div",{class:(0,Wn.Ly)(Gn,s&&zn),onkeydown:this._onKeyDown,tabIndex:-1},s&&r&&t.header?(0,Bn.K)("div",{class:Dn,"data-testid":"tooltip-header",key:"header",onpointerdown:this._onHeaderPointerDown},(0,Bn.K)("calcite-button",{appearance:"transparent","data-testid":"tooltip-back-button",iconFlipRtl:"both",iconStart:"chevron-left",key:"discard-button",kind:"neutral",onclick:this._onDiscard,scale:"s",tabIndex:-1}),i.length>0?(0,Bn.K)(Bn.w,null,(0,Bn.K)("div",{class:Nn,key:"spacer"}),(0,Bn.K)("div",{class:Un,key:"actions"},i)):null):null,o?(0,Bn.K)("div",{class:Fn,key:"content"},...e):null,n)}destroy(){this._focusAbortController.abort(),this._transitionInfo?.transition.skipTransition()}_renderActions(){return null}loadDependencies(){return(0,No.W)({button:()=>Promise.all([i.e(39879),i.e(62785),i.e(92085),i.e(52602)]).then(i.bind(i,52602)),icon:()=>Promise.all([i.e(39879),i.e(95012)]).then(i.bind(i,95012)),input:()=>Promise.all([i.e(39879),i.e(62785),i.e(92085),i.e(79545),i.e(29625)]).then(i.bind(i,29625))})}async enterInputMode(t,e){try{await this._transitionTo("input",e),await this._focusField(t)}catch(i){(0,no.throwIfNotAbortError)(i)}}async exitInputMode(){let{focusOnView:t=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{const{container:e,info:i}=this;i.clearInputValues();const n=t?e?.closest(".esri-view")?.querySelector(".esri-view-surface"):null;await this._transitionTo("feedback"),n instanceof HTMLElement&&n.focus()}catch(e){(0,no.throwIfNotAbortError)(e)}}_onNextKey(t){const e=this._getFocusableElements(),i=e.at(0),n=e.at(-1);i&&n&&(t.shiftKey?document.activeElement===i&&(t.preventDefault(),t.stopPropagation(),qo(n)):document.activeElement===n&&(t.preventDefault(),t.stopPropagation(),qo(i)))}get _renderedContent(){return $o(this._renderContent())}get _renderedActions(){return $o(this._renderActions())}get _renderedHelpMessage(){const{sketchOptions:t,visibleElements:e}=this.info;if(!e.helpMessage)return null;const i=t.tooltips.helpMessage??this._defaultHelpMessage;if(!i)return null;const n=t.tooltips.helpMessageIcon??"information";return(0,Bn.K)("div",{class:qn,key:"help-message"},n?(0,Bn.K)("calcite-icon",{class:Kn,icon:n,scale:"s"}):null,(0,Bn.K)("div",{class:$n},i))}get _defaultHelpMessage(){const{helpMessage:t,viewType:e}=this.info;if(null==t)return null;const i="3d"===e?"helpMessages3d":"helpMessages2d";return this._messagesTooltip?.sketch?.[i]?.[t]}async _focusField(t){this._focusAbortController?.abort(),this._focusAbortController=new AbortController;const{signal:e}=this._focusAbortController;await this._waitForInputs(),(0,no.throwIfAborted)(e);const i=this._getFocusableInputs(),n=t?i.find((e=>e.getAttribute("data-field-name")===t)):i.at(0);await qo(n)}async _transitionTo(t,e){if(this._mode===t&&!this._transitionInfo)return;if(this._transitionInfo?.mode===t)return this._transitionInfo.transition.finished;this._transitionInfo?.transition.skipTransition();const i=async()=>{this.destroyed||(this._mode=t,await(0,oo.NO)(),this.destroyed||(this.renderNow(),await(0,oo.NO)(),this.destroyed||e?.()))};if(!this.domNode?.firstChild||!document.startViewTransition||(0,eo.O)())return void await i();this.autoRenderingEnabled=!1;const n=this._transitionInfo={transition:document.startViewTransition((async()=>{this.destroyed||n!==this._transitionInfo||(this.autoRenderingEnabled=!0,await i())})),mode:t};try{await n.transition.finished}finally{n===this._transitionInfo&&(this._transitionInfo=null)}}async _waitForInputs(){const t=()=>Array.from(this.domNode?.querySelectorAll("calcite-input")??[]);for(;0===t().length;)await(0,no.after)(Ko);await(0,oo.$m)()}_getFocusableInputs(){return Array.from(this.domNode?.querySelectorAll("calcite-input:not([read-only]):not([disabled])")??[])}_getFocusableElements(){const t=this.domNode?.querySelector(`.${Hn}`);return[...Array.from(t?.querySelectorAll(`.${Un} calcite-button:not([disabled])`)??[]),...this._getFocusableInputs()]}};async function qo(t){await(t?.setFocus())}function $o(t){return(Array.isArray(t)?t:[t]).flat(10).filter((t=>!!t))}(0,o._)([(0,Uo.G)("esri/core/t9n/Units"),(0,c.MZ)()],Fo.prototype,"_messagesUnits",void 0),(0,o._)([(0,Uo.G)("esri/views/interactive/tooltip/t9n/Tooltip"),(0,c.MZ)()],Fo.prototype,"_messagesTooltip",void 0),(0,o._)([(0,c.MZ)()],Fo.prototype,"info",void 0),(0,o._)([(0,c.MZ)()],Fo.prototype,"tooltip",void 0),(0,o._)([(0,c.MZ)()],Fo.prototype,"_mode",void 0),(0,o._)([(0,c.MZ)()],Fo.prototype,"mode",null),(0,o._)([(0,c.MZ)()],Fo.prototype,"_displayUnits",null),(0,o._)([(0,c.MZ)()],Fo.prototype,"_inputUnitInfos",null),(0,o._)([(0,c.MZ)()],Fo.prototype,"_formatters",null),(0,o._)([(0,c.MZ)()],Fo.prototype,"fieldContext",null),(0,o._)([(0,c.MZ)()],Fo.prototype,"_renderedContent",null),(0,o._)([(0,c.MZ)()],Fo.prototype,"_renderedActions",null),(0,o._)([(0,c.MZ)()],Fo.prototype,"_renderedHelpMessage",null),(0,o._)([(0,c.MZ)()],Fo.prototype,"_defaultHelpMessage",null),Fo=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.content.TooltipContent")],Fo);const Ko=20;let jo=class extends Fo{_renderContent(){const{area:t,radius:e,xSize:i,ySize:n,visibleElements:o}=this.info,r=this._messagesTooltip.sketch,s=this._formatters;return(0,Bn.K)(Bn.w,null,o.radius&&null!=e?(0,Bn.K)(Qn,{title:r.radius,value:s.length(e)}):null,o.size&&null!=i&&null!=n?(0,Bn.K)(Qn,{title:r.size,value:(0,Bn.K)(to,{left:s.length(i),right:s.length(n)})}):null,o.area?(0,Bn.K)(Qn,{title:r.area,value:s.area(t)}):null)}};jo=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.content.TooltipContentDrawCircle")],jo);const Wo=`${Ln}-editable-field`,Bo={base:Wo,inputMode:`${Wo}--input`,feedbackMode:`${Wo}--feedback`,readOnly:`${Wo}--read-only`,locked:`${Wo}--locked`,title:`${Wo}__title`,value:`${Wo}__value`,valueContent:`${Wo}__value__content`,valueContentReadOnly:`${Wo}__value__content--read-only`,lockIcon:`${Wo}__lock-icon`,input:`${Wo}__input`,inputSuffix:`${Wo}__input-suffix`,button:`${Wo}__button`},Yo="lock",Xo="unlock";let Qo=class extends jn.A{constructor(){super(...arguments),this._input=null,this._lock=null,this._onLockClick=()=>{this.field.toggleLock(this.context)},this._onLockAfterCreate=t=>{this._lock=t},this._onLockAfterRemoved=()=>{this._lock=null},this._onKeyDown=t=>{t.key===Cn&&"input"===this.mode&&this._input&&this.context.onDiscard(this._input)},this._onInputKeyDown=t=>{const e=this._input;if(e)switch(t.key){case Pn:return this.field.onCommit("commit-and-exit",e,this.context);case kn:{t.preventDefault(),t.stopPropagation();const i=t.shiftKey?"commit-and-previous":"commit-and-next";return this.field.onCommit(i,e,this.context)}}},this._onInput=t=>{this.field.onInput(t.target.value)},this._onInputBlur=t=>{const e=this._input;e&&t.relatedTarget!==this._lock&&this.field.onCommit("commit-on-blur",e,this.context)},this._selectText=()=>{const t=()=>{this._input===document.activeElement&&this._input?.selectText()};t(),(0,oo.$m)().then(t)},this._onAfterCreate=t=>{this._input=t,t.addEventListener("paste",this._onPaste),t.addEventListener("beforeinput",this._onBeforeInput)},this._onAfterRemoved=t=>{t.removeEventListener("paste",this._onPaste),t.removeEventListener("beforeinput",this._onBeforeInput)},this._onPaste=t=>{const e=t.clipboardData?.getData("text");e&&null!=this.field.parse(e,this.context)&&(t.stopPropagation(),this.field.onInput(e))},this._onBeforeInput=t=>{("historyUndo"===t.inputType||"historyRedo"===t.inputType)&&!this.field.dirty&&t.preventDefault()}}initialize(){this.addHandles((0,l.watch)((()=>this._rawDisplayValue),(()=>{const{committed:t,inputValue:e}=this.field;t||e||this._input!==document.activeElement||this._selectText()})))}loadDependencies(){return(0,No.W)({button:()=>Promise.all([i.e(39879),i.e(62785),i.e(92085),i.e(52602)]).then(i.bind(i,52602)),icon:()=>Promise.all([i.e(39879),i.e(95012)]).then(i.bind(i,95012)),input:()=>Promise.all([i.e(39879),i.e(62785),i.e(92085),i.e(79545),i.e(29625)]).then(i.bind(i,29625))})}render(){const{field:t,mode:e}=this,i="input"===e,{locked:n,readOnly:o}=t;return(0,Bn.K)("div",{class:this.classes({[Bo.base]:!0,[Bo.feedbackMode]:"feedback"===e,[Bo.inputMode]:"input"===e,[Bo.locked]:n,[Bo.readOnly]:o})},(0,Bn.K)("div",{class:Bo.title,key:"title"},this._title),(0,Bn.K)("div",{class:Bo.value,key:"value",onkeydown:this._onKeyDown},i?this._renderValueInputMode():this._renderValueFeedbackMode()))}get _formattedValue(){return this.field.getFormattedValue(this.context)||Jo}get _rawDisplayValue(){return this.field.getRawDisplayValue(this.context)}get _suffix(){return this.field.getSuffix(this.context)}get _title(){const{title:t}=this.field;return"string"==typeof t?t:t(this.context)}_renderValueFeedbackMode(){return(0,Bn.K)(Bn.w,null,(0,Bn.K)("div",{class:Bo.valueContent,key:"value-feedback"},this._formattedValue),this.field.locked&&"input"!==this.mode?(0,Bn.K)("calcite-icon",{class:Bo.lockIcon,icon:Yo,key:"icon",scale:"s"}):null)}_renderValueInputMode(){return this.field.readOnly?this._renderValueReadOnly():this._renderValueWritable()}_renderValueReadOnly(){return(0,Bn.K)("div",{class:this.classes(Bo.valueContent,Bo.valueContentReadOnly),key:"value-read-only"},this._formattedValue)}_renderValueWritable(){const{field:t}=this,{name:e,invalid:i,locked:n}=t,o=this.context?.messages.sketch??{},r=n?o.unlockConstraint:o.lockConstraint;return(0,Bn.K)(Bn.w,null,(0,Bn.K)("calcite-input",{afterCreate:this._onAfterCreate,afterRemoved:this._onAfterRemoved,class:Bo.input,"data-field-name":e,"data-testid":`tooltip-field-${e}`,key:"input",onblur:this._onInputBlur,onfocus:this._selectText,onkeydown:this._onInputKeyDown,scale:"s",status:i?"invalid":"idle",type:"text",value:this._rawDisplayValue??Jo,onCalciteInputInput:this._onInput}),(0,Bn.K)("div",{class:Bo.inputSuffix,key:"suffix"},this._suffix),t.lockable?(0,Bn.K)("calcite-button",{afterCreate:this._onLockAfterCreate,afterRemoved:this._onLockAfterRemoved,alignment:"center",appearance:"transparent",class:Bo.button,"data-testid":`tooltip-field-${e}-lock`,iconStart:n?Yo:Xo,key:"lock",kind:"neutral",label:r,onclick:this._onLockClick,scale:"s",tabIndex:-1,title:r}):(0,Bn.K)("div",{key:"lock-empty"}))}};(0,o._)([(0,c.MZ)()],Qo.prototype,"field",void 0),(0,o._)([(0,c.MZ)()],Qo.prototype,"context",void 0),(0,o._)([(0,c.MZ)()],Qo.prototype,"mode",void 0),(0,o._)([(0,c.MZ)()],Qo.prototype,"_input",void 0),(0,o._)([(0,c.MZ)()],Qo.prototype,"_lock",void 0),(0,o._)([(0,c.MZ)()],Qo.prototype,"_formattedValue",null),(0,o._)([(0,c.MZ)()],Qo.prototype,"_rawDisplayValue",null),(0,o._)([(0,c.MZ)()],Qo.prototype,"_suffix",null),(0,o._)([(0,c.MZ)()],Qo.prototype,"_title",null),Qo=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.components.TooltipEditableField")],Qo);const Jo="\u2014";function tr(t){const e=t.fields.filter((t=>!0===t?.visible));return 0===e.length?null:(0,Bn.K)(Bn.w,null,e.map((e=>(0,Bn.K)(Qo,{context:t.context,field:e,key:e.id,mode:t.mode}))))}let er=class extends Fo{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{visibleElements:n}=e;return(0,Bn.K)(tr,{context:t,fields:[n.coordinates?e.effectiveX:void 0,n.coordinates?e.effectiveY:void 0,n.elevation?e.elevation:void 0,n.orientation?e.orientation:void 0,n.scale?e.scale:void 0],mode:i})}};er=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.content.TooltipContentDrawMesh")],er);let ir=class extends Fo{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{elevation:n,visibleElements:o}=e;return(0,Bn.K)(tr,{context:t,fields:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0,o.elevation?n:void 0],mode:i})}};ir=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.content.TooltipContentDrawPoint")],ir);const nr={absolute:"absolute-direction",relative:"relative-direction"};let or=class extends jn.A{constructor(t){super(t),this.visibleElements={}}render(){return(0,Bn.K)("div",{class:Hn},this._isElementVisible("direction")?(0,Bn.K)(rr,{messages:this.messages,sketchOptions:this.sketchOptions}):null)}loadDependencies(){return(0,No.W)({button:()=>Promise.all([i.e(39879),i.e(62785),i.e(92085),i.e(52602)]).then(i.bind(i,52602)),dropdown:()=>Promise.all([i.e(39879),i.e(48347),i.e(37131)]).then(i.bind(i,37131)),"dropdown-item":()=>Promise.all([i.e(39879),i.e(95562)]).then(i.bind(i,95562)),"dropdown-group":()=>i.e(19030).then(i.bind(i,19030))})}_isElementVisible(t){return this.visibleElements?.[t]??this.sketchOptions.tooltips.visibleElements[t]}};function rr(t){const{directionMode:e}=t.sketchOptions.values,i=t.messages?.sketch,n=i?.directionModeSelect?.title,o="absolute",r="relative";return(0,Bn.K)("calcite-dropdown",{key:"direction-mode",placement:"bottom-end",scale:"s",widthScale:"s",onCalciteDropdownSelect:e=>{const i=e.target.selectedItems?.[0]?.getAttribute("data-mode");t.sketchOptions.values.directionMode=i??"absolute"}},(0,Bn.K)("calcite-button",{alignment:"end",appearance:"transparent",iconStart:nr[e],kind:"neutral",label:n,scale:"s",slot:"trigger",title:n}),(0,Bn.K)("calcite-dropdown-group",{selectionMode:"single"},(0,Bn.K)("calcite-dropdown-item",{"data-mode":r,"data-testid":"tooltip-direction-mode-relative",iconStart:nr.relative,key:"relative",selected:e===r},i?.directionModeSelect?.relative),(0,Bn.K)("calcite-dropdown-item",{"data-mode":o,"data-testid":"tooltip-direction-mode-absolute",iconStart:nr.absolute,key:"absolute",selected:e===o},i?.directionModeSelect?.absolute)))}(0,o._)([(0,Uo.G)("esri/views/interactive/tooltip/t9n/Tooltip"),(0,c.MZ)()],or.prototype,"messages",void 0),(0,o._)([(0,c.MZ)()],or.prototype,"sketchOptions",void 0),(0,o._)([(0,c.MZ)()],or.prototype,"visibleElements",void 0),or=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.components.DrawHeaderActions")],or);let sr=class extends Fo{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{xyMode:n,visibleElements:o}=e;return(0,Bn.K)(tr,{context:t,fields:[..."direction-distance"===n?[o.direction?e.direction:void 0,o.distance?e.distance:void 0]:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0],o.elevation?e.elevation:void 0,o.area?e.area:void 0],mode:i})}_renderActions(){const{xyMode:t,sketchOptions:e}=this.info;return(0,Bn.K)(or,{sketchOptions:e,visibleElements:{direction:"direction-distance"===t}})}};sr=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.content.TooltipContentDrawPolygon")],sr);let ar=class extends Fo{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{xyMode:n,visibleElements:o}=e;return(0,Bn.K)(tr,{context:t,fields:[..."direction-distance"===n?[o.direction?e.direction:void 0,o.distance?e.distance:void 0]:[o.coordinates?e.effectiveX:void 0,o.coordinates?e.effectiveY:void 0],o.elevation?e.elevation:void 0,o.totalLength?e.totalLength:void 0],mode:i})}_renderActions(){const{xyMode:t,sketchOptions:e}=this.info;return(0,Bn.K)(or,{sketchOptions:e,visibleElements:{direction:"direction-distance"===t}})}};ar=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.content.TooltipContentDrawPolyline")],ar);let lr=class extends Fo{_renderContent(){const{area:t,xSize:e,ySize:i,visibleElements:n}=this.info,o=this._messagesTooltip.sketch,r=this._formatters;return(0,Bn.K)(Bn.w,null,n.size&&null!=e&&null!=i?(0,Bn.K)(Qn,{title:o.size,value:(0,Bn.K)(to,{left:r.length(e),right:r.length(i)})}):null,n.area?(0,Bn.K)(Qn,{title:o.area,value:r.area(t)}):null)}};lr=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.content.TooltipContentDrawRectangle")],lr);let cr=class extends Fo{_renderContent(){const{angle:t,visibleElements:e}=this.info,i=this._messagesTooltip.sketch;return(0,Bn.K)(Bn.w,null,e.rotation?(0,Bn.K)(Qn,{title:i.rotation,value:this._formatters.angleRelative(t)}):null)}};cr=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.content.TooltipContentExtentRotate")],cr);let hr=class extends Fo{_renderContent(){const t=this.info,{visibleElements:e}=t,i=this._messagesTooltip.sketch,n=this._formatters;return(0,Bn.K)(Bn.w,null,e.size?(0,Bn.K)(Qn,{title:i.size,value:(0,Bn.K)(to,{left:n.length(t.xSize),right:n.length(t.ySize)})}):null,e.scale?(0,Bn.K)(Qn,{title:i.scale,value:(0,Bn.K)(to,{left:n.scale(t.xScale),right:n.scale(t.yScale)})}):null)}};hr=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.content.TooltipContentExtentScale")],hr);let ur=class extends Fo{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{visibleElements:n}=e;return(0,Bn.K)(tr,{context:t,fields:[n.coordinates?e.effectiveX:void 0,n.coordinates?e.effectiveY:void 0,n.elevation?e.elevation:void 0],mode:i})}};ur=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.content.TooltipContentMovePoint")],ur);let dr=class extends Fo{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{visibleElements:n}=e;return(0,Bn.K)(tr,{context:t,fields:[n.distance?e.distance:void 0,n.area?e.area:void 0,n.totalLength?e.totalLength:void 0],mode:i})}};dr=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.content.TooltipContentReshapeEdgeOffset")],dr);let pr=class extends Fo{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{visibleElements:n}=e;return(0,Bn.K)(tr,{context:t,fields:[n.coordinates?e.effectiveX:void 0,n.coordinates?e.effectiveY:void 0,n.elevation?e.elevation:void 0,n.area&&"polygon"===e.geometryType?e.area:null,n.totalLength&&"polyline"===e.geometryType?e.totalLength:null],mode:i})}};pr=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.content.TooltipContentSelectedVertex")],pr);let fr=class extends Fo{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{visibleElements:n}=e;return(0,Bn.K)(tr,{context:t,fields:[n.coordinates?e.effectiveX:void 0,n.coordinates?e.effectiveY:void 0,n.elevation?e.elevation:void 0,n.orientation?e.orientation:void 0,n.scale?e.scale:void 0],mode:i})}};fr=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.content.TooltipContentTransformMesh")],fr);let gr=class extends Fo{_renderContent(){const{fieldContext:t,info:e,mode:i}=this,{visibleElements:n}=e;return(0,Bn.K)(tr,{context:t,fields:[n.coordinates?e.effectiveX:void 0,n.coordinates?e.effectiveY:void 0,n.elevation?e.elevation:void 0,n.orientation?e.orientation:void 0,n.size?e.size:void 0],mode:i})}};gr=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.content.TooltipContentTransformPoint")],gr);let _r=class extends Fo{_renderContent(){const{info:t}=this,{visibleElements:e}=t,i=this._messagesTooltip.sketch,n=this._formatters;return(0,Bn.K)(Bn.w,null,e.distance?(0,Bn.K)(Qn,{title:i.distance,value:n.length(t.distance)}):null)}};_r=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.content.TooltipContentTranslate")],_r);let vr=class extends Fo{_renderContent(){const{distance:t,elevation:e,area:i,totalLength:n,visibleElements:o}=this.info,r=this._messagesTooltip.sketch,s=this._formatters;return(0,Bn.K)(Bn.w,null,o.distance?(0,Bn.K)(Qn,{title:r.distance,value:s.length(t)}):null,o.elevation&&null!=e?.actual?(0,Bn.K)(Qn,{title:r.elevation,value:s.verticalLength(e.actual)}):null,o.area&&null!=i?(0,Bn.K)(Qn,{title:r.area,value:s.area(i)}):null,o.totalLength&&null!=n?(0,Bn.K)(Qn,{title:r.totalLength,value:s.length(n)}):null)}};vr=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.content.TooltipContentTranslateVertex")],vr);let yr=class extends Fo{_renderContent(){const{info:t}=this,{visibleElements:e}=t,i=this._messagesTooltip.sketch,n=this._formatters;return(0,Bn.K)(Bn.w,null,e.distance?(0,Bn.K)(Qn,{title:i.distance,value:n.length(t.distance)}):null)}};yr=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.content.TooltipContentTranslateXY")],yr);let mr=class extends Fo{_renderContent(){const{info:t}=this,{visibleElements:e}=t,i=this._messagesTooltip.sketch;return(0,Bn.K)(Bn.w,null,e.distance?(0,Bn.K)(Qn,{title:i.distance,value:this._formatters.verticalLengthRelative(t.distance)}):null)}};mr=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.content.TooltipContentTranslateZ")],mr);const br={base:`${Ln}`,ltr:`${Ln}--ltr`,rtl:`${Ln}--rtl`,debug:`${Ln}--debug`};let xr=class extends ct.A.EventedAccessor{constructor(t){super(t),this.info=null,this.options=null,this.position=null,this.content=null,this._focused=!1,this.outerContainer=document.createElement("div"),this.debug=!1,this._lastPosition=null,this._rtl=!1,this._prevXY=[0,0]}initialize(){const{outerContainer:t}=this;this.addHandles([(0,l.watch)((()=>this.view.overlay?.surface),(e=>{t.remove(),e?.appendChild(t),this._rtl=(0,Wn.V8)(e)}),l.syncAndInitial),(0,l.watch)((()=>this.info),((e,i)=>{if(null!=this.content&&null!=e&&null!=i&&e.type===i.type)this.content.info=e;else{(0,a.pR)(this.content);const i=function(t,e){if(null==e)return null;const i=document.createElement("div");switch(e.type){case"draw-point":return new ir({tooltip:t,info:e,container:i});case"draw-polygon":return new sr({tooltip:t,info:e,container:i});case"draw-polyline":return new ar({tooltip:t,info:e,container:i});case"draw-mesh":return new er({tooltip:t,info:e,container:i});case"draw-rectangle":return new lr({tooltip:t,info:e,container:i});case"draw-circle":return new jo({tooltip:t,info:e,container:i});case"extent-rotate":return new cr({tooltip:t,info:e,container:i});case"extent-scale":return new hr({tooltip:t,info:e,container:i});case"move-point":return new ur({tooltip:t,info:e,container:i});case"selected-vertex":return new pr({tooltip:t,info:e,container:i});case"transform-point":return new gr({tooltip:t,info:e,container:i});case"transform-mesh":return new fr({tooltip:t,info:e,container:i});case"translate":return new _r({tooltip:t,info:e,container:i});case"translate-vertex":return new vr({tooltip:t,info:e,container:i});case"translate-z":return new mr({tooltip:t,info:e,container:i});case"translate-xy":return new yr({tooltip:t,info:e,container:i});case"reshape-edge-offset":return new dr({tooltip:t,info:e,container:i})}}(this,e);i?(this.content=i,i.container&&t.appendChild(i.container),this.exitInputMode()):this.content=null}}),l.syncAndInitial),(0,l.watch)((()=>({container:this.outerContainer,style:this._outerContainerStyle})),(t=>{let{container:e,style:i}=t;Object.assign(e.style,i)}),l.initial),(0,l.watch)((()=>({outerContainer:this.outerContainer,placement:this.effectivePlacement,effectiveOffset:this._effectiveOffset,rtl:this._rtl,debug:this.debug})),(t=>{let{outerContainer:e,placement:i,effectiveOffset:n,rtl:o,debug:r}=t;const{classList:s}=e;s.add(br.base),s.toggle(br.rtl,o),s.toggle(br.ltr,!o),s.toggle(br.debug,r),this.outerContainer.style.setProperty("--offset",`${n}px`),(0,On.hY)(e),function(t,e){let{classList:i}=t;Mr.forEach((t=>i.remove(t))),i.add(wr(e))}(e,i)}),l.initial),(0,l.when)((()=>"feedback"===this.mode),(()=>{this.position=null,this._clearOverride("effectivePlacement")}),l.sync),(0,In.on)(this.outerContainer,"paste",(t=>{this.emit("paste",t)})),(0,In.on)(this.outerContainer,["focusin","focusout"],(()=>{setTimeout((()=>{this._focused=this.content?.container?.contains(document.activeElement)??!1}))}))])}destroy(){this.info=null,this.content=(0,a.pR)(this.content),this.outerContainer.remove()}get mode(){return this.content?.mode??"feedback"}get focused(){return this._focused}get visible(){return"none"!==this._outerContainerStyle.display}get contentContainer(){return this.content?.container}get effectivePlacement(){const t=this.options?.placement;return"auto"===t?"bottom-end":t??"bottom-end"}get _screenPoint(){const{inputManager:t}=this.view;return t?.multiTouchActive?null:t?.latestPointerLocation}get _effectiveOffset(){return this.options?.offset??20}get _outerContainerStyle(){const t=this.position??this._screenPoint;return this._lastPosition=(0,u.y8)(t),null!=t&&null!=this.content?{display:"block",transform:`translate(${Math.round(t.x)}px, ${Math.round(t.y)}px)`}:{display:"none",transform:"none"}}clear(){this.info=null}async enterInputMode(t){const e=this.position??this._lastPosition??this._screenPoint,i=this.position=(0,u.y8)(e),{effectivePlacement:n}=this;this._override("effectivePlacement",n);await(this.content?.enterInputMode(t,(()=>{i&&(this.position=function(t,e,i,n){if(!t||!n.container)return e;const o=t.getBoundingClientRect(),{left:r,top:s}=n.container.getBoundingClientRect();let{x:a,y:l}=e;const c=o.left-r-i;c<0&&(a-=c);const h=o.right-r+i-n.width;h>0&&(a-=h);const d=o.top-s-i;d<0&&(l-=d);const p=o.bottom-s+i-n.height;return p>0&&(l-=p),(0,u.tc)(a,l)}(this.contentContainer,i,this._effectiveOffset,this.view),Object.assign(this.outerContainer.style,this._outerContainerStyle))})))}async exitInputMode(t){await(this.content?.exitInputMode(t))}onDragStart(t,e){this._prevXY=[t,e]}onDrag(t,e){const i=t-this._prevXY[0],n=e-this._prevXY[1];this._prevXY=[t,e];const{position:o}=this;if(o){const{view:r}=this,s=t-r.position[0],a=e-r.position[1];if(s<0||s>r.width||a<0||a>r.height-16)return;this.position=(0,u.tc)(o.x+i,o.y+n)}}onDragEnd(){this._prevXY=[0,0]}};(0,o._)([(0,c.MZ)({nonNullable:!0})],xr.prototype,"view",void 0),(0,o._)([(0,c.MZ)()],xr.prototype,"info",void 0),(0,o._)([(0,c.MZ)()],xr.prototype,"options",void 0),(0,o._)([(0,c.MZ)()],xr.prototype,"position",void 0),(0,o._)([(0,c.MZ)()],xr.prototype,"content",void 0),(0,o._)([(0,c.MZ)({readOnly:!0})],xr.prototype,"mode",null),(0,o._)([(0,c.MZ)()],xr.prototype,"_focused",void 0),(0,o._)([(0,c.MZ)({readOnly:!0})],xr.prototype,"focused",null),(0,o._)([(0,c.MZ)({readOnly:!0})],xr.prototype,"outerContainer",void 0),(0,o._)([(0,c.MZ)({readOnly:!0})],xr.prototype,"contentContainer",null),(0,o._)([(0,c.MZ)({readOnly:!0})],xr.prototype,"effectivePlacement",null),(0,o._)([(0,c.MZ)()],xr.prototype,"debug",void 0),(0,o._)([(0,c.MZ)()],xr.prototype,"_lastPosition",void 0),(0,o._)([(0,c.MZ)()],xr.prototype,"_screenPoint",null),(0,o._)([(0,c.MZ)()],xr.prototype,"_rtl",void 0),(0,o._)([(0,c.MZ)()],xr.prototype,"_effectiveOffset",null),(0,o._)([(0,c.MZ)()],xr.prototype,"_outerContainerStyle",null),xr=(0,o._)([(0,h.$)("esri.views.interactive.Tooltip")],xr);const Mr=["top","bottom","leading","trailing"].flatMap((t=>[wr(`${t}-start`),wr(t),wr(`${t}-end`)]));function wr(t){return`${br.base}--${t}`}const Tr=xr;function Ar(t,e){const i=(0,Mn.Hq)(e.vertexSpace),{scale:n,orientation:o}=t,{transform:r}=e,s=function(t){if(!t)return 0;const e=Er(t.rotationAxis);return null!=e?e*t.rotationAngle:null}(r);i&&null!=s?(o.actual=(0,te.Wq)(s,"degrees","arithmetic"),o.visible=!0):(o.actual=null,o.visible=!1),i?(n.actual=(0,te.LF)(Pr(r)),n.visible=!0):(n.actual=null,n.visible=!1)}function Er(t){return(0,k.H)(t,g.Cb)?1:(0,k.H)(t,Sr)?-1:null}const Sr=(0,k.v)((0,g.vt)(),g.Cb);function Pr(t){return t?Math.max(...t.scale):1}function Cr(t,e,i){if(!e||!("geographic"in e))return;const n=t.clipboardData?.getData("text");if(!n)return;const o=e=>{t.stopPropagation(),t.preventDefault(),i?.onBeforePaste(),e(),i?.onAfterPaste()};if(e.geographic){const t=function(t){if(!t||null!=(0,dt.$J)(t)||!pt())return null;const e=ft(t),i=Go(e?.latitude),n=Go(e?.longitude);return null!=n&&null!=i?{latitude:i,longitude:n}:null}(n);t&&o((()=>{e.longitude.applyValue(t.longitude),e.latitude.applyValue(t.latitude)}))}else{const t=function(t){for(const{decimal:e,thousands:i,pattern:n}of Vo){n.lastIndex=0;const o=t.match(n);if(!o)continue;const r=(0,dt.$J)(Io(o[1],e,i)),s=(0,dt.$J)(Io(o[2],e,i));if(null!=r&&null!=s)return{x:(0,te.LF)(r),y:(0,te.LF)(s)}}return null}(n);t&&o((()=>{e.x.applyValue(t.x),e.y.applyValue(t.y)}))}}let kr=class extends X.A{constructor(t){super(t),this.helpMessage=void 0,this.viewType=void 0}get visibleElements(){return this.sketchOptions.tooltips.visibleElements}get allFields(){return[]}get editableFields(){return this.allFields.filter((t=>t.visible&&!t.readOnly))}clearInputValues(){this.allFields.forEach((t=>t.clearInputValue()))}};(0,o._)([(0,c.MZ)()],kr.prototype,"sketchOptions",void 0),(0,o._)([(0,c.MZ)()],kr.prototype,"visibleElements",null),(0,o._)([(0,c.MZ)()],kr.prototype,"helpMessage",void 0),(0,o._)([(0,c.MZ)()],kr.prototype,"viewType",void 0),(0,o._)([(0,c.MZ)()],kr.prototype,"allFields",null),(0,o._)([(0,c.MZ)()],kr.prototype,"editableFields",null),kr=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.infos.SketchTooltipInfo")],kr);let Rr=class extends kr{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=te.iT}get allFields(){return[]}};(0,o._)([(0,c.MZ)()],Rr.prototype,"type",void 0),(0,o._)([(0,c.MZ)()],Rr.prototype,"radius",void 0),(0,o._)([(0,c.MZ)()],Rr.prototype,"xSize",void 0),(0,o._)([(0,c.MZ)()],Rr.prototype,"ySize",void 0),(0,o._)([(0,c.MZ)()],Rr.prototype,"area",void 0),(0,o._)([(0,c.MZ)()],Rr.prototype,"allFields",null),Rr=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],Rr);var Zr=i(49723);let Vr=class extends X.A{constructor(t){super(t),this.actual=null,this.lockable=!0,this.id=(0,Zr.lk)(),this.inputValue=null,this.readOnly=!1,this.suffix=null,this.visible=!0,this.invalid=!1,this.unlockOnVertexPlacement=!0}get committed(){return this.lockable?this._get("committed"):null}set committed(t){this.lockable&&this._set("committed",t)}get dirty(){return null!=this.inputValue}get locked(){return this.lockable&&null!=this.committed}onInput(t){this.inputValue=t}onCommit(t,e,i){this.lockable?this._onCommitLockable(t,i):this._onCommitNonLockable(i),this.invalid&&"commit-and-exit"===t||i.onCommit(e,t)}_onCommitLockable(t,e){const{inputValue:i,locked:n}=this;n&&Ir(i)?this.unlock():("commit-and-exit"===t&&!n||null!=i)&&this._parseInputAndLock(e)}_onCommitNonLockable(t){const{inputValue:e}=this;Ir(e)?this.setActual(null):null!=e&&this._parseInputAndSetActual(t)}applyValue(t){this.lockable?this.lock(t):this.setActual(t)}clearInputValue(){this.inputValue=null,this.invalid=!1}setActual(t){this.actual=t,this.clearInputValue()}lock(t){this.lockable&&(this.committed=t??this.actual,this.clearInputValue())}unlock(){this.lockable&&(this.committed=null,this.clearInputValue())}toggleLock(t){this.lockable&&(this.locked?this.unlock():this._parseInputAndLock(t))}getSuffix(t){const{suffix:e}=this;return"function"==typeof e?e(t):e}getFormattedValue(t){const{actual:e,committed:i,format:n}=this;return null!=i?n(i,t):null!=e?n(e,t):null}getRawDisplayValue(t){const{actual:e,committed:i,inputValue:n}=this;return null!=n?n:this.lockable&&null!=i?this.formatForInputMode(i,t):null!=e?this.formatForInputMode(e,t):null}_parseInputAndSetActual(t){const{inputValue:e}=this;if(null==e||Ir(e))return this.setActual(null);const i=this.parse(e,t);null!=i?this.setActual(i):this.invalid=!0}_parseInputAndLock(t){const{inputValue:e,actual:i}=this;if(Ir(e))return this.unlock();if(null==e)return this.lock(i);const n=this.parse(e,t);null!=n?this.lock(n):this.invalid=!0}};function Ir(t){return null!=t&&""===t.trim()}(0,o._)([(0,c.MZ)()],Vr.prototype,"actual",void 0),(0,o._)([(0,c.MZ)()],Vr.prototype,"committed",null),(0,o._)([(0,c.MZ)()],Vr.prototype,"dirty",null),(0,o._)([(0,c.MZ)()],Vr.prototype,"format",void 0),(0,o._)([(0,c.MZ)()],Vr.prototype,"formatForInputMode",void 0),(0,o._)([(0,c.MZ)()],Vr.prototype,"lockable",void 0),(0,o._)([(0,c.MZ)()],Vr.prototype,"locked",null),(0,o._)([(0,c.MZ)()],Vr.prototype,"id",void 0),(0,o._)([(0,c.MZ)()],Vr.prototype,"inputValue",void 0),(0,o._)([(0,c.MZ)()],Vr.prototype,"name",void 0),(0,o._)([(0,c.MZ)()],Vr.prototype,"parse",void 0),(0,o._)([(0,c.MZ)()],Vr.prototype,"readOnly",void 0),(0,o._)([(0,c.MZ)()],Vr.prototype,"suffix",void 0),(0,o._)([(0,c.MZ)()],Vr.prototype,"title",void 0),(0,o._)([(0,c.MZ)()],Vr.prototype,"visible",void 0),(0,o._)([(0,c.MZ)()],Vr.prototype,"invalid",void 0),(0,o._)([(0,c.MZ)()],Vr.prototype,"unlockOnVertexPlacement",void 0),Vr=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.fields.TooltipField")],Vr);let Or=class extends Vr{constructor(t){super(t),this.showAsZ=!1}normalizeCtorArgs(t){const e=t=>t.inputUnitInfos.verticalLength.unit;return{name:"elevation",actual:te.r7,parse:ko({createQuantity:(t,i)=>(0,te.d_)(t,e(i))}),format:(t,e)=>e.formatters.verticalLength(t),formatForInputMode:(t,i)=>i.formatters.scalar((0,te.kM)(t,e(i))),suffix:t=>t.inputUnitInfos.verticalLength.abbreviation,title:t=>t.messages.sketch[this.showAsZ?"z":"elevation"],unlockOnVertexPlacement:!1,...t}}};(0,o._)([(0,c.MZ)()],Or.prototype,"showAsZ",void 0),Or=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],Or);let Lr=class extends Vr{constructor(t){super(t),this.precision=1}normalizeCtorArgs(t){return{name:"orientation",actual:null,parse:ko({createQuantity:(t,e)=>(0,te.Wq)(t,(t=>t.inputUnitInfos.angle.unit)(e),"geographic"),sanitize:Ro}),format:t=>ho(Ji(t),"geographic",this.precision),formatForInputMode:(t,e)=>{const i=Ji(t);return e.formatters.scalar(i)},suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>t.messages.sketch.orientation,...t}}};(0,o._)([(0,c.MZ)()],Lr.prototype,"precision",void 0),Lr=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.fields.TooltipFieldOrientation")],Lr);let Gr=class extends Vr{constructor(t){super(t),this.precision=null}normalizeCtorArgs(t){const e=t=>t.inputUnitInfos.length.unit;return{name:"size",actual:null,parse:ko({createQuantity:(t,i)=>(0,te.d_)(t,e(i))}),format:(t,e)=>e.formatters.length(t),formatForInputMode:(t,i)=>i.formatters.scalar((0,te.kM)(t,e(i))),suffix:t=>t.inputUnitInfos.length.abbreviation,title:t=>t.messages.sketch.size,...t}}};function zr(t){const e=t=>t.inputUnitInfos.angle.unit,i=t=>t.sketchOptions.values.effectiveDirectionMode;return new Vr({name:"direction",actual:te.IV,parse:ko({createQuantity:(t,i)=>(0,te.Wq)(t,e(i),"geographic"),sanitize:Ro}),format:(t,e)=>{const n=i(e),o=Qi(t,n);switch(n){case Ki.Absolute:return e.formatters.direction(o);case Ki.Relative:return e.formatters.directionRelative(o);case Ki.RelativeBilateral:return e.formatters.directionRelativeBilateral(o)}},formatForInputMode:(t,n)=>{const o=Qi(t,i(n));return n.formatters.scalar((0,te.kM)(o,e(n)))},suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>{const e=i(t),{absolute:n,relative:o}=t.messages.sketch.direction;switch(e){case Ki.Absolute:return n;case Ki.Relative:case Ki.RelativeBilateral:return o}},...t})}function Dr(t){const e=t=>t.inputUnitInfos.length.unit;return new Vr({name:"distance",actual:te.r7,parse:ko({createQuantity:(t,i)=>(0,te.d_)(Math.max(t,0),e(i))}),format:(t,e)=>e.formatters.length(t),formatForInputMode:(t,i)=>i.formatters.scalar((0,te.kM)(t,e(i))),suffix:t=>t.inputUnitInfos.length.abbreviation,title:t=>t.messages.sketch.distance,...t})}function Nr(t){return Dr({...t})}function Ur(t){return new Vr({name:"x",actual:te.IV,parse:Oo,format:(t,e)=>e.formatters.longitudeDecimalDegrees(t),formatForInputMode:t=>function(t){return Ao(t,zo)}(t),suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>t.messages.sketch.longitude,...t})}function Hr(t){return new Vr({name:"y",actual:te.IV,parse:Lo,format:(t,e)=>e.formatters.latitudeDecimalDegrees(t),formatForInputMode:t=>function(t){return Ao(t,Do)}(t),suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>t.messages.sketch.latitude,...t})}function Fr(t,e){return new Vr({actual:(0,te.LF)(0),parse:ko({createQuantity:t=>(0,te.LF)(t)}),format:(t,e)=>e.formatters.scalar(t),formatForInputMode:(t,e)=>e.formatters.scalar(t),title:e=>e.messages.sketch[t],...e})}(0,o._)([(0,c.MZ)()],Gr.prototype,"precision",void 0),Gr=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.fields.TooltipFieldSize")],Gr);var qr=i(12294);function $r(t,e,i){for(var n=arguments.length,o=new Array(n>3?n-3:0),r=3;r<n;r++)o[r-3]=arguments[r];return(0,At.TT)(t)?e.apply(void 0,o):(0,Zt.K8)(t)?i.apply(void 0,o):null}const Kr=t=>{let e=class extends t{constructor(){super(...arguments),this.longitude=Ur(),this.latitude=Hr(),this.x=function(t){return Fr("x",{name:"x",...t})}(),this.y=function(t){return Fr("y",{name:"y",...t})}(),this.elevation=function(t){return new Or(t)}(),this.geographic=!1}get effectiveX(){return this.geographic?this.longitude:this.x}get effectiveY(){return this.geographic?this.latitude:this.y}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic}}setLocationFromPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t?.spatialReference;if(this.geographic=!!e&&function(t){return(0,At.TT)(t)||(0,Zt.K8)(t)}(e),null==t)return this._setActualLonLat(null,null),void this._setActualXY(null,null);if(this.geographic){const e=(0,qr.QP)(t,jr);this._setActualLonLat(Go(e?.[0]),Go(e?.[1]))}else this._setActualXY((0,te.LF)(t.x),(0,te.LF)(t.y))}_setActualLonLat(t,e){this.longitude.actual=t,this.latitude.actual=e}_setActualXY(t,e){this.x.actual=t,this.y.actual=e}};return(0,o._)([(0,c.MZ)()],e.prototype,"geographic",void 0),(0,o._)([(0,c.MZ)()],e.prototype,"effectiveX",null),(0,o._)([(0,c.MZ)()],e.prototype,"effectiveY",null),(0,o._)([(0,c.MZ)()],e.prototype,"key",null),e=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.infos.TooltipInfoWithCoordinates")],e),e},jr=[0,0];let Wr=class extends(Kr(kr)){constructor(t){super(t),this.type="draw-mesh",this.orientation=function(t){return new Lr(t)}({lockable:!1}),this.scale=function(t){return Fr("scale",{name:"scale",actual:null,parse:ko({createQuantity:t=>(0,te.LF)(Math.abs(t))}),...t})}({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};(0,o._)([(0,c.MZ)()],Wr.prototype,"helpMessage",void 0),(0,o._)([(0,c.MZ)()],Wr.prototype,"allFields",null),Wr=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],Wr);let Br=class extends(Kr(kr)){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};(0,o._)([(0,c.MZ)()],Br.prototype,"helpMessage",void 0),(0,o._)([(0,c.MZ)()],Br.prototype,"allFields",null),Br=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],Br);let Yr=class extends(Kr(kr)){constructor(t){super(t),this.type="draw-polygon",this.direction=zr(),this.distance=Nr(),this.area=function(t){const e=t=>t.inputUnitInfos.area.unit;return new Vr({name:"area",actual:te.iT,parse:ko({createQuantity:(t,i)=>(0,te.gT)(t,e(i))}),format:(t,e)=>e.formatters.area(t),formatForInputMode:(t,i)=>i.formatters.scalar((0,te.kM)(t,e(i))),suffix:t=>t.inputUnitInfos.area.abbreviation,title:t=>t.messages.sketch.area,readOnly:!0,...t})}(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};(0,o._)([(0,c.MZ)()],Yr.prototype,"xyMode",void 0),(0,o._)([(0,c.MZ)()],Yr.prototype,"helpMessage",void 0),(0,o._)([(0,c.MZ)()],Yr.prototype,"allFields",null),Yr=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],Yr);let Xr=class extends(Kr(kr)){constructor(t){super(t),this.type="draw-polyline",this.direction=zr(),this.distance=Nr(),this.totalLength=function(t){return Dr({format:(t,e)=>e.formatters.totalLength(t),title:t=>t.messages.sketch.totalLength,readOnly:!0,...t})}(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};(0,o._)([(0,c.MZ)()],Xr.prototype,"helpMessage",void 0),(0,o._)([(0,c.MZ)()],Xr.prototype,"xyMode",void 0),(0,o._)([(0,c.MZ)()],Xr.prototype,"allFields",null),Xr=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],Xr);let Qr=class extends kr{constructor(t){super(t),this.type="draw-rectangle",this.xSize=te.r7,this.ySize=te.r7,this.area=te.iT}get allFields(){return[]}};(0,o._)([(0,c.MZ)()],Qr.prototype,"type",void 0),(0,o._)([(0,c.MZ)()],Qr.prototype,"xSize",void 0),(0,o._)([(0,c.MZ)()],Qr.prototype,"ySize",void 0),(0,o._)([(0,c.MZ)()],Qr.prototype,"area",void 0),(0,o._)([(0,c.MZ)()],Qr.prototype,"allFields",null),Qr=(0,o._)([(0,h.$)("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],Qr);var Jr=i(38983),ts=i(45097),es=i(98510);function is(t){return(0,Zt.B3)(t)?(0,Zt.oT)(t)||(0,Zt.K8)(t)||(0,Zt.x1)(t)||(0,wt.jA)(t)?es.Y0:t:(0,es.lO)(t)}function ns(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.hasZ;const n=is(t.spatialReference),o=(0,Mt.B5)(n);if(null==o)return null;const r=(t,e)=>!(e.length<2)&&((0,k.i)(t,e[0],e[1],i&&e[2]||0),!0);let s=0;for(const a of t.rings){const i=a.length;if(i<3)continue;const{positionsWorldCoords:o}=e;for(;o.length<i;)o.push((0,g.vt)());const l=os,c=(0,k.i)(rs,0,0,0),h=1/i;for(let e=0;e<i;e++){if(!r(l,a[e]))return null;if(!(0,ae.F)(l,t.spatialReference,o[e],n))return null;(0,k.b)(c,c,o[e],h)}const u=(0,de.Cr)(o[0],o[1],c,(0,de.LV)());if(0===(0,k.k)((0,de.Qj)(u)))continue;for(let t=0;t<i;t++)(0,de.Z1)(u,c,o[t],o[t]);const d=ss(o);for(let t=0;t<d.length;t+=3)s+=(0,ts.Fm)(o[d[t]],o[d[t+1]],o[d[t+2]])}return(0,te.gT)(s,o)}const os=(0,g.vt)(),rs=(0,g.vt)();function ss(t){return(0,Jr.e)(function(t){const e=new Float64Array(2*t.length);for(let i=0;i<t.length;++i){const n=t[i],o=2*i;e[o]=n[0],e[o+1]=n[1]}return e}(t),[],2)}function as(t){return(0,te.gT)(Math.abs((0,At.qy)([t],"square-meters")[0]),"square-meters")}function ls(t){try{return(0,te.gT)(Math.abs((0,kt.geodesicArea)(t,"square-meters")),"square-meters")}catch(e){return null}}function cs(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{positionsWorldCoords:[]};if("on-the-ground"===e){const e=function(t){const{spatialReference:e}=t;return $r(e,as,ls,t)}(t);return null!=e?e:function(t){return ns(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{positionsWorldCoords:[]},!1)}(t,i)}return function(t){return ns(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{positionsWorldCoords:[]})}(t,i)}function hs(t){return cs(t,"on-the-ground",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{positionsWorldCoords:[]})}var us;function ds(t,e){const{hasZ:i,spatialReference:n}=t,o=is(n);let r=0;const s=(0,Mt._H)(o);if(null==s)return null;const a=e===us.Direct?fs:gs;for(const l of t.paths){if(l.length<2)continue;const t=l.length-1;for(let e=0;e<t;++e){const t=l[e];vs[0]=t[0],vs[1]=t[1],vs[2]=i?t[2]:0;const o=l[e+1];ys[0]=o[0],ys[1]=o[1],ys[2]=i?o[2]:0;const s=a(vs,ys,n);if(null==s)return null;r+=s.value}}return(0,te.d_)(r,s)}function ps(t,e){const i=(0,Mt.mq)(e);return null!=i?(0,te.d_)(t??0,i):null}function fs(t,e,i){const n=_s(t,e,i,us.Direct);return null!=n?(0,te.d_)(n.direct,n.unit):null}function gs(t,e,i){const n=_s(t,e,i,us.Horizontal);return null!=n?(0,te.d_)(n.horizontal,n.unit):null}function _s(t,e,i,n){const o=is(i),r=(0,Mt._H)(o);if(null==r)return null;const s=e[2]-t[2];if(n===us.Vertical)return{verticalSigned:s,unit:r};if(!(0,ae.F)(t,i,ms,o)||!(0,ae.F)(e,i,bs,o))return null;if(n===us.Direct)return{direct:(0,k.j)(bs,ms),unit:r};if((0,k.i)(xs,t[0],t[1],e[2]),!(0,ae.F)(xs,i,xs,o))return null;const a=(0,k.j)(xs,bs);return n===us.Horizontal?{horizontal:a,unit:r}:{direct:(0,k.j)(bs,ms),horizontal:a,vertical:Math.abs(s),unit:r}}!function(t){t[t.Direct=0]="Direct",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical"}(us||(us={}));const vs=(0,g.vt)(),ys=(0,g.vt)(),ms=(0,g.vt)(),bs=(0,g.vt)(),xs=(0,g.vt)();function Ms(t,e){if(!(0,Zt.aI)(t.spatialReference,e.spatialReference))return null;const{spatialReference:i}=t;return Ps[0]=t.x,Ps[1]=t.y,Ps[2]=t.hasZ?t.z:0,Cs[0]=e.x,Cs[1]=e.y,Cs[2]=e.hasZ?e.z:0,function(t,e,i){return $r(i,ws,Ts,t,e,i)}(Ps,Cs,i)}function ws(t,e,i){return(0,te.d_)((0,At._3)(Ss,t,e,i).distance,"meters")}function Ts(t,e,i){return(0,te.d_)((0,kt.geodesicLength)(function(t,e,i){return{type:"polyline",spatialReference:i,paths:[[[...t],[...e]]]}}(t,e,i),"meters"),"meters")}function As(t){return(0,te.d_)((0,At.l1)([t],"meters")[0],"meters")}function Es(t){return(0,te.d_)((0,kt.geodesicLength)(t,"meters"),"meters")}const Ss=new At.Zj,Ps=(0,g.vt)(),Cs=(0,g.vt)();function ks(t){return function(t){const{spatialReference:e}=t;return $r(e,As,Es,t)}(t)??function(t){return ds(t,us.Horizontal)}(t)}function Rs(t,e){return Ms(t,e)??function(t,e){const{spatialReference:i}=t;return(0,Zt.aI)(i,e.spatialReference)?(vs[0]=t.x,vs[1]=t.y,vs[2]=t.hasZ?t.z:0,ys[0]=e.x,ys[1]=e.y,ys[2]=e.hasZ?e.z:0,gs(vs,ys,i)):null}(t,e)}(0,g.vt)(),(0,g.vt)();function Zs(t){const{directionOptions:e,geometryType:i,sketchOptions:n,tooltipInfos:o}=t,r=e=>{const i=qs(t).mode,n=o[e].elevation;"relative-to-ground"===i||"relative-to-scene"===i||"on-the-ground"===i?n.lock(Ks(t)):n.unlock()};switch(i){case"polygon":case"polyline":r(i),(t=>{if(e){const i=o[t].direction;i.committed=e.angle,i.unlockOnVertexPlacement=!1,n.values.directionMode=e.mode}})(i);break;case"point":case"mesh":r(i)}}function Vs(t,e){const{drawOperation:i,view:n}=e,o=Os(e),r=qs(e);if("2d"===n.type||!t||"absolute-height"!==r.mode||1!==i?.numCommittedVertices||!o||"draw-polyline"!==o.type&&"draw-polygon"!==o.type||o.elevation.locked)return;const[s,a,l]=t,c=function(t,e,i,n,o){const{view:r,drawOperation:s}=o;if("3d"!==r.type||!s)return;i??=0;const a=$s(o),l=qs(o),c=(0,y.Fo)(r,t,e,i,a,l,n);return ps(c,a)??Ks(o)}(s,a,l,r,e);null!=c&&o.elevation.lock(c)}function Is(t){Os(t)?.allFields.forEach((t=>{t.unlockOnVertexPlacement&&t.unlock()}))}function Os(t){let{geometryType:e,graphic:i,tooltipInfos:n}=t;return"multipoint"===e||i?.geometry?.type!==Ls[e]?null:n[e]}const Ls={point:"point",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon"};function Gs(t,e){switch(t?.type){case"draw-point":!function(t,e){const i=e.graphic?.geometry;"point"===i?.type&&(zs(t,i,e),t.helpMessage=ee("point",i))}(t,e);break;case"draw-polyline":!function(t,e){const{createOperationGeometry:i,drawOperation:n}=e,o=null!=i?i.full:null;o&&"polyline"!==o.type||(Ds(t,e),t.totalLength.actual=n.lastVertex?(o?ks(o):null)??te.r7:null,t.helpMessage=ee("polyline",o))}(t,e);break;case"draw-polygon":!function(t,e){const{createOperationGeometry:i,drawOperation:n}=e,o=null!=i?i.full:null;o&&"polygon"!==o.type||(Ds(t,e),t.area.actual=n.lastVertex?(o?hs(o):null)??te.iT:null,t.helpMessage=ee("polygon",o))}(t,e);break;case"draw-rectangle":!function(t,e){t.sketchOptions=e.sketchOptions,t.xSize=Hs(e),t.ySize=Fs(e),t.area=Us(e)}(t,e);break;case"draw-circle":!function(t,e){const{forceUniformSize:i,sketchOptions:n}=e;t.sketchOptions=n,t.radius=i?function(t){let{createOperationGeometry:e}=t;return(null!=e?.circle?.center&&null!=e.circle.edge?Rs(e.circle.center,e.circle.edge):null)??te.r7}(e):null,t.xSize=i?null:Hs(e),t.ySize=i?null:Fs(e),t.area=Us(e)}(t,e);break;case"draw-mesh":!function(t,e){const{graphic:i,view:n}=e,o=i?.geometry;"3d"!==n.type||o&&"mesh"!==o.type||(zs(t,o?.origin,e),o&&Ar(t,o),t.helpMessage=function(t,e){const i=t?.geometry;if(!t||"mesh"!==i?.type||!e)return;const{renderCoordsHelper:n,elevationProvider:o}=e,{camera:r}=e.state,{extent:s}=i,{center:a,spatialReference:l}=s,c=(0,Mt.GA)(l),h=(0,Mt.G9)(l),u=(0,Mt.GA)(n.spatialReference),d=s.width*c,p=s.height*h,f=(s.zmax??0)*h,g=f-(s.zmin??0)*h,_=Math.max(d,p,g)/u,{x:v,y:m}=a,b=a.z??0;(0,k.i)(re,v,m,b),n.toRenderCoords(re,l,re);const x=_/r.computeScreenPixelSizeAt(re);if(x>r.width*ne)return"meshTooClose";if(x<ie)return"meshTooFar";const M=(0,y.bh)(t),{absoluteZ:w}=(0,y.Q5)(v,m,f,l,e,M);return w<(o.getElevation(v,m,b,l,"ground")??0)*h+g*oe?"meshUnderground":"mesh"}(i,n))}(t,e)}}function zs(t,e,i){const{drawOperation:n,view:o,sketchOptions:r}=i,{cursorVertex:s}=n;if(t.sketchOptions=r,t.viewType=o.type,t.setLocationFromPoint(e,$s(i)),Ns(t.elevation,i),!s)return void(n.constraints=void 0);const a=s;n.constraints={context:js(a,i),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:null,direction:null}}function Ds(t,e){const{drawOperation:i,sketchOptions:n,view:o}=e,{cursorVertex:r,lastVertex:s,secondToLastVertex:a}=i,l=n.values.effectiveDirectionMode;t.sketchOptions=n,t.viewType=o.type;const c=s&&r?Rs(s,r)??te.r7:null;if(t.distance.actual=c,t.distance.readOnly=null==s,t.direction.actual=null,t.direction.readOnly=!0,s&&r&&("absolute"===l||a)){const e=function(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ki.Absolute;if(e&&i)switch(n){case Ki.Absolute:return Wi(e,i);case Ki.Relative:return Qi(Xi(t,e,i),Ki.Relative);case Ki.RelativeBilateral:return Qi(Xi(t,e,i),Ki.RelativeBilateral)}}(a,s,r,l);t.direction.actual=e??te.n0,t.direction.readOnly=!1}t.setLocationFromPoint(r,$s(e)),Ns(t.elevation,e);const h=function(t,e){let{sketchOptions:i}=e;const n=i.tooltips.xyMode;return"auto"===n?t?"direction-distance":"coordinates":n}(s,e);t.xyMode=h,t.direction.visible="direction-distance"===h,t.distance.visible="direction-distance"===h,t.effectiveX.visible="coordinates"===h,t.effectiveY.visible="coordinates"===h;const u=r??s;i.constraints=u?{context:js(u,e),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:t.distance.committed,direction:t.direction.committed}:void 0}function Ns(t,e){const{drawOperation:i}=e,n=i?.cursorVertex??i?.lastVertex;t.actual=function(t){return null!=t?ps(t.hasZ?t.z:0,t.spatialReference):null}(n)??Ks(e),t.visible=i.hasZ,t.readOnly=!1,t.showAsZ=!0}function Us(t){const e=t.createOperationGeometry?.full;return"polygon"!==e?.type?te.iT:hs(e)??te.iT}function Hs(t){const e=t.createOperationGeometry?.rectangle?.midpoints;return(null!=e?Rs(e.left,e.right):null)??te.r7}function Fs(t){const e=t.createOperationGeometry?.rectangle?.midpoints;return(null!=e?Rs(e.top,e.bottom):null)??te.r7}function qs(t){return t.drawOperation.elevationInfo??y.qt}function $s(t){return t.drawOperation.coordinateHelper.spatialReference}function Ks(t){const e=(0,Mt.G9)($s(t));return(0,te.d_)(t.defaultZ*e,"meters")}function js(t,e){return function(t,e,i,n,o,r){let s="geodesic",a=(0,At.Xn)(i);const l=b();return w(t,e,n,l),l[2]=0,a&&(0,ae.F)(l,i,l,a)||(s="euclidean",a=i),{mode:s,view:e,elevationInfo:n,hasZ:o,directionMode:r,spatialReference:t.spatialReference,measurementSR:a,origin:l}}(t,e.view,$s(e),qs(e),e.drawOperation.coordinateHelper.hasZ(),e.sketchOptions.values.effectiveDirectionMode)}var Ws,Bs=i(76336);!function(t){t[t.WhenToolEditable=0]="WhenToolEditable",t[t.WhenToolNotEditable=1]="WhenToolNotEditable",t[t.Always=2]="Always"}(Ws||(Ws={}));class Ys{constructor(){this._isToolEditable=!0,this._manipulators=new Q.A,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(t){this._isToolEditable=t}get length(){return this._manipulators.length}add(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ws.WhenToolEditable;this.addMany([t],e)}addMany(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ws.WhenToolEditable;for(const i of t){const t={manipulator:i,visibilityPredicate:e,attached:!1};this._manipulators.add(t),this._attached&&this._updateManipulatorAttachment(t)}}remove(t){for(let e=0;e<this._manipulators.length;e++)if(this._manipulators.at(e).manipulator===t){const t=this._manipulators.splice(e,1)[0];this._detachManipulator(t);break}}removeAll(){this._manipulators.forEach((t=>{this._detachManipulator(t)})),this._manipulators.removeAll()}attach(){this._manipulators.forEach((t=>{this._updateManipulatorAttachment(t)})),this._attached=!0}detach(){this._manipulators.forEach((t=>{this._detachManipulator(t)})),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach((t=>{let{manipulator:e}=t;return e.destroy()})),this._manipulators.destroy(),this._resourceContexts=null}on(t,e){return this._manipulators.on(t,(t=>{e(t)}))}forEach(t){for(const e of this._manipulators.items)t(e)}some(t){return this._manipulators.items.some(t)}toArray(){const t=[];return this.forEach((e=>t.push(e.manipulator))),t}intersect(t,e){let i=null,n=Number.MAX_VALUE;return this._manipulators.forEach((o=>{let{manipulator:r,attached:s}=o;if(!s||!r.interactive)return;const a=r.intersectionDistance(t,e);null!=a&&a<n&&(n=a,i=r)})),i}_updateManipulatorAttachment(t){this._isManipulatorItemVisible(t)?this._attachManipulator(t):this._detachManipulator(t)}_attachManipulator(t){t.attached||(t.manipulator.attach&&t.manipulator.attach(this._resourceContexts),t.attached=!0)}_detachManipulator(t){if(!t.attached)return;const e=t.manipulator;e.grabbing=!1,e.dragging=!1,e.hovering=!1,e.selected=!1,e.detach&&e.detach(this._resourceContexts),t.attached=!1}_isManipulatorItemVisible(t){return t.visibilityPredicate===Ws.Always||(this._isToolEditable?t.visibilityPredicate===Ws.WhenToolEditable:t.visibilityPredicate===Ws.WhenToolNotEditable)}}let Xs=class extends X.A{constructor(t){super(t),this.manipulators=new Ys,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[Bs.PK.MANAGER,!0],[Bs.PK.USER,!0]]),this._creationFinishedResolver=(0,no.createResolver)()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(t){this._get("visible")!==t&&(this._set("visible",t),this._syncVisible())}get editable(){return this.getEditableFlag(Bs.PK.USER)}set editable(t){this.setEditableFlag(Bs.PK.USER,t)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){null!=this.view&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(t){this.onInputEvent(t)}handleInputEventAfter(t){this.onInputEventAfter(t)}setEditableFlag(t,e){this._editableFlags.set(t,e),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),t===Bs.PK.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(t){return this._editableFlags.get(t)??!1}endDrag(){const t=this.view.inputManager.latestPointerLocation;if(!t)return;let e=!1;this.manipulators.forEach((i=>{let{manipulator:n}=i;n.dragging&&(e=!0,n.events.emit("drag",{action:"end",start:t,screenPoint:t}))})),e&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(t){}onInputEventAfter(t){}get internallyEditable(){return this.getEditableFlag(Bs.PK.USER)&&this.getEditableFlag(Bs.PK.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};(0,o._)([(0,c.MZ)({constructOnly:!0})],Xs.prototype,"view",void 0),(0,o._)([(0,c.MZ)({readOnly:!0})],Xs.prototype,"active",null),(0,o._)([(0,c.MZ)({value:!0})],Xs.prototype,"visible",null),(0,o._)([(0,c.MZ)({value:!0})],Xs.prototype,"editable",null),(0,o._)([(0,c.MZ)({readOnly:!0})],Xs.prototype,"manipulators",void 0),(0,o._)([(0,c.MZ)({readOnly:!0})],Xs.prototype,"updating",null),(0,o._)([(0,c.MZ)()],Xs.prototype,"cursor",null),(0,o._)([(0,c.MZ)({readOnly:!0})],Xs.prototype,"automaticManipulatorSelection",void 0),(0,o._)([(0,c.MZ)()],Xs.prototype,"hasFocusedManipulators",null),(0,o._)([(0,c.MZ)()],Xs.prototype,"hasGrabbedManipulators",void 0),(0,o._)([(0,c.MZ)()],Xs.prototype,"hasHoveredManipulators",void 0),(0,o._)([(0,c.MZ)()],Xs.prototype,"firstGrabbedManipulator",void 0),(0,o._)([(0,c.MZ)({readOnly:!0})],Xs.prototype,"created",void 0),(0,o._)([(0,c.MZ)({readOnly:!0})],Xs.prototype,"removeIncompleteOnCancel",void 0),Xs=(0,o._)([(0,h.$)("esri.views.interactive.InteractiveToolBase")],Xs);let Qs=class extends X.A{constructor(t){super(t),this.enabled=!1}};(0,o._)([(0,c.MZ)({type:Boolean,nonNullable:!0})],Qs.prototype,"enabled",void 0),Qs=(0,o._)([(0,h.$)("esri.views.interactive.sketch.SketchLabelOptions")],Qs);const Js=Qs;let ta=class extends X.A{constructor(t){super(t),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};(0,o._)([(0,c.MZ)({type:String,nonNullable:!0})],ta.prototype,"mode",void 0),ta=(0,o._)([(0,h.$)("esri.views.interactive.sketch.SketchTooltipElevationOptions")],ta);let ea=class extends X.A{constructor(t){super(t),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};(0,o._)([(0,c.MZ)({type:Boolean,nonNullable:!0})],ea.prototype,"area",void 0),(0,o._)([(0,c.MZ)({type:Boolean,nonNullable:!0})],ea.prototype,"coordinates",void 0),(0,o._)([(0,c.MZ)({type:Boolean,nonNullable:!0})],ea.prototype,"direction",void 0),(0,o._)([(0,c.MZ)({type:Boolean,nonNullable:!0})],ea.prototype,"distance",void 0),(0,o._)([(0,c.MZ)({type:Boolean,nonNullable:!0})],ea.prototype,"elevation",void 0),(0,o._)([(0,c.MZ)({type:Boolean,nonNullable:!0})],ea.prototype,"header",void 0),(0,o._)([(0,c.MZ)({type:Boolean,nonNullable:!0})],ea.prototype,"helpMessage",void 0),(0,o._)([(0,c.MZ)({type:Boolean,nonNullable:!0})],ea.prototype,"orientation",void 0),(0,o._)([(0,c.MZ)({type:Boolean,nonNullable:!0})],ea.prototype,"radius",void 0),(0,o._)([(0,c.MZ)({type:Boolean,nonNullable:!0})],ea.prototype,"rotation",void 0),(0,o._)([(0,c.MZ)({type:Boolean,nonNullable:!0})],ea.prototype,"scale",void 0),(0,o._)([(0,c.MZ)({type:Boolean,nonNullable:!0})],ea.prototype,"size",void 0),(0,o._)([(0,c.MZ)({type:Boolean,nonNullable:!0})],ea.prototype,"totalLength",void 0),ea=(0,o._)([(0,h.$)("esri.views.interactive.sketch.SketchTooltipVisibleElements")],ea);const ia=ea;let na=class extends X.A{constructor(t){super(t),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new ta,this.placement="auto",this.offset=null,this.visibleElements=new ia,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};(0,o._)([(0,c.MZ)({type:Boolean,nonNullable:!0})],na.prototype,"enabled",void 0),(0,o._)([(0,c.MZ)()],na.prototype,"forceEnabled",void 0),(0,o._)([(0,c.MZ)()],na.prototype,"effectiveEnabled",null),(0,o._)([(0,c.MZ)()],na.prototype,"helpMessage",void 0),(0,o._)([(0,c.MZ)()],na.prototype,"helpMessageIcon",void 0),(0,o._)([(0,c.MZ)({type:Boolean,nonNullable:!0})],na.prototype,"inputEnabled",void 0),(0,o._)([(0,c.MZ)({type:ta,nonNullable:!0})],na.prototype,"elevation",void 0),(0,o._)([(0,c.MZ)()],na.prototype,"placement",void 0),(0,o._)([(0,c.MZ)()],na.prototype,"offset",void 0),(0,o._)([(0,c.MZ)({type:ia,nonNullable:!0})],na.prototype,"visibleElements",void 0),(0,o._)([(0,c.MZ)()],na.prototype,"visualVariables",void 0),(0,o._)([(0,c.MZ)()],na.prototype,"xyMode",void 0),na=(0,o._)([(0,h.$)("esri.views.interactive.sketch.SketchTooltipOptions")],na);const oa=na;let ra=class extends X.A{constructor(t){super(t),this.length=null,this.verticalLength=null,this.area=null}};(0,o._)([(0,c.MZ)()],ra.prototype,"length",void 0),(0,o._)([(0,c.MZ)()],ra.prototype,"verticalLength",void 0),(0,o._)([(0,c.MZ)()],ra.prototype,"area",void 0),ra=(0,o._)([(0,h.$)("esri.views.interactive.sketch.Units")],ra);const sa=ra;let aa=class extends X.A{constructor(t){super(t),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?Ki.RelativeBilateral:Ki.Relative;case"absolute":return Ki.Absolute}}get displayUnits(){return this._get("displayUnits")??new sa}set displayUnits(t){this._set("displayUnits",t)}get inputUnits(){return this._get("inputUnits")??new sa}set inputUnits(t){this._set("inputUnits",t)}};(0,o._)([(0,c.MZ)({type:String,nonNullable:!0})],aa.prototype,"directionMode",void 0),(0,o._)([(0,c.MZ)({type:Boolean,nonNullable:!0})],aa.prototype,"relativeDirectionIsBilateral",void 0),(0,o._)([(0,c.MZ)()],aa.prototype,"effectiveDirectionMode",null),(0,o._)([(0,c.MZ)({type:sa,nonNullable:!0})],aa.prototype,"displayUnits",null),(0,o._)([(0,c.MZ)({type:sa,nonNullable:!0})],aa.prototype,"inputUnits",null),aa=(0,o._)([(0,h.$)("esri.views.interactive.sketch.SketchValueOptions")],aa);const la=aa;let ca=class extends X.A{constructor(t){super(t),this.labels=new Js,this.tooltips=new oa,this.values=new la}};(0,o._)([(0,c.MZ)({nonNullable:!0,type:Js})],ca.prototype,"labels",void 0),(0,o._)([(0,c.MZ)({nonNullable:!0,type:oa})],ca.prototype,"tooltips",void 0),(0,o._)([(0,c.MZ)({nonNullable:!0,type:la})],ca.prototype,"values",void 0),ca=(0,o._)([(0,h.$)("esri.views.interactive.sketch.SketchOptions")],ca);const ha=ca;var ua=i(49281);let da=class extends(ct.A.EventedMixin(Xs)){constructor(t){super(t),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new ha}initialize(){const{view:t}=this;this.internalGraphicsLayer=new _t.A({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const e=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=function(t,e){return{point:new Br({sketchOptions:e,viewType:t}),polyline:new Xr({sketchOptions:e,viewType:t}),polygon:new Yr({sketchOptions:e,viewType:t}),mesh:new Wr({sketchOptions:e,viewType:t}),rectangle:new Qr({sketchOptions:e}),circle:new Rr({sketchOptions:e})}}(t.type,this.sketchOptions);const i=function(t){const e=new Tr(t());return e.addHandles((0,l.watch)((()=>t()),(t=>{let{view:i,options:n,info:o}=t;e.view=i,void 0!==n&&(e.options=n),void 0!==o&&(e.info=o)}))),e}((()=>({view:t,options:this.sketchOptions.tooltips})));this.tooltip=i,Zs(this._tooltipsContext),this._coordinateFormatterLoadTask=(0,lt.UT)((()=>(0,ut.l)())),this.addHandles([e.on("vertex-add",(t=>this.onVertexAdd(t))),e.on("vertex-remove",(t=>this.onVertexRemove(t))),e.on("vertex-update",(t=>this.onVertexUpdate(t))),e.on("cursor-update",(t=>this.onCursorUpdate(t))),e.on("cursor-remove",(()=>this._updateGraphic())),e.on("complete",(t=>this.onComplete(t))),this._coordinateFormatterLoadTask,i.on("paste",(t=>Cr(t,this.activeTooltipInfo))),(0,l.watch)((()=>this.cursor),(t=>{e.cursor=t}),l.syncAndInitial),(0,ua.fm)((()=>{const{activeTooltipInfo:t,sketchOptions:e}=this;Gs(t,this._tooltipsContext),i.info=e.tooltips.effectiveEnabled?t:null})),(0,ua.fm)((()=>{e.constraintZ=function(t){const{geometryType:e,tooltipInfos:i}=t;switch(e){case"point":case"mesh":case"polyline":case"polygon":{const n=i[e].elevation.committed;if(!n)return;return(0,te.l3)(n,"meters")/(0,Mt.G9)($s(t))}default:return}}(this._tooltipsContext)}),l.sync)]),this.finishToolCreation()}destroy(){this.drawOperation=(0,a.pR)(this.drawOperation),this.tooltip=(0,a.pR)(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=(0,a.pR)(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),null!=this._graphic&&(this._graphic.symbol=t)}set mode(t){const e=this.drawOperation;e&&(e.drawingMode=t),this._set("mode",t)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){const{view:{type:t,map:e}}=this;return"2d"===t&&e&&"undoRedo"in e&&e.undoRedo instanceof at?e.undoRedo:null}set undoRedo(t){this._override("undoRedo",t)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){this.destroyed||function(t,e){return!("key-down"!==t.type||t.key!==Sn||!e||!function(t){const e=t?.sketchOptions;if(!e)return!1;const{inputEnabled:i,visibleElements:n}=e.tooltips;return i&&!0===t.editableFields.some((t=>{let{name:e}=t;return"x"===e||"y"===e?n.coordinates:n[e]}))}(e.info))&&(e.enterInputMode(),t.preventDefault(),t.stopPropagation(),!0)}(t,this.tooltip)||this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),0===this.drawOperation.numCommittedVertices&&Zs(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(fa.outline),this.removeHandles(fa.regularVertices),this.removeHandles(fa.activeVertex),this.removeHandles(fa.activeEdge),this.removeHandles(pa)}_createOrUpdateGraphic(t){if(null!=this._graphic)return this.updateGraphicGeometry(t),this._graphic;const e=new r.default({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=e,this.updateGraphicGeometry(t),this.internalGraphicsLayer.add(e),this.addHandles(this.initializeGraphic(e)),this.notifyChange("graphic"),this.addHandles((0,s.hA)((()=>{this.internalGraphicsLayer.remove(e),this._graphic===e&&(this._graphic=null)})),pa),e}updateGraphicGeometry(t){this._graphic.geometry=t}_getCreateOperationGeometry(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{operationComplete:!1};if(null==this.drawOperation)return;const{coordinateHelper:e,view:i,visualizationCursorVertex:n,lastVertex:o,committedVertices:r,geometryIncludingUncommittedVertices:s,numCommittedVertices:a}=this.drawOperation;if(!(a>0||null!=n))return;const l=t.operationComplete?r:s,c=l.length,h=null!=n?e.pointToArray(n):null,u=this._drawSpatialReference,d="3d"===i.type&&"global"===i.viewingMode,p=new yt;p.committedVertices=r,p.cursorVertex=h;const{geometryType:f}=this;switch(f){case"point":case"mesh":p.full=e.arrayToPoint(l[0]);break;case"multipoint":p.full=c>0?function(t,e){return new Ft.A({points:t,spatialReference:e})}(l,u):null;break;case"polyline":case"polygon":c>0&&(p.full="polygon"===f?Kt([l],u,d,!0):$t([l],u,d),p.cursorEdge=null!=h&&o&&!(0,vt.CI)(n,o)?$t([[h,e.pointToArray(o)]],u,d):null,p.outline=c>1?p.full:null);break;case"circle":case"rectangle":{if(p.committedVertices=p.cursorVertex=null,!c)break;const e=function(t,e){if("2d"===t.type)return new Ut(t.state.transform,t.spatialReference,e.length>2?e[2]:null);if("3d"===t.type){const i=e.length>2?new z.A({x:e[0],y:e[1],z:e[2],spatialReference:t.spatialReference}):new z.A({x:e[0],y:e[1],spatialReference:t.spatialReference});return new Ht(t,i)}return null}(i,l[0]),n=l[0],o=e.makeMapPoint(n[0]+_a*i.resolution,n[1]);"circle"===f?1===c&&t.operationComplete?p.circle=Jt([n,o],e,!0):2===c&&(this.forceUniformSize?p.circle=Jt(l,e,this.centered):p.rectangle=function(t,e,i){const n=e.mapToLocalMultiple(t),o=n[0],r=n[1],s=Math.round(r.x-o.x),a=Math.round(r.y-o.y),l=Dt(i?o.x:o.x+s/2,i?o.y:o.y+a/2),c=i?s:s/2,h=i?a:a/2,u=[],d=2*Math.PI/60;function p(t){const e=Math.cos(t),i=Math.sin(t);return Dt(c*e+l.x,h*i+l.y)}for(let x=0;x<60;x++)u.push(p(x*d));u.push(u[0]);const{spatialReference:f,doUnnormalization:g}=e,_=Kt([u.map((t=>e.localToMap(t))).filter(bt.Ru)],f,g,!1),v=e.localToMap(p(Math.PI/2)),y=e.localToMap(p(0)),m=e.localToMap(p(-Math.PI/2)),b=e.localToMap(p(Math.PI));return{geometry:_,midpoints:null!=v&&null!=y&&null!=m&&null!=b?{top:qt(v,f),right:qt(y,f),bottom:qt(m,f),left:qt(b,f)}:null}}(l,e,this.centered)):1===c&&t.operationComplete?p.rectangle=jt([n,o],e,!0):2===c&&(p.rectangle=this.forceUniformSize?jt(l,e,this.centered):function(t,e,i){let n=e.mapToLocalMultiple(t);if(1===n.length){const t=48,e=n[0];n=[Dt(e.x-t,e.y+t),Dt(e.x+t,e.y-t),Dt(e.x+t,e.y-t),Dt(e.x-t,e.y+t)]}const o=[],r={x:n[0].x,y:n[0].y},s={x:n[1].x,y:n[1].y};if(i){const t=Math.round(s.x-r.x),e=Math.round(s.y-r.y);o.push(Dt(r.x-t,r.y-e),Dt(s.x,r.y-e),Dt(s.x,s.y),Dt(r.x-t,s.y))}else o.push(Dt(r.x,r.y),Dt(s.x,r.y),Dt(s.x,s.y),Dt(r.x,s.y));return Wt(Kt([o.map((t=>e.localToMap(t))).filter(bt.Ru)],e.spatialReference,e.doUnnormalization,!0),o,e)}(l,e,this.centered)),p.full=null!=p.circle?p.circle.geometry:p.rectangle?.geometry,p.outline="polygon"===p.full?.type?p.full:null;break}default:return null}return p}initializeGraphic(t){return(0,s.hA)()}onComplete(t){if(!this.drawOperation)return;this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){const t=this._getCreateOperationGeometry({operationComplete:!0});null!=t&&(e=this._createOrUpdateGraphic(t.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:e,...t})}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){const{drawOperation:t}=this;t&&(t.isCompleted||t.cancel())}onOutlineChanged(t){return(0,s.hA)()}onCursorEdgeChanged(t){return(0,s.hA)()}onVertexAdd(t){Is(this._tooltipsContext),this._updateGraphic(),Vs(t.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit("vertex-add",t)}onVertexRemove(t){Is(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){const t=this._getCreateOperationGeometry();this._createOperationGeometry=t,null!=t?(null!=t.cursorEdge?this.addHandles(this.onCursorEdgeChanged(t.cursorEdge),fa.activeEdge):this.removeHandles(fa.activeEdge),null!=t.outline?this.addHandles(this.onOutlineChanged(t.outline),fa.outline):this.removeHandles(fa.outline),null!=t.committedVertices?this.addHandles(this.onRegularVerticesChanged(t.committedVertices),fa.regularVertices):this.removeHandles(fa.regularVertices),null!=t.cursorVertex?this.addHandles(this.onActiveVertexChanged(t.cursorVertex),fa.activeVertex):this.removeHandles(fa.activeVertex),null!=t.full?this._createOrUpdateGraphic(t.full):this.removeHandles(pa)):this._destroyAllVisualizations()}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?Os(this._tooltipsContext):null}};(0,o._)([(0,c.MZ)()],da.prototype,"_coordinateFormatterLoadTask",void 0),(0,o._)([(0,c.MZ)()],da.prototype,"_createOperationGeometry",void 0),(0,o._)([(0,c.MZ)()],da.prototype,"_tooltipsContext",null),(0,o._)([(0,c.MZ)({value:!0})],da.prototype,"centered",null),(0,o._)([(0,c.MZ)()],da.prototype,"cursor",null),(0,o._)([(0,c.MZ)({nonNullable:!0})],da.prototype,"defaultZ",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0})],da.prototype,"directionOptions",void 0),(0,o._)([(0,c.MZ)()],da.prototype,"drawOperation",void 0),(0,o._)([(0,c.MZ)({value:!0})],da.prototype,"enabled",null),(0,o._)([(0,c.MZ)({value:!0})],da.prototype,"forceUniformSize",null),(0,o._)([(0,c.MZ)({constructOnly:!0})],da.prototype,"geometryType",void 0),(0,o._)([(0,c.MZ)()],da.prototype,"graphic",null),(0,o._)([(0,c.MZ)({constructOnly:!0})],da.prototype,"graphicProperties",void 0),(0,o._)([(0,c.MZ)()],da.prototype,"graphicSymbol",null),(0,o._)([(0,c.MZ)({constructOnly:!0})],da.prototype,"hasZ",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0})],da.prototype,"geometryToPlace",void 0),(0,o._)([(0,c.MZ)()],da.prototype,"mode",null),(0,o._)([(0,c.MZ)()],da.prototype,"snappingManager",void 0),(0,o._)([(0,c.MZ)()],da.prototype,"snapToScene",void 0),(0,o._)([(0,c.MZ)()],da.prototype,"tooltip",void 0),(0,o._)([(0,c.MZ)()],da.prototype,"tooltipInfos",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0,type:ha})],da.prototype,"sketchOptions",void 0),(0,o._)([(0,c.MZ)()],da.prototype,"updating",null),(0,o._)([(0,c.MZ)({constructOnly:!0,nonNullable:!0})],da.prototype,"view",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0})],da.prototype,"undoRedo",null),(0,o._)([(0,c.MZ)()],da.prototype,"activeTooltipInfo",null),da=(0,o._)([(0,h.$)("esri.views.draw.DrawGraphicTool")],da);const pa=Symbol("create-operation-graphic"),fa={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function ga(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const _a=48;var va=i(60767),ya=i(15011),ma=i(64465);const ba="click";class xa{constructor(t){let{consumesClicks:e,grabbableForEvent:i}=t;this.events=new ct.A,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=e,this.grabbableForEvent=i}destroy(){}intersectionDistance(t,e){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}}var Ma;!function(t){t[t.Z=0]="Z",t[t.M=1]="M"}(Ma||(Ma={}));class wa{constructor(t){this.spatialReference=t}createVector(){return this._tag((0,f.vt)())}pointToVector(t){return this._tag((0,f.fA)(t.x,t.y))}arrayToVector(t){return this._tag((0,f.fA)(t[0],t[1]))}vectorToArray(t){return[t[0],t[1]]}pointToArray(t){return[t.x,t.y]}vectorToPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.A;return e.x=t[0],e.y=t[1],e.z=void 0,e.m=void 0,e.spatialReference=this.spatialReference,e}arrayToPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.A;return e.x=t[0],e.y=t[1],e.z=void 0,e.m=void 0,e.spatialReference=this.spatialReference,e}vectorToDehydratedPoint(t,e){if(t)return e??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"},e.x=t[0],e.y=t[1],e.z=void 0,e.m=void 0,e.hasZ=!1,e.hasM=!1,e.spatialReference=this.spatialReference,e}lerp(t,e,i,n){return(0,p.Cc)(n,t,e,i)}addDelta(t,e,i){t[0]+=e,t[1]+=i}distance(t,e){return(0,p.Io)(t,e)}getZ(t){return arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0}hasZ(){return!1}getM(t){return arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0}hasM(){return!1}clone(t){return this._tag((0,f.ci)(t))}copy(t,e){return(0,p.C)(e,t)}fromXYZ(t){return this._tag((0,f.fA)(t[0],t[1]))}toXYZ(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,g.vt)();return(0,k.i)(e,t[0],t[1],0)}pointToXYZ(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,g.vt)();return(0,k.i)(e,t.x,t.y,0)}equals(t,e){return(0,p.aI)(t,e)}_tag(t){return t}}class Ta{constructor(t,e){this._valueType=t,this.spatialReference=e}createVector(){return this._tag((0,g.vt)())}pointToVector(t){return this._tag((0,g.fA)(t.x,t.y,this._valueType===Ma.Z?t.z:t.m))}arrayToVector(t){return this._tag((0,g.fA)(t[0],t[1],t[2]||0))}vectorToArray(t){return[t[0],t[1],t[2]]}pointToArray(t){return this._valueType===Ma.Z?[t.x,t.y,t.z]:[t.x,t.y,t.m]}vectorToPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.A;return e.x=t[0],e.y=t[1],e.z=this._valueType===Ma.Z?t[2]:void 0,e.m=this._valueType===Ma.M?t[2]:void 0,e.spatialReference=this.spatialReference,e}arrayToPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.A;return e.x=t[0],e.y=t[1],e.z=this._valueType===Ma.Z?t[2]:void 0,e.m=this._valueType===Ma.M?t[2]:void 0,e.spatialReference=this.spatialReference,e}vectorToDehydratedPoint(t,e){if(!t)return;e??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"};const i=this._valueType===Ma.Z,n=this._valueType===Ma.M;return e.x=t[0],e.y=t[1],e.z=i?t[2]:void 0,e.m=n?t[2]:void 0,e.hasZ=i,e.hasM=n,e.spatialReference=this.spatialReference,e}lerp(t,e,i,n){return(0,k.m)(n,t,e,i)}addDelta(t,e,i,n){t[0]+=e,t[1]+=i,this._valueType===Ma.Z&&(t[2]+=n)}distance(t,e){return this._valueType===Ma.Z?(0,k.j)(t,e):(0,p.Io)(t,e)}getZ(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return this._valueType===Ma.Z?t[2]:e}hasZ(){return this._valueType===Ma.Z}getM(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return this._valueType===Ma.M?t[2]:e}hasM(){return this._valueType===Ma.M}clone(t){return this._tag((0,g.ci)(t))}copy(t,e){return(0,k.c)(e,t)}fromXYZ(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this._tag((0,g.fA)(t[0],t[1],this._valueType===Ma.Z?t.length>2?t[2]:e:i))}toXYZ(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,g.vt)();return(0,k.i)(e,t[0],t[1],this._valueType===Ma.Z?t[2]:0)}pointToXYZ(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,g.vt)();return(0,k.i)(e,t.x,t.y,this._valueType===Ma.Z?t.z??0:0)}equals(t,e){return(0,k.H)(t,e)}_tag(t){return t}}class Aa{constructor(t){this.spatialReference=t}createVector(){return this._tag((0,he.vt)())}pointToVector(t){return this._tag((0,he.fA)(t.x,t.y,t.z,t.m))}arrayToVector(t){return this._tag((0,he.fA)(t[0],t[1],t[2]||0,t[3]||0))}vectorToArray(t){return[t[0],t[1],t[2],t[3]]}pointToArray(t){return[t.x,t.y,t.z,t.m]}vectorToPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.A;return e.x=t[0],e.y=t[1],e.z=t[2],e.m=t[3],e.spatialReference=this.spatialReference,e}arrayToPoint(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.A;return e.x=t[0],e.y=t[1],e.z=t[2],e.m=t[3],e.spatialReference=this.spatialReference,e}vectorToDehydratedPoint(t,e){if(t)return e??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"},e.x=t[0],e.y=t[1],e.z=t[2],e.m=t[3],e.hasZ=!0,e.hasM=!0,e.spatialReference=this.spatialReference,e}lerp(t,e,i,n){return(0,ce.l)(n,t,e,i)}addDelta(t,e,i,n){t[0]+=e,t[1]+=i,t[2]+=n}distance(t,e){return(0,k.j)(t,e)}getZ(t){return t[2]}hasZ(){return!0}getM(t){return t[3]}hasM(){return!0}clone(t){return this._tag((0,he.ci)(t))}copy(t,e){return(0,ce.c)(e,t)}fromXYZ(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this._tag((0,he.fA)(t[0],t[1],t.length>2?t[2]:e,i))}toXYZ(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,g.vt)();return(0,k.i)(e,t[0],t[1],t[2])}pointToXYZ(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,g.vt)();return(0,k.i)(e,t.x,t.y,t.z??0)}equals(t,e){return(0,ce.e)(t,e)}_tag(t){return t}}function Ea(t,e,i){return t&&e?new Aa(i):e?new Ta(Ma.M,i):t?new Ta(Ma.Z,i):new wa(i)}var Sa,Pa,Ca=i(26346),ka=i(32535),Ra=i(4212);class Za{constructor(t){this.component=t,this.leftEdge=null,this.rightEdge=null,this.type="vertex",this.index=null}get pos(){return this._pos}set pos(t){this._pos=t,this.component.unnormalizeVertexPositions()}}class Va{constructor(t,e,i){this.component=t,this.leftVertex=e,this.rightVertex=i,this.type="edge",e.rightEdge=this,i.leftEdge=this}}class Ia{constructor(t,e){this._spatialReference=t,this._viewingMode=e,this.vertices=[],this.edges=[],this.index=null}unnormalizeVertexPositions(){this.vertices.length<=1||function(t,e){if(!e.supported)return;let i=1/0,n=-1/0;const o=e.upperBoundX-e.lowerBoundX;t.forEach((t=>{let r=t.pos[0];for(;r<e.lowerBoundX;)r+=o;for(;r>e.upperBoundX;)r-=o;i=Math.min(i,r),n=Math.max(n,r),t.pos[0]=r}));const r=n-i;o-r<r&&t.forEach((t=>{t.pos[0]<0&&(t.pos[0]+=o)}))}(this.vertices,function(t,e){const i=(0,Zt.Vp)(t);return e===ma.RT.Global&&i?{supported:!0,lowerBoundX:i.valid[0],upperBoundX:i.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}}(this._spatialReference,this._viewingMode))}updateVertexIndex(t,e){if(0===this.vertices.length)return;const i=this.vertices[0];let n=null,o=t,r=e;do{n=o,n.index=r++,o=n.rightEdge?n.rightEdge.rightVertex:null}while(null!=o&&o!==i);n.leftEdge&&n!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(n),this.vertices.length-1)}getFirstVertex(){return this.vertices.at(0)}getLastVertex(){return this.vertices.at(-1)}isClosed(){return this.vertices.length>2&&null!==this.vertices[0].leftEdge}swapVertices(t,e){const i=this.vertices[t];this.vertices[t]=this.vertices[e],this.vertices[e]=i}iterateVertices(t){if(0===this.vertices.length)return;const e=this.vertices[0];let i=e;do{t(i,i.index),i=null!=i.rightEdge?i.rightEdge.rightVertex:null}while(i!==e&&null!=i)}}class Oa extends ct.A{constructor(t,e){super(),this.type=t,this.coordinateHelper=e,this._geometry=null,this._dirty=!0,this.components=[]}get geometry(){if(this._dirty){switch(this.type){case"point":this._geometry=this._toPoint();break;case"polyline":this._geometry=this._toPolyline();break;case"polygon":this._geometry=this._toPolygon();break;case"mesh":break;default:(0,Ra.Xb)(this.type)}this._dirty=!1}return this._geometry}get spatialReference(){return this.coordinateHelper.spatialReference}get allVertices(){return Array.from(this.iterateVertices())}*iterateVertices(){for(const t of this.components)for(const e of t.vertices)yield e}notifyChanges(t){this._dirty=!0,this.emit("change",t)}_toPoint(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.vectorToPoint(this.components[0].vertices[0].pos)}_toPolyline(){const t=[],e=this.coordinateHelper.vectorToArray;for(const i of this.components){if(i.vertices.length<1)continue;const n=[];let o=i.vertices.find((t=>null==t.leftEdge));const r=o;do{n.push(e(o.pos)),o=o.rightEdge?o.rightEdge.rightVertex:null}while(o&&o!==r);t.push(n)}return new D.A({paths:t,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}_toPolygon(){const t=[],e=this.coordinateHelper.vectorToArray;for(const i of this.components){if(i.vertices.length<1)continue;const n=[],o=i.vertices[0];let r=o;const s=r;do{n.push(e(r.pos)),r=null!=r.rightEdge?r.rightEdge.rightVertex:null}while(r&&r!==s);i.isClosed()&&n.push(e(o.pos)),t.push(n)}return new Tt.A({rings:t,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}static fromGeometry(t,e){const i=t.spatialReference,n=Ea(t.hasZ,t.hasM,i),o=new Oa(t.type,n);switch(t.type){case"polygon":!function(t,e,i){const n=e.spatialReference,o=t.coordinateHelper,r=e.rings;for(let s=0;s<r.length;++s){const e=r[s],a=new Ia(n,i);a.index=s;const l=e.length>2&&(0,bt.aI)(e[0],e[e.length-1]),c=l?e.length-1:e.length;for(let t=0;t<c;++t){const i=o.arrayToVector(e[t]),n=new Za(a);a.vertices.push(n),n.pos=i,n.index=t}const h=a.vertices.length-1;for(let t=0;t<h;++t){const e=a.vertices[t],i=a.vertices[t+1],n=new Va(a,e,i);a.edges.push(n)}if(l){const t=new Va(a,a.vertices[a.vertices.length-1],a.vertices[0]);a.edges.push(t)}t.components.push(a)}}(o,t,e);break;case"polyline":!function(t,e,i){const n=e.spatialReference,o=t.coordinateHelper,r=e.paths;for(let s=0;s<r.length;++s){const e=r[s],a=new Ia(n,i);a.index=s;const l=e.length;for(let t=0;t<l;++t){const i=o.arrayToVector(e[t]),n=new Za(a);a.vertices.push(n),n.pos=i,n.index=t}const c=a.vertices.length-1;for(let t=0;t<c;++t){const e=a.vertices[t],i=a.vertices[t+1],n=new Va(a,e,i);a.edges.push(n)}t.components.push(a)}}(o,t,e);break;case"point":La(o,t,e);break;case"mesh":La(o,t.origin,e),o._geometry=t,o._dirty=!1}return o}}function La(t,e,i){const n=e.spatialReference,o=t.coordinateHelper,r=new Ia(n,i);r.index=0;const s=new Za(r);s.index=0,s.pos=o.pointToVector(e),r.vertices.push(s),t.components.push(r)}function Ga(t){return"mesh"===t.type}!function(t){t[t.NEW_STEP=0]="NEW_STEP",t[t.ACCUMULATE_STEPS=1]="ACCUMULATE_STEPS"}(Sa||(Sa={}));class za{constructor(t,e,i){this._editGeometry=t,this._component=e,this._pos=i,this._addedVertex=null,this._originalEdge=null,this._left=null,this._right=null}apply(){let t="redo";null==this._addedVertex&&(t="apply",this._addedVertex=new Za(this._component));const e=this._component.getLastVertex();if(null==e)this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,this._addedVertex.index=0;else{let t=null;e.rightEdge&&(this._originalEdge=e.rightEdge,t=this._originalEdge.rightVertex,this._component.edges.splice(this._component.edges.indexOf(this._originalEdge),1)),this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,null==this._left&&(this._left=new Va(this._component,e,this._addedVertex)),this._component.edges.push(this._left),e.rightEdge=this._left,null!=this._originalEdge&&null!=t&&(null==this._right&&(this._right=new Va(this._component,this._addedVertex,t)),this._component.edges.push(this._right),t.leftEdge=this._right),this._component.updateVertexIndex(this._addedVertex,e.index+1)}this._editGeometry.notifyChanges({operation:t,addedVertices:[this._addedVertex]})}undo(){null!=this._addedVertex&&(this._component.vertices.splice(this._component.vertices.indexOf(this._addedVertex),1),null!=this._left&&(this._component.edges.splice(this._component.edges.indexOf(this._left),1),this._left.leftVertex.rightEdge=null),null!=this._right&&(this._component.edges.splice(this._component.edges.indexOf(this._right),1),this._right.rightVertex.leftEdge=null),null!=this._originalEdge&&(this._component.edges.push(this._originalEdge),this._originalEdge.leftVertex.rightEdge=this._originalEdge,this._originalEdge.rightVertex.leftEdge=this._originalEdge),null!=this._left?this._component.updateVertexIndex(this._left.leftVertex,this._left.leftVertex.index):this._component.updateVertexIndex(this._addedVertex,0),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this._addedVertex]}))}accumulate(){return!1}}class Da{constructor(t,e,i){this._editGeometry=t,this._vertices=e,this.operation=i,this._undone=!1}apply(){this._vertices.forEach((t=>this.operation.apply(t))),this._editGeometry.components.forEach((t=>t.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:this._undone?"redo":"apply",updatedVertices:this._vertices})}undo(){this._vertices.forEach((t=>this.operation.undo(t))),this._editGeometry.notifyChanges({operation:"undo",updatedVertices:this._vertices}),this._undone=!0}canAccumulate(t){if(this._undone||t._vertices.length!==this._vertices.length)return!1;for(let e=0;e<t._vertices.length;++e)if(t._vertices[e]!==this._vertices[e])return!1;return this.operation.canAccumulate(t.operation)}accumulate(t){return!!(t instanceof Da&&this.canAccumulate(t))&&(this._vertices.forEach((e=>this.operation.accumulate(e,t.operation))),this.operation.accumulateParams(t.operation),this._editGeometry.components.forEach((t=>t.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:"apply",updatedVertices:this._vertices}),!0)}}!function(t){t[t.CUMULATIVE=0]="CUMULATIVE",t[t.REPLACE=1]="REPLACE"}(Pa||(Pa={}));class Na{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._editGeometry=t,this._vertices=e,this._minNumberOfVertices=i,this.removedVertices=null}apply(){let t="redo";if(null==this.removedVertices){const e=this.removedVertices=[];this._vertices.forEach((t=>{const i=this._removeVertex(t);null!=i&&e.push(i)})),t="apply"}else this.removedVertices.forEach((t=>{this._removeVertex(t.removedVertex)}));this._editGeometry.notifyChanges({operation:t,removedVertices:this._vertices})}undo(){this.removedVertices?.forEach((t=>{this._undoRemoveVertex(t)})),this._editGeometry.notifyChanges({operation:"undo",addedVertices:this._vertices})}accumulate(){return!1}_removeVertex(t){const e=t.component;if(e.vertices.length<=this._minNumberOfVertices)return null;const i={removedVertex:t,createdEdge:null},n=t.leftEdge,o=t.rightEdge;return e.vertices.splice(e.vertices.indexOf(t),1),n&&(e.edges.splice(e.edges.indexOf(n),1),n.leftVertex.rightEdge=null),o&&(e.edges.splice(e.edges.indexOf(o),1),o.rightVertex.leftEdge=null),0===t.index&&o&&this._vertices.length>0&&e.swapVertices(e.vertices.indexOf(o.rightVertex),0),n&&o&&(i.createdEdge=new Va(e,n.leftVertex,o.rightVertex),e.edges.push(i.createdEdge)),o&&e.updateVertexIndex(o.rightVertex,o.rightVertex.index-1),i}_undoRemoveVertex(t){const e=t.removedVertex,i=t.removedVertex.component,n=e.leftEdge,o=e.rightEdge;t.createdEdge&&i.edges.splice(i.edges.indexOf(t.createdEdge),1),i.vertices.push(e),n&&(i.edges.push(n),n.leftVertex.rightEdge=n),o&&(i.edges.push(o),o.rightVertex.leftEdge=o),i.updateVertexIndex(e,e.index)}}class Ua{constructor(t,e,i){this._editGeometry=t,this._edge=e,this._t=i,this.createdVertex=null,this._left=null,this._right=null}apply(){let t="redo";const e=this._edge,i=e.component,n=e.leftVertex,o=e.rightVertex;i.edges.splice(i.edges.indexOf(e),1),null==this.createdVertex&&(t="apply",this.createdVertex=new Za(e.component)),i.vertices.push(this.createdVertex),this.createdVertex.pos=this._editGeometry.coordinateHelper.lerp(e.leftVertex.pos,e.rightVertex.pos,this._t,this._editGeometry.coordinateHelper.createVector()),null==this._left&&(this._left=new Va(i,n,this.createdVertex)),this._left.leftVertex.leftEdge?i.edges.push(this._left):i.edges.unshift(this._left),n.rightEdge=this._left,null==this._right&&(this._right=new Va(i,this.createdVertex,o)),i.edges.push(this._right),o.leftEdge=this._right,i.updateVertexIndex(this.createdVertex,n.index+1),this._editGeometry.notifyChanges({operation:t,addedVertices:[this.createdVertex]})}undo(){if(null==this.createdVertex||null==this._left||null==this._right)return null;const t=this._edge,e=t.component,i=this.createdVertex.leftEdge,n=this.createdVertex.rightEdge,o=i?.leftVertex,r=n?.rightVertex;e.vertices.splice(e.vertices.indexOf(this.createdVertex),1),e.edges.splice(e.edges.indexOf(this._left),1),e.edges.splice(e.edges.indexOf(this._right),1),this._edge.leftVertex.leftEdge?e.edges.push(this._edge):e.edges.unshift(this._edge),o&&(o.rightEdge=t),r&&(r.leftEdge=t),o&&e.updateVertexIndex(o,o.index),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this.createdVertex]})}accumulate(){return!1}}class Ha{constructor(t,e,i){this._editGeometry=t,this._vertex=e,this._pos=i}apply(){const t=null==this._originalPosition;t&&(this._originalPosition=this._vertex.pos),this._apply(t?"apply":"redo")}undo(){this._vertex.pos=this._originalPosition,this._editGeometry.notifyChanges({operation:"undo",updatedVertices:[this._vertex]})}accumulate(t){return t instanceof Ha&&t._vertex===this._vertex&&(this._pos=t._pos,this._apply("apply"),!0)}_apply(t){this._vertex.pos=this._pos,this._editGeometry.components.forEach((t=>t.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:t,updatedVertices:[this._vertex]})}}class Fa{constructor(t,e){this._editGeometry=t,this._component=e,this._createdEdge=null}apply(){let t="redo";if(null==this._createdEdge){t="apply";const e=this._component.getFirstVertex(),i=this._component.getLastVertex();if(this._component.isClosed()||this._component.vertices.length<3||null==e||null==i)return;this._createdEdge=new Va(this._component,i,e)}this._createdEdge.leftVertex.rightEdge=this._createdEdge,this._createdEdge.rightVertex.leftEdge=this._createdEdge,this._component.edges.push(this._createdEdge),this._editGeometry.notifyChanges({operation:t})}undo(){null!=this._createdEdge&&((0,bt.TF)(this._component.edges,this._createdEdge),this._createdEdge.leftVertex.rightEdge=null,this._createdEdge.rightVertex.leftEdge=null,this._editGeometry.notifyChanges({operation:"undo"}))}accumulate(){return!1}}class qa{constructor(t,e,i,n){this._editGeometry=t,this.dx=e,this.dy=i,this.dz=n,this._firstTime=!0}apply(){const t=this._firstTime?"apply":"redo";this._firstTime=!1,this._apply(t,this.dx,this.dy,this.dz)}undo(){this._apply("undo",-this.dx,-this.dy,-this.dz)}accumulate(t){const e=this._editGeometry.geometry;return t instanceof qa&&t._editGeometry.geometry===e&&(this._apply("apply",t.dx,t.dy,t.dz),this.dx+=t.dx,this.dy+=t.dy,this.dz+=t.dz,!0)}_apply(t,e,i,n){const o=this._editGeometry.geometry;o.offset(e,i,n);const r=this._editGeometry.components[0].getFirstVertex();if(!r)return;const s=this._editGeometry.coordinateHelper;r.pos=s.pointToVector(o.origin),this._editGeometry.notifyChanges({operation:t,updatedVertices:[r]})}}class $a{constructor(t,e,i,n){this._helper=t,this.dx=e,this.dy=i,this.dz=n}_move(t,e,i,n){this._helper.addDelta(t.pos,e,i,n)}apply(t){this._move(t,this.dx,this.dy,this.dz)}undo(t){this._move(t,-this.dx,-this.dy,-this.dz)}canAccumulate(t){return t instanceof $a}accumulate(t,e){this._move(t,e.dx,e.dy,e.dz)}accumulateParams(t){this.dx+=t.dx,this.dy+=t.dy,this.dz+=t.dz}}var Ka=i(96190);class ja{get plane(){return this._plane}get requiresSplitEdgeLeft(){return!this._left.isOriginalDirection}get requiresSplitEdgeRight(){return!this._right.isOriginalDirection}get edgeDirection(){return this._edgeDirection}constructor(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Xa.IMMEDIATE;this._helper=t,this._planeType=e,this._edge=i,this.distance=n,this._plane=(0,de.vt)(),this._offsetPlane=(0,de.vt)(),this._minDistance=-1/0,this._maxDistance=1/0,this._selectedArrow=1,o===Xa.IMMEDIATE&&this._initialize()}_initialize(){this._initializeNeighbors(),this._initializePlane(),this._initializeDistanceConstraints()}_initializeNeighbors(){const t=this._toXYZ(this._edge.leftVertex.pos),e=this._toXYZ(this._edge.leftVertex.leftEdge?.leftVertex?.pos),i=this._toXYZ(this._edge.rightVertex.pos),n=this._toXYZ(this._edge.rightVertex.rightEdge?.rightVertex?.pos);this._edgeDirection=(0,k.o)((0,g.vt)(),t,i),e?(this._left=this._computeNeighbor(t,e,this._edgeDirection),this._right=this._computeNeighbor(i,n,this._edgeDirection,this._left)):(this._right=this._computeNeighbor(i,n,this._edgeDirection),this._left=this._computeNeighbor(t,e,this._edgeDirection,this._right))}_toXYZ(t){return null!=t?this._helper.toXYZ(t):null}_pointToXYZ(t){return this._toXYZ(this._helper.pointToVector(t))}_computeNeighbor(t,e,i,n){const o=(0,g.vt)();if(e){(0,k.o)(o,t,e);const n=!this._passesBisectingAngleThreshold(o,i);return{start:t,end:e,direction:n?this._bisectVectorsPerpendicular(i,o):o,isOriginalDirection:!n}}return this._helper.hasZ()?n&&((0,k.e)(o,i,n.direction),(0,k.e)(o,o,i),(0,k.n)(o,o),Math.sign(o[1])!==Math.sign(i[0])&&(0,k.h)(o,o,-1)):(0,k.i)(o,-i[1],i[0],0),{start:t,end:e,direction:o,isOriginalDirection:!0}}_passesBisectingAngleThreshold(t,e){const i=Math.abs((0,Ka.g7)(e,t));return i>=Wa&&i<=Math.PI-Wa}_bisectVectorsPerpendicular(t,e){const i=(0,k.f)(t,e)<0?t:(0,k.v)((0,g.vt)(),t),n=Math.abs((0,k.f)(i,e));if(!(n<Ba||n>1-Ba))return this._bisectDirection(i,e);const o=(0,k.e)((0,g.vt)(),i,[0,0,1]);return(0,k.n)(o,o)}_bisectDirection(t,e){const i=(0,k.g)((0,g.vt)(),t,e);return(0,k.n)(i,i)}_initializePlane(){const t=this._computeNormalDirection(this._left),e=this._computeNormalDirection(this._right);(0,k.f)(t,e)<0&&(0,k.v)(e,e),(0,de.O_)(this._left.start,this._bisectDirection(t,e),this._plane)}_computeNormalDirection(t){const e=(0,k.e)((0,g.vt)(),t.direction,this._edgeDirection);(0,k.n)(e,e);const i=(0,k.e)((0,g.vt)(),this._edgeDirection,e);return this._planeType===Ya.XY&&(i[2]=0),(0,k.n)(i,i)}_initializeDistanceConstraints(){null==this._left.end||this.requiresSplitEdgeLeft||this._updateDistanceConstraint((0,de.mN)(this._plane,this._left.end)),null==this._right.end||this.requiresSplitEdgeRight||this._updateDistanceConstraint((0,de.mN)(this._plane,this._right.end)),this._updateIntersectDistanceConstraint(this._plane)}_updateDistanceConstraint(t){t<=0&&(this._minDistance=Math.max(this._minDistance,t)),t>=0&&(this._maxDistance=Math.min(this._maxDistance,t))}_updateIntersectDistanceConstraint(t){const e=(0,de.Qj)(t),i=this._edgeDirection,n=(0,k.g)((0,g.vt)(),this._left.start,this._left.direction),o=(0,k.g)((0,g.vt)(),this._right.start,this._right.direction),r=this._pointInBasis2D((0,f.vt)(),e,i,this._left.start),s=this._pointInBasis2D((0,f.vt)(),e,i,n),a=this._pointInBasis2D((0,f.vt)(),e,i,this._right.start),l=this._pointInBasis2D((0,f.vt)(),e,i,o),[c]=function(t,e){const i=t.start,n=t.end,o=e.start,r=e.end,s=(0,p.Re)(ye,n,i),a=(0,p.Re)(me,r,o),l=_e(s,a);if(Math.abs(l)<=ve)return[];const c=(0,p.Re)(be,i,o),h=_e(a,c)/l,u=_e(s,c)/l;if(h>=0){if(u>=0||e.type===se.LINE)return[(0,p.Ln)(xe,i,s,h)]}else if(t.type===se.LINE&&(u>=0||e.type===se.LINE))return[(0,p.Ln)(xe,i,s,h)];return[]}({start:s,end:r,type:se.LINE},{start:l,end:a,type:se.LINE});if(!c)return;const h=(0,p.Re)((0,f.vt)(),r,s);(0,p.S8)(h,h);const u=(0,p.Re)((0,f.vt)(),c,s),d=(0,p.Om)(h,u),_=(0,k.g)((0,g.vt)(),n,(0,k.h)((0,g.vt)(),this._left.direction,-d)),v=(0,de.mN)(t,_);this._updateDistanceConstraint(v)}_pointInBasis2D(t,e,i,n){return t[0]=(0,Ka.gr)(e,n),t[1]=(0,Ka.gr)(i,n),t}_offset(t,e){Number.isFinite(this._minDistance)&&(e=Math.max(this._minDistance,e)),Number.isFinite(this._maxDistance)&&(e=Math.min(this._maxDistance,e)),(0,de.C)(this._offsetPlane,this._plane),this._offsetPlane[3]-=e;const i=(t,e,i)=>null!=e&&(0,de.U5)(this._offsetPlane,t,(0,k.g)((0,g.vt)(),t,e),i),n=(0,g.vt)();(t===this._edge.leftVertex?i(this._left.start,this._left.direction,n):i(this._right.start,this._right.direction,n))&&this._helper.copy(this._helper.fromXYZ(n,void 0,this._helper.getM(t.pos)),t.pos)}selectArrowFromStartPoint(t){this._selectedArrow=(0,de.Tj)(this.plane,this._pointToXYZ(t))?1:-1}get selectedArrow(){return this._selectedArrow}signedDistanceToPoint(t){return(0,de.mN)(this.plane,this._pointToXYZ(t))}clampedStartAndEnd(t){const e=this._helper.toXYZ(this._helper.pointToVector(t)),i=(0,de._I)(this._plane,e,(0,g.vt)()),n=(0,de.mN)(this._plane,e),o=(0,le.qE)(n,this._minDistance,this._maxDistance);return(0,k.m)(e,i,e,o/n),{start:i,end:e}}apply(t){this._offset(t,this.distance)}undo(t){this._offset(t,0)}canAccumulate(t){return t instanceof ja&&this._edge.leftVertex.index===t._edge.leftVertex.index&&this._edge.rightVertex.index===t._edge.rightVertex.index&&this._edge.component===t._edge.component&&this._maybeEqualsVec3(this._left.direction,t._left.direction)&&this._maybeEqualsVec3(this._right.direction,t._right.direction)&&(0,k.H)((0,de.Qj)(this._plane),(0,de.Qj)(t._plane))}accumulate(t,e){const i=this._plane[3]-e._plane[3]+e.distance;this._offset(t,i)}accumulateParams(t){const e=t.distance-t._plane[3];this.distance=e+this._plane[3]}clone(){const t=new ja(this._helper,this._planeType,this._edge,this.distance,Xa.DEFERRED);return(0,de.C)(t._plane,this._plane),(0,de.C)(t._offsetPlane,this._offsetPlane),t._maxDistance=this._maxDistance,t._minDistance=this._minDistance,t._left=this._cloneNeighbor(this._left),t._right=this._cloneNeighbor(this._right),t._edgeDirection=(0,k.c)((0,g.vt)(),this._edgeDirection),t}_maybeEqualsVec3(t,e){return null==t&&null==e||null!=t&&null!=e&&(0,k.H)(t,e)}_cloneNeighbor(t){let{start:e,end:i,direction:n,isOriginalDirection:o}=t;return{start:(0,k.c)((0,g.vt)(),e),end:null!=i?(0,k.c)((0,g.vt)(),i):null,direction:(0,k.c)((0,g.vt)(),n),isOriginalDirection:o}}}const Wa=(0,le.kU)(15),Ba=.001;var Ya,Xa,Qa;!function(t){t[t.XYZ=0]="XYZ",t[t.XY=1]="XY"}(Ya||(Ya={})),function(t){t[t.IMMEDIATE=0]="IMMEDIATE",t[t.DEFERRED=1]="DEFERRED"}(Xa||(Xa={}));class Ja{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Pa.CUMULATIVE;this.origin=t,this.angle=e,this._accumulationType=i}_rotate(t,e){(0,p.e$)(t.pos,t.pos,this.origin,e)}apply(t){this._rotate(t,this.angle)}undo(t){this._rotate(t,-this.angle)}canAccumulate(t){return t instanceof Ja&&(0,bt.aI)(this.origin,t.origin)}accumulate(t,e){const i=e._accumulationType===Pa.REPLACE;this._rotate(t,i?e.angle-this.angle:e.angle)}accumulateParams(t){const e=t._accumulationType===Pa.REPLACE;this.angle=e?t.angle:this.angle+t.angle}}class tl{constructor(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Pa.CUMULATIVE;this.origin=t,this.axis1=e,this.factor1=i,this.factor2=n,this._accumulationType=o,this.axis2=(0,f.fA)(e[1],-e[0])}_scale(t,e,i){(0,p.Vj)(t.pos,t.pos,this.origin,this.axis1,e),(0,p.Vj)(t.pos,t.pos,this.origin,this.axis2,i)}apply(t){this._scale(t,this.factor1,this.factor2)}undo(t){this._scale(t,1/this.factor1,1/this.factor2)}canAccumulate(t){return t instanceof tl&&(0,bt.aI)(this.origin,t.origin)&&(0,bt.aI)(this.axis1,t.axis1)}accumulate(t,e){e._accumulationType===Pa.REPLACE?this._scale(t,e.factor1/this.factor1,e.factor2/this.factor2):this._scale(t,e.factor1,e.factor2)}accumulateParams(t){const e=t._accumulationType===Pa.REPLACE;this.factor1=e?t.factor1:this.factor1*t.factor1,this.factor2=e?t.factor2:this.factor2*t.factor2}}class el{constructor(t,e){this._editGeometry=t,this._newPositions=e}apply(){const t=null==this._originalPositions?"apply":"redo";if(!this._originalPositions){const t=this._editGeometry.coordinateHelper;this._originalPositions=this._editGeometry.allVertices.map((e=>t.clone(e.pos)))}this._apply(t,this._newPositions)}undo(){this._originalPositions&&this._apply("undo",this._originalPositions)}accumulate(t){return t instanceof el&&(this._newPositions=t._newPositions,this._apply("apply",this._newPositions),!0)}_apply(t,e){const i=this._editGeometry.coordinateHelper,n=this._editGeometry.allVertices;for(let o=0;o<n.length;o++)i.copy(e[o],n[o].pos);this._editGeometry.components.forEach((t=>t.unnormalizeVertexPositions())),this._editGeometry.notifyChanges({operation:t,updatedVertices:n})}}const il=Symbol();class nl{constructor(t){this._operations=[],this._closed=!1,this[Qa]=!0,t&&(this._operations=t,this._closed=!0)}close(){this._closed=!0}apply(){for(const t of this._operations)t.apply()}undo(){for(let t=this._operations.length-1;t>=0;t--)this._operations[t].undo()}accumulate(t){if(this._closed)return!1;const e=this._operations.length?this._operations[this._operations.length-1]:null;return e&&e.accumulate(t)||(this._operations.push(t),t.apply()),!0}}Qa=il;class ol extends ct.A{constructor(t,e){super(),this.data=t,this.viewingMode=e,this._undoStack=[],this._redoStack=[],this._listener=this.data.on("change",(t=>{t.addedVertices&&this.emit("vertex-add",{type:"vertex-add",vertices:t.addedVertices,operation:t.operation}),t.removedVertices&&this.emit("vertex-remove",{type:"vertex-remove",vertices:t.removedVertices,operation:t.operation}),t.updatedVertices&&this.emit("vertex-update",{type:"vertex-update",vertices:t.updatedVertices,operation:t.operation})}))}destroy(){this._listener.remove()}splitEdge(t,e){return this._apply(new Ua(this.data,t,e))}updateVertices(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Sa.ACCUMULATE_STEPS;return this._apply(new Da(this.data,t,e),i)}move(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Sa.ACCUMULATE_STEPS;return Ga(this.data)?this._apply(new qa(this.data,t,e,i),n):this.moveVertices(this.data.allVertices,t,e,i,n)}moveVertices(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Sa.ACCUMULATE_STEPS;return Ga(this.data)?this._apply(new qa(this.data,e,i,n),o):this.updateVertices(t,new $a(this.data.coordinateHelper,e,i,n),o)}scale(t,e,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Sa.ACCUMULATE_STEPS,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Pa.CUMULATIVE;return this.scaleVertices(this.data.allVertices,t,e,i,n,o,r)}scaleVertices(t,e,i,n,o){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Sa.ACCUMULATE_STEPS,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Pa.CUMULATIVE;return this.updateVertices(t,new tl(e,i,n,o,s),r)}rotate(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Sa.ACCUMULATE_STEPS,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Pa.CUMULATIVE;return this.rotateVertices(this.data.allVertices,t,e,i,n)}rotateVertices(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Sa.ACCUMULATE_STEPS,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Pa.CUMULATIVE;return this.updateVertices(t,new Ja(e,i,o),n)}removeVertices(t){return this._apply(new Na(this.data,t,this._minNumVerticesPerType))}appendVertex(t){return 0===this.data.components.length?null:this._apply(new za(this.data,this.data.components[0],t))}setVertexPosition(t,e){return this._apply(new Ha(this.data,t,e))}offsetEdge(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Sa.ACCUMULATE_STEPS;return this.updateVertices([e.leftVertex,e.rightVertex],new ja(this.data.coordinateHelper,t,e,i),n)}trySetGeometry(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Sa.ACCUMULATE_STEPS;const{data:i}=this,{coordinateHelper:n}=i;if(i.type!==t.type||!i.spatialReference.equals(t.spatialReference)||n.hasZ()!==t.hasZ||n.hasM()!==t.hasM||!(0,Rt.It)(i.geometry,t)||Ga(i))return;const o=Array.from(Oa.fromGeometry(t,this.viewingMode).iterateVertices(),(t=>t.pos));return this.setVertexPositions(o,e)}setVertexPositions(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Sa.ACCUMULATE_STEPS;return this._apply(new el(this.data,t),e)}createResetState(){if(Ga(this.data))return this._createResetStateMesh();const t=this.data.geometry.clone();return(0,s.hA)((()=>this.trySetGeometry(t)))}closeComponent(t){return this.data.components.includes(t)?this._apply(new Fa(this.data,t)):null}canRemoveVertex(t){return t.vertices.length>this._minNumVerticesPerType}createUndoGroup(){const t=new nl;return this._apply(t),(0,s.hA)((()=>t.close()))}undo(){if(this._undoStack.length>0){const t=this._undoStack.pop();return t.undo(),this._redoStack.push(t),t}return null}redo(){if(this._redoStack.length>0){const t=this._redoStack.pop();return t.apply(),this._undoStack.push(t),t}return null}get canUndo(){return this._undoStack.length>0}get canRedo(){return this._redoStack.length>0}get lastOperation(){return this._undoStack.length>0?this._undoStack[this._undoStack.length-1]:null}get _minNumVerticesPerType(){switch(this.data.type){case"point":return 1;case"polyline":return 2;case"polygon":return 3;default:return 0}}_apply(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Sa.ACCUMULATE_STEPS)!==Sa.NEW_STEP&&null!=this.lastOperation&&this.lastOperation.accumulate(t)||(t.apply(),this._undoStack.push(t),this._redoStack=[]),t}_createResetStateMesh(){if(!Ga(this.data))return(0,s.hA)();const t=this.data.geometry,{vertexSpace:e}=t;if(e.origin){const i=(0,g.o8)(e.origin);return(0,s.hA)((()=>{t.vertexSpace.origin=i}))}const i=t.vertexAttributes.clonePositional();return(0,s.hA)((()=>{t.vertexAttributes=i,t.vertexAttributesChanged()}))}static fromGeometry(t,e){return new ol(Oa.fromGeometry(t,e),e)}}function rl(t,e){return t.events.on("drag",function(t,e){let i=null,n=null;return o=>{if("cancel"===o.action)return void(null!=n&&(n.execute({action:"cancel"}),i=null,n=null));const r={action:o.action,screenStart:o.start,screenEnd:o.screenPoint};"start"===o.action&&null==i&&(i=new ll,n=new ll,e(t,i,n,o.pointerType,r)),null!=i&&i.execute(r),"end"===o.action&&null!=i&&(i=null,n=null)}}(t,e))}function sl(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0,n=null;const o=null==e||t.spatialReference?.equals(e)?t=>t:t=>null!=t?(0,Ca.project)(t,e):t,r={exclude:[],...i};return e=>{if("start"===e.action&&(n=o(t.toMap(e.screenStart,r))),null==n)return null;const i=o(t.toMap(e.screenEnd,r));return null!=i?{...e,mapStart:n,mapEnd:i}:null}}const al=()=>{};class ll{constructor(){this.execute=al}next(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ll;return null!=t&&(this.execute=i=>{const n=t(i);null!=n&&e.execute(n)}),e}}class cl{constructor(t){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.drawConstraints=null,this.editGeometryOperations=t.editGeometryOperations,this.elevationInfo=t.elevationInfo,this.pointer=t.pointer,this.vertexHandle=t.vertexHandle,this.excludeFeature=t.excludeFeature,this.feature=t.feature,this.visualizer=t.visualizer,this.selfSnappingZ=t.selfSnappingZ,this.drawConstraints=t.drawConstraints}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}}var hl=i(27706);function ul(t){let{predicate:e=()=>!0,snappingManager:i,snappingContext:n,updatingHandles:o,useZ:r=!0}=t;const s=new ll;if(null==i)return{snappingStep:[gl,s],cancelSnapping:gl};let c,h=null,u=null,d=null;const p=()=>{h=(0,a.DC)(h),i.doneSnapping(),u?.frameTask.remove(),u=null,c=(0,a.xt)(c),d=null},f=function(t,e,i){return(0,no.debounce)((async(n,o)=>{let{frameTask:r,point:s,scenePoint:a,context:l,event:c,delta:h,getLastState:u}=n;const d=await r.schedule((()=>t.snap({point:s,scenePoint:a,context:l,signal:o})),o);if(d.valid){let n=await r.schedule((()=>d.apply()),o);const a=u();null!=a.point&&s!==a.point&&(n=t.update({point:a.point,scenePoint:a.scenePoint,context:l})),null!=a.updatePoint&&(0,vt.CI)(n,a.updatePoint)||(fl(c.mapEnd,n,h,e),i.execute(c))}}))}(i,r,s);let g=null,_=null,v=null;return{snappingStep:[t=>{if(!e(t))return t;const{action:s}=t;if("start"===s){const{info:e}=t,o=function(t){return"3d"===t.type?t.resourceController.scheduler.registerTask(hl.W6.SNAPPING):hl.nu}(i.view);if(u=function(t,e,i){return{context:new cl({editGeometryOperations:t.editGeometryOperations,elevationInfo:t.elevationInfo,pointer:t.pointer,vertexHandle:null!=e.info?e.info.handle:null,excludeFeature:t.excludeFeature,feature:t.feature,visualizer:t.visualizer}),originalPos:null!=e.snapOrigin?t.coordinateHelper.vectorToDehydratedPoint(e.snapOrigin):e.mapStart,originalScenePos:null!=e.scenePoints?e.scenePoints.sceneStart:null,frameTask:i}}(n,t,o),u.context.selfSnappingZ=null,!r&&null!=e){const t=function(t,e){if(!t.hasZ())return null;const i=e.vertices;let n=null;for(const o of i){const e=t.getZ(o.pos);if(null!=n&&null!=e&&Math.abs(e-n)>1e-6)return null;null==n&&(n=e)}return n}(n.coordinateHelper,e.handle.component);null!=t&&(u.context.selfSnappingZ={value:t,elevationInfo:n.elevationInfo??y.qt})}}if(null!=u){const{context:e,originalScenePos:n,originalPos:a}=u,{mapEnd:p,mapStart:y,scenePoints:m}=t,b=dl(a,pl(p,y)),x=pl(y,a),M={...t,action:"update"},w=u.context,T=function(t,e){return null==t||null==e?null:dl(t,pl(e.sceneEnd,e.sceneStart))}(n,m),A=i.update({point:b,scenePoint:T,context:e});if(v=A,fl(p,A,x,r),g=b,_=T,"end"!==s){const{frameTask:t}=u;null==h&&(h=new AbortController),d=e=>{o.addPromise((0,no.ignoreAbortErrors)(f({frameTask:t,event:M,context:w,point:b,scenePoint:T,delta:x,getLastState:()=>({point:g,scenePoint:_,updatePoint:e.forceUpdate?null:v})},h.signal)))},d({forceUpdate:!1}),null==c&&(c=(0,l.watch)((()=>i.options.effectiveEnabled),(()=>d?.({forceUpdate:!0}))))}}return"end"===s&&p(),t},s],cancelSnapping:t=>(p(),t)}}function dl(t,e){let[i,n,o]=e;const r=(0,ka.EL)(t);return r.x+=i,r.y+=n,r.hasZ&&(r.z+=o),r}function pl(t,e){const i=t.hasZ&&e.hasZ?t.z-e.z:0;return[t.x-e.x,t.y-e.y,i]}function fl(t,e,i,n){let[o,r,s]=i;t.x=e.x+o,t.y=e.y+r,n&&t.hasZ&&e.hasZ&&(t.z=e.z+s)}function gl(t){return t}let _l=class extends X.A{constructor(t){super(t),this.constrainResult=t=>t,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,no.debounce)((async(t,e,i,n)=>{const o=this._frameTask;if(null==o)return;const r=await o.schedule((()=>e.snap({...t,context:i,signal:n})),n);r.valid&&await o.schedule((()=>{this.stagedPoint=r.apply(),t!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=e.update({...this._snapPoints,context:i}))}),n)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(t){this._stagedPoint=this.constrainResult(t)}initialize(){const t="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=null!=t?t.registerTask(hl.W6.SNAPPING):hl.nu}destroy(){this._abortController=(0,a.DC)(this._abortController),this._frameTask=(0,a.xt)(this._frameTask)}update(t,e,i){this._snapPoints=t;const{point:n,scenePoint:o}=t,r=e.update({point:n,scenePoint:o,context:i});return this.stagedPoint=r,r}async snap(t,e,i){const{point:n,scenePoint:o}=t;return this.stagedPoint=e.update({point:n,scenePoint:o,context:i}),this._snapPoints=t,null==this._abortController&&(this._abortController=new AbortController),this._snap(t,e,i,this._abortController.signal)}async snapAgainNearPreviousMapPoint(t,e){null!=this._snapPoints&&await this.snap(this._snapPoints,t,e)}abort(){this._abortController=(0,a.DC)(this._abortController),this._snapPoints=null}};(0,o._)([(0,c.MZ)({constructOnly:!0})],_l.prototype,"view",void 0),(0,o._)([(0,c.MZ)()],_l.prototype,"stagedPoint",null),(0,o._)([(0,c.MZ)()],_l.prototype,"constrainResult",void 0),(0,o._)([(0,c.MZ)()],_l.prototype,"_stagedPoint",void 0),_l=(0,o._)([(0,h.$)("esri.views.interactive.snapping.SnappingOperation")],_l);i(18288),i(68295),i(42052);Symbol("grid-placement-graphic");var vl;!function(t){t[t.TARGET=0]="TARGET",t[t.REFERENCE=1]="REFERENCE",t[t.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"}(vl||(vl={}));const yl=Symbol("snapping-toggle");const ml=Symbol(),bl=Symbol();let xl=class extends(ct.A.EventedMixin(X.A)){constructor(t){super(t),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new va.A,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new J.U,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=io(dn),this._getPolylineOrPolygonConstraint=io(pn),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new Js,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,null==t.elevationInfo&&(this.elevationInfo=(0,y.bK)(!!t.hasZ))}initialize(){const{geometryType:t,view:e}=this,i=e.spatialReference,n="viewingMode"in e.state?e.state.viewingMode:ma.RT.Local,o="segment"===t||"multipoint"===t?"polyline":t;this.coordinateHelper=Ea(this.hasZ,this.hasM,i),this._editGeometryOperations=new ol(new Oa(o,this.coordinateHelper),n),this._snappingOperation=new _l({view:e}),this.addHandles([(0,l.watch)((()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint})),((t,e)=>{let{stagedPoint:i,constraint:n}=t;const{snappingOptions:o}=this;if(o&&(o.forceDisabled=null!=n&&Li(n)),null!=e&&i===e.stagedPoint&&n!==e.constraint)return this._onKeyboardBasedChange();this._processCursor(i??this._screenToMap(this._stagedScreenPoint))}),{equals:(t,e)=>t.stagedPoint===e.stagedPoint&&(0,a.CM)(t.constraint,e.constraint)}),(0,l.watch)((()=>this.view.viewpoint),((t,e)=>{t&&e&&(0,ya.Ui)(t,e)&&this._onKeyboardBasedChange()}))]),this._activeComponent=new Ia(i,n),this._editGeometryOperations.data.components.push(this._activeComponent);const r=this.segmentLabels;null!=r&&(r.context={view:e,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles((0,l.watch)((()=>this.labelOptions.enabled),(t=>{r.visible=t}),l.syncAndInitial))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],(t=>{const e=t.vertices.map((t=>({componentIndex:0,vertexIndex:t.index,coordinates:this.coordinateHelper.vectorToArray(t.pos)}))),i=e.map((t=>t.coordinates)),n=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getFirstVertex()?.pos)??null;(0,vt.CI)(n,this.firstVertex)||(this.firstVertex=n);const o=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getLastVertex()?.pos)??null;(0,vt.CI)(o,this.lastVertex)||(this.lastVertex=o);const r=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.edges.at(-1)?.leftVertex?.pos)??null;switch((0,vt.CI)(r,this.secondToLastVertex)||(this.secondToLastVertex=r),this._processCursor(this.cursorVertex),t.type){case"vertex-add":this.emit(t.type,{...t,added:i,vertices:e});break;case"vertex-update":this.emit(t.type,{...t,updated:i,vertices:e});break;case"vertex-remove":this.emit(t.type,{...t,removed:i,vertices:e})}})));const s=this._manipulator=new xa({consumesClicks:!1,grabbableForEvent:t=>"click"!==this.drawingMode||"touch"===t.pointerType&&this._snappingEnabled&&1===this._pointerDownStates.size});this.manipulators.add(s),s.grabbable="point"!==t,this.addHandles([s.events.on("immediate-click",(t=>this._onImmediateClick(t))),s.events.on("immediate-double-click",(t=>this._onImmediateDoubleClick(t))),(0,l.watch)((()=>this.drawingMode),(()=>{this.removeHandles(ml),this.addHandles(this._createManipulatorDragPipeline(s),ml)}),l.syncAndInitial),(0,l.watch)((()=>({effectiveCursor:this.effectiveCursor})),(t=>{let{effectiveCursor:e}=t;s.cursor=e}),l.syncAndInitial)]),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};const i=(0,l.watch)((()=>({view:t.view,snappingOptions:t.snappingOptions})),(i=>{let{view:n,snappingOptions:o}=i;if(t.removeHandles(yl),!n||!o)return;const r=Tn.o.TOOL,s=[n.on("key-down",(t=>{t.key!==En||t.repeat||(o.enabledToggled=!0,e())}),r),n.on("key-up",(t=>{t.key===En&&(o.enabledToggled=!1,e())}),r),n.on("pointer-move",(t=>{const i=t.native.ctrlKey;o.enabledToggled!==i&&(o.enabledToggled=i,e())}),r)];t.addHandles(s,yl)}),l.syncAndInitial);t.addHandles(i)}(this,(()=>{const t=this.view.inputManager.latestPointerType??"mouse",e=this._getSnappingContext(t);if(null!=this.snappingManager){const t=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,e);this._updatingHandles.addPromise((0,no.ignoreAbortErrors)(t))}}))}destroy(){(0,a.pR)(this.segmentLabels),(0,a.pR)(this._snappingOperation),this._editGeometryOperations=(0,a.pR)(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){const{_stagedPointerId:t,_manipulator:e}=this;return null!=t&&this._pointerDownStates.has(t)||e.grabbing||!e.interactive}get _snappingEnabled(){return null!=this.snappingManager&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const t=this._updateAndGetEffectiveDrawSurface();return"3d"===this.view.type&&this.drawSurface!==t}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map((t=>this.coordinateHelper.vectorToArray(t.pos)))}get _constraint(){const{constraints:t,constraintsEnabled:e}=this;if(t&&e)switch(this.geometryType){case"point":return this._getPointConstraint(t);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,t)}}set drawingMode(t){this._set("drawingMode",t??ba)}get effectiveCursor(){return this.loading?"progress":this._hideDefaultCursor?null:this.cursor||"crosshair"}get interactive(){return this._manipulator.interactive}set interactive(t){this._manipulator.interactive=t}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return null!=this.snappingManager?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return"mouse"===this._stagedPointerType?this.cursorVertex:null}get committableVertex(){const{cursorVertex:t,lastVertex:e,firstVertex:i,geometryType:n}=this;return"polygon"===n&&(0,vt.fk)(t,i)||(0,vt.fk)(t,e)?null:t}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:t,committableVertex:e,coordinateHelper:i}=this,n=t.slice();return null!=e&&n.push(i.pointToArray(e)),n}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:t}=this;null!=t&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(t))}complete(t){const e=t?.aborted||!1;this._snappingOperation.abort(),this.snappingManager?.doneSnapping();const{geometryType:i,numCommittedVertices:n}=this,o="multipoint"===i&&0===n||"polyline"===i&&n<2||"polygon"===i&&n<3;"segment"!==i&&"point"!==i||this.commitStagedVertex(),this._createOperationCompleted=!o,(this.isCompleted||e)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map(((t,e)=>({componentIndex:0,vertexIndex:e,coordinates:t}))),aborted:e,type:"complete"}))}onInputEvent(t){switch(t.type){case"pointer-down":this._pointerDownStates.add(t.pointerId);break;case"pointer-up":this._pointerDownStates.delete(t.pointerId)}switch(t.type){case"pointer-move":return this._onPointerMove(t);case"hold":return this._onHold(t)}}redo(){this._editGeometryOperations.redo()}undo(){null!=this.snappingManager&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(t){const e=(0,xt.o8)(this.cursorVertex),i=(0,xt.o8)(t),n=i&&(this._updateAndGetEffectiveDrawSurface()?.constrainZ(i)??i),o=this._snapToClosingVertex(n),r=this._applyConstraints(o);(0,vt.fk)(e,r)||(this._set("cursorVertex",r),this.segmentLabels?.set("stagedVertex",null!=r?this.coordinateHelper.pointToVector(r):null),null==r||"mouse"!==this._stagedPointerType?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(r)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(t){if(null==t||this._isDragging||"polygon"!==this.geometryType||this.numCommittedVertices<=2)return t;const e=this._mapToScreen(t);if(!e)return t;const i=this._activeComponent;return this._vertexWithinPointerDistance(i.vertices[0].pos,e)?this.firstVertex:this._vertexWithinPointerDistance(i.vertices.at(-1).pos,e)?this.lastVertex:t}_createManipulatorDragPipeline(t){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(t);case"freehand":return this._createManipulatorDragPipelineFreehand(t);case"hybrid":return this._createManipulatorDragPipelineHybrid(t)}}_createManipulatorDragPipelineClick(t){return rl(t,((t,e,i,n)=>{const o="touch"===n&&this._snappingEnabled;if(this.isCompleted||!o)return;const{snappingStep:r,cancelSnapping:s}=ul({predicate:()=>o,snappingManager:this.snappingManager,snappingContext:new cl({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:n,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});i=i.next((t=>(o&&null!=this.snappingManager&&this.snappingManager.doneSnapping(),t))).next(s),e.next(this._screenToMapDragEventStep()).next((t=>("start"===t.action&&(this._processCursor(t.mapStart),("segment"===this.geometryType||o&&!this.numCommittedVertices)&&this.commitStagedVertex()),t))).next(function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if("2d"===t.type)return t=>t;let n=null;return o=>{"start"===o.action&&(n=t.toMap(o.screenStart,{exclude:i}),null!=n&&(n.z=(0,y.id)(n,t,e)));const r=t.toMap(o.screenEnd,{exclude:i});null!=r&&(r.z=(0,y.id)(r,t,e));const s=null!=n&&null!=r?{sceneStart:n,sceneEnd:r}:null;return{...o,scenePoints:s}}}(this.view,this.elevationInfo)).next(...r).next((t=>(o&&(this._processCursor(t.mapEnd),"end"===t.action&&this.commitStagedVertex()),t))).next((t=>("end"===t.action&&("mouse"!==this._stagedPointerType&&this._snappingOperation.abort(),"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()),t)))}))}_createManipulatorDragPipelineFreehand(t){return rl(t,((t,e)=>{this.isCompleted||e.next(this._screenToMapDragEventStep()).next((t=>("start"===t.action&&(this._snappingOperation.abort(),null==this.committableVertex&&this._processCursor(t.mapStart),"segment"===this.geometryType&&this.commitStagedVertex()),t))).next((t=>{switch(t.action){case"start":case"update":this._processCursor(t.mapEnd),"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":this.complete()}return t}))}))}_createManipulatorDragPipelineHybrid(t){return rl(t,((t,e)=>{this.isCompleted||e.next(this._screenToMapDragEventStep()).next((t=>("start"===t.action&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),bl),this._processCursor(t.mapStart),this.commitStagedVertex()),t))).next((t=>{switch(t.action){case"start":case"update":this._processCursor(t.mapEnd),"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":"mouse"!==this._stagedPointerType&&this._snappingOperation.abort(),this.removeHandles(bl),"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()}return t}))}))}get _drawAtFixedElevation(){const{constraintsEnabled:t,constraintZ:e,geometryType:i,numCommittedVertices:n}=this;return t?null!=e||"segment"===i&&n>0:("segment"===i||"polygon"===i)&&n>0}_updateAndGetEffectiveDrawSurface(){const{constraintsEnabled:t,coordinateHelper:e,drawSurface:i,elevationDrawSurface:n,snapToSceneEnabled:o}=this;if(null==n)return i;if(!this.hasZ)return n.defaultZ=null,n;const r=this.elevationInfo?.mode;let s=this.defaultZ,a=t||"absolute-height"===r;return null!=o&&(a=o),"on-the-ground"===r&&(a=!1),this._drawAtFixedElevation&&(s=(t?this.constraintZ:null)??e.getZ(this._activeComponent.vertices[0].pos),a=!1),a?i:(n.defaultZ=s,n)}_mapToScreen(t){return this._updateAndGetEffectiveDrawSurface()?.mapToScreen(t)}_onHold(t){this._snappingOperation.abort(),"click"===this.drawingMode&&"touch"===t.pointerType&&this._snappingEnabled&&this._processCursor(t.mapPoint),t.stopPropagation()}_onImmediateClick(t){if(!("mouse"===t.pointerType&&2===t.button||this._manipulator.dragging))try{const{drawingMode:e,geometryType:i}=this;this._stagedPointerType=t.pointerType,this._stagedScreenPoint=t.screenPoint;const n=this._screenToMap(t.screenPoint);if(null==n)return;if(null==n||"freehand"===e&&"point"!==i)return;if(this._snappingEnabled&&null!=this.cursorVertex||this._processCursor(n),null==this.committableVertex)return void this.complete();this.commitStagedVertex(),"mouse"!==t.pointerType&&this._processCursor(null),("freehand"===e||"point"===i||"segment"===i&&2===this.numCommittedVertices||"segment"===i&&"hybrid"===e&&1===this.numCommittedVertices)&&this.complete()}finally{t.stopPropagation()}}_onImmediateDoubleClick(t){this._manipulator.dragging||"point"===this.geometryType||(this.complete(),t.stopPropagation())}_onPointerMove(t){const e=(0,u.tc)(t.x,t.y);this._stagedScreenPoint=e,this._stagedPointerType=t.pointerType,this._stagedPointerId=t.pointerId,this._isDragging?this._snappingOperation.abort():(t.stopPropagation(),this._processCursorMovementRelativeToSurface(e,t.pointerType))}_onKeyboardBasedChange(){"mouse"===this._stagedPointerType&&this._stagedScreenPoint&&null!=this._stagedPointerId&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(t,e){const i=this._snappingOperation,n=this._screenToMap(t),o=this._requiresScenePoint?this.drawSurface?.screenToMap(t):null;if(null==n)return this._hideDefaultCursor=!0,this._processCursor(null),void i.abort();this._hideDefaultCursor=!1;const r=this.snappingManager;if(null==r)return this._processCursor(n),void i.abort();const s=this._getSnappingContext(e);this._updatingHandles.addPromise((0,no.ignoreAbortErrors)(i.snap({point:n,scenePoint:o},r,s)))}_applyConstraints(t){const{_constraint:e,constraints:i}=this;if(!t||!i||!e)return t;const{context:n}=i,o=gn(t,n),r=o?e.closestTo(o):void 0;if(!r)return t;const s=_n(r,t,n),a="2d"===this.view.type||"absolute-height"!==n.elevationInfo.mode;return null!=s&&a&&null!=this.constraintZ&&this.hasZ&&(s.z=this.constraintZ),s}_screenToMap(t){return t?this._updateAndGetEffectiveDrawSurface()?.screenToMap(t):null}_screenToMapDragEventStep(){let t=null;return e=>{if("start"===e.action&&(t=this._screenToMap(e.screenStart)),null==t)return null;const i=this._screenToMap(e.screenEnd);return null!=i?{...e,mapStart:t,mapEnd:i}:null}}_vertexWithinPointerDistance(t,e){const i=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(t));return null!=i&&function(t,e,i){const n=t.x-e.x,o=t.y-e.y;return n*n+o*o<=i}(i,e,25)}_getSnappingContext(t){const e=this._drawAtFixedElevation?this.elevationDrawSurface?.defaultZ:null;return new cl({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:t,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:null!=e?{value:e,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};(0,o._)([(0,c.MZ)()],xl.prototype,"_hideDefaultCursor",void 0),(0,o._)([(0,c.MZ)()],xl.prototype,"_stagedPointerId",void 0),(0,o._)([(0,c.MZ)()],xl.prototype,"_isDragging",null),(0,o._)([(0,c.MZ)()],xl.prototype,"_snappingOperation",void 0),(0,o._)([(0,c.MZ)()],xl.prototype,"_snappingEnabled",null),(0,o._)([(0,c.MZ)({constructOnly:!0})],xl.prototype,"graphic",void 0),(0,o._)([(0,c.MZ)()],xl.prototype,"constraintsEnabled",void 0),(0,o._)([(0,c.MZ)()],xl.prototype,"constraints",void 0),(0,o._)([(0,c.MZ)()],xl.prototype,"_constraint",null),(0,o._)([(0,c.MZ)()],xl.prototype,"constraintZ",void 0),(0,o._)([(0,c.MZ)()],xl.prototype,"defaultZ",void 0),(0,o._)([(0,c.MZ)()],xl.prototype,"isDraped",void 0),(0,o._)([(0,c.MZ)({value:ba})],xl.prototype,"drawingMode",null),(0,o._)([(0,c.MZ)({constructOnly:!0})],xl.prototype,"elevationDrawSurface",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0})],xl.prototype,"elevationInfo",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0,type:Js})],xl.prototype,"labelOptions",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0})],xl.prototype,"geometryType",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0})],xl.prototype,"hasM",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0})],xl.prototype,"hasZ",void 0),(0,o._)([(0,c.MZ)()],xl.prototype,"cursor",void 0),(0,o._)([(0,c.MZ)()],xl.prototype,"effectiveCursor",null),(0,o._)([(0,c.MZ)()],xl.prototype,"loading",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0})],xl.prototype,"manipulators",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0})],xl.prototype,"drawSurface",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0})],xl.prototype,"segmentLabels",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0})],xl.prototype,"snappingManager",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0})],xl.prototype,"snappingVisualizer",void 0),(0,o._)([(0,c.MZ)()],xl.prototype,"snapToSceneEnabled",void 0),(0,o._)([(0,c.MZ)({readOnly:!0})],xl.prototype,"cursorVertex",null),(0,o._)([(0,c.MZ)({readOnly:!0})],xl.prototype,"visualizationCursorVertex",null),(0,o._)([(0,c.MZ)()],xl.prototype,"committableVertex",null),(0,o._)([(0,c.MZ)()],xl.prototype,"firstVertex",void 0),(0,o._)([(0,c.MZ)()],xl.prototype,"lastVertex",void 0),(0,o._)([(0,c.MZ)()],xl.prototype,"secondToLastVertex",void 0),(0,o._)([(0,c.MZ)()],xl.prototype,"updating",null),(0,o._)([(0,c.MZ)({constructOnly:!0})],xl.prototype,"view",void 0),xl=(0,o._)([(0,h.$)("esri.views.draw.DrawOperation")],xl);class Ml{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.view=t,this.hasZ=e,this.defaultZ=i,this.mapToScreen=e=>t.toScreen(e),this.screenToMap=e?e=>{const n=t.toMap(e);return n.z=i,n}:e=>t.toMap(e)}constrainZ(t){const{defaultZ:e}=this;return this.hasZ&&t.z!==e&&((t=(0,ka.EL)(t)).z=e),t}}class wl{screenToMap(t){const{x:e,y:i}=t;return new z.A({x:e,y:i,spatialReference:wl.spatialReference})}mapToScreen(t){return(0,u.tc)(t.x,t.y)}constrainZ(t){return t}}wl.spatialReference=new N.A;let Tl=class extends da{constructor(t){super(t),this._visualElementGraphics={regularVertices:null,activeVertex:null,activeEdge:null},this.activeFillSymbol=null,this.type="draw-2d",this._visualElementSymbols={outline:t.activeLineSymbol??K,regularVertices:t.regularVerticesSymbol??j,activeVertex:t.activeVertexSymbol??W,fill:t.activeFillSymbol},t.activeVertexSymbol||this.addHandles((0,l.watch)((()=>this.view?.effectiveTheme?.accentColor),(t=>{if(!t)return;const e=this._visualElementSymbols.activeVertex.clone().set({color:t});this._visualElementGraphics.activeVertex?.set("symbol",e),this._visualElementSymbols={...this._visualElementSymbols,activeVertex:e}}),l.initial))}normalizeCtorArgs(t){const e={...t};return delete e.activeFillSymbol,delete e.activeVertexSymbol,delete e.regularVerticesSymbol,delete e.activeLineSymbol,e}initializeGraphic(t){return null!=this._visualElementSymbols.fill&&(t.symbol=this._visualElementSymbols.fill),this.internalGraphicsLayer.graphics.sort(Al),(0,s.hA)()}makeDrawOperation(){const{defaultZ:t,hasZ:e,view:i}=this;return this._createOrUpdateGraphic(null),new xl({view:i,manipulators:this.manipulators,geometryType:ga(this.geometryType),drawingMode:this.mode,hasZ:e,defaultZ:t,snapToSceneEnabled:this.snapToScene,drawSurface:new Ml(i,e,t),hasM:!1,snappingManager:this.snappingManager,snappingVisualizer:new q(this.internalGraphicsLayer),graphic:this.graphic,cursor:this.cursor,constraintsEnabled:!0})}onActiveVertexChanged(t){if("point"===this.geometryType)return(0,s.hA)();const[e,i]=t,n=new z.A({x:e,y:i,spatialReference:this.view.spatialReference});return null!=this._visualElementGraphics.activeVertex?(this._visualElementGraphics.activeVertex.geometry=n,(0,s.hA)()):(this._visualElementGraphics.activeVertex=new r.default({geometry:n,symbol:this._visualElementSymbols.activeVertex,attributes:{displayOrder:2}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeVertex),this.internalGraphicsLayer.graphics.sort(Al),(0,s.hA)((()=>{null!=this._visualElementGraphics.activeVertex&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeVertex),this._visualElementGraphics.activeVertex=(0,a.pR)(this._visualElementGraphics.activeVertex))})))}onCursorEdgeChanged(t){return null!=this._visualElementGraphics.activeEdge?(this._visualElementGraphics.activeEdge.geometry=t,(0,s.hA)()):(this._visualElementGraphics.activeEdge=new r.default({geometry:t,symbol:this._visualElementSymbols.outline,attributes:{displayOrder:0}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeEdge),this.internalGraphicsLayer.graphics.sort(Al),(0,s.hA)((()=>{null!=this._visualElementGraphics.activeEdge&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeEdge),this._visualElementGraphics.activeEdge=(0,a.pR)(this._visualElementGraphics.activeEdge))})))}onRegularVerticesChanged(t){const e=new Ft.A({points:t,spatialReference:this.view.spatialReference});return null!=this._visualElementGraphics.regularVertices?(this._visualElementGraphics.regularVertices.geometry=e,(0,s.hA)()):(this._visualElementGraphics.regularVertices=new r.default({geometry:e,symbol:this._visualElementSymbols.regularVertices,attributes:{displayOrder:1}}),this.internalGraphicsLayer.add(this._visualElementGraphics.regularVertices),this.internalGraphicsLayer.graphics.sort(Al),(0,s.hA)((()=>{null!=this._visualElementGraphics.regularVertices&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.regularVertices),this._visualElementGraphics.regularVertices=(0,a.pR)(this._visualElementGraphics.regularVertices))})))}};function Al(t,e){return(t.attributes?.displayOrder??-1/0)-(e.attributes?.displayOrder??-1/0)}(0,o._)([(0,c.MZ)()],Tl.prototype,"activeFillSymbol",void 0),(0,o._)([(0,c.MZ)({readOnly:!0})],Tl.prototype,"type",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0,nonNullable:!0})],Tl.prototype,"view",void 0),Tl=(0,o._)([(0,h.$)("esri.views.2d.interactive.editingTools.draw.DrawGraphicTool2D")],Tl);var El,Sl=i(29632);class Pl{get hovering(){return this.someManipulator((t=>t.hovering))}get grabbing(){return this.someManipulator((t=>t.grabbing))}get dragging(){return this.someManipulator((t=>t.dragging))}hasManipulator(t){return this.someManipulator((e=>e===t))}someManipulator(t){let e=!1;return this.forEachManipulator((i=>{!e&&t(i)&&(e=!0)})),e}}!function(t){t[t.TRANSLATE_XY=0]="TRANSLATE_XY",t[t.SCALE=1]="SCALE",t[t.ROTATE=2]="ROTATE"}(El||(El={}));var Cl=i(64232),kl=i(84202),Rl=i(731);function Zl(t){let e=0,i=0,n=0;return t?("cim"===t.type&&t.data.symbol&&"symbolLayers"in t.data.symbol&&t.data.symbol.symbolLayers&&t.data.symbol.symbolLayers.map((t=>{"CIMVectorMarker"===t.type&&t.anchorPoint&&(Math.abs(t.anchorPoint.x)>e&&(e=t.anchorPoint.x),Math.abs(t.anchorPoint.y)>i&&(i=t.anchorPoint.y),null!=t.size&&t.size>n&&(n=t.size))})),e=(0,u.Lz)(e),i=(0,u.Lz)(i),n=(0,u.Lz)(n),{offsetX:e,offsetY:i,size:n}):{offsetX:e,offsetY:i,size:n}}var Vl=i(55754);let Il=class extends X.A{set graphic(t){this._circleCollisionCache=null,this._originalSymbol=t.symbol,this._set("graphic",t),this.attachSymbolChanged()}get elevationInfo(){const{layer:t}=this.graphic,e=t&&"elevationInfo"in t?t.elevationInfo:null,i=(0,y.ky)(this.graphic),n=e?e.offset:0;return new Rl.A({mode:i,offset:n})}set focusedSymbol(t){t!==this._get("focusedSymbol")&&(this._set("focusedSymbol",t),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(t){t!==this._get("grabbing")&&(this._set("grabbing",t),this._updateGraphicSymbol())}set hovering(t){t!==this._get("hovering")&&(this._set("hovering",t),this._updateGraphicSymbol())}set selected(t){t!==this._get("selected")&&(this._set("selected",t),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:t?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}constructor(t){super(t),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.consumesClicks=!0,this.events=new ct.A.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(t){const e=this.graphic;if(!1===e.visible)return null;const i=e.geometry;if(null==i)return null;const n=this._get("focusedSymbol"),o=null!=n?n:e.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,t,i,o):this._intersectDistance3D(this.view,t,e)}attach(){this.attachSymbolChanged(),null!=this.layer&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),null!=this.layer&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=(0,l.watch)((()=>this.graphic?.symbol),(t=>{null!=t&&t!==this.focusedSymbol&&t!==this._originalSymbol&&(this._originalSymbol=t,this._focused&&null!=this.focusedSymbol&&(this.graphic.symbol=this.focusedSymbol))}),l.sync)}detachSymbolChanged(){null!=this._graphicSymbolChangedHandle&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}onElevationChange(){}onViewChange(){}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&null!=this.focusedSymbol?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(t,e,i,n){if(null==(n=n||(0,kl.SF)(i)))return null;let o=this._circleCollisionCache;if("point"===i.type&&"cim"===n.type&&"CIMPointSymbol"===n.data.symbol?.type&&n.data.symbol.symbolLayers){const{offsetX:o,offsetY:r,size:s}=Zl(n),a=(0,u.WA)(e,Ll),l=s/2,c=t.toScreen(i),h=c.x+o,d=c.y+r;return(0,p.hG)(a,[h,d])<l*l?1:null}if("point"!==i.type||"simple-marker"!==n.type)return(0,Vl.t)(e,i,t)?1:null;if(null==o||!o.originalPoint.equals(i)){const e=i,r=t.spatialReference;if((0,Ca.canProjectWithoutEngine)(e.spatialReference,r)){const t=(0,Ca.project)(e,r);o={originalPoint:e.clone(),mapPoint:t,radiusPx:(0,u.Lz)(n.size)},this._circleCollisionCache=o}}if(null!=o){const i=(0,u.WA)(e,Ll),r=t.toScreen?.(o.mapPoint);if(!r)return null;const s=o.radiusPx,a=r.x+(0,u.Lz)(n.xoffset),l=r.y-(0,u.Lz)(n.yoffset);return(0,p.hG)(i,[a,l])<s*s?1:null}return null}_intersectDistance3D(t,e,i){const n=t.toMap(e,{include:[i]});return n&&(0,Cl.g)(n,Ol,t.renderSpatialReference)?(0,k.j)(Ol,t.state.camera.eye):null}};(0,o._)([(0,c.MZ)({constructOnly:!0,nonNullable:!0})],Il.prototype,"graphic",null),(0,o._)([(0,c.MZ)()],Il.prototype,"elevationInfo",null),(0,o._)([(0,c.MZ)({constructOnly:!0,nonNullable:!0})],Il.prototype,"view",void 0),(0,o._)([(0,c.MZ)({value:null})],Il.prototype,"focusedSymbol",null),(0,o._)([(0,c.MZ)({constructOnly:!0})],Il.prototype,"layer",void 0),(0,o._)([(0,c.MZ)()],Il.prototype,"interactive",void 0),(0,o._)([(0,c.MZ)()],Il.prototype,"selectable",void 0),(0,o._)([(0,c.MZ)()],Il.prototype,"grabbable",void 0),(0,o._)([(0,c.MZ)({value:!1})],Il.prototype,"grabbing",null),(0,o._)([(0,c.MZ)()],Il.prototype,"dragging",void 0),(0,o._)([(0,c.MZ)()],Il.prototype,"hovering",null),(0,o._)([(0,c.MZ)({value:!1})],Il.prototype,"selected",null),(0,o._)([(0,c.MZ)()],Il.prototype,"cursor",void 0),Il=(0,o._)([(0,h.$)("esri.views.interactive.GraphicManipulator")],Il);const Ol=(0,g.vt)(),Ll=(0,u.gs)();class Gl extends Pl{constructor(t){super(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._manipulator=this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphic=null}forEachManipulator(t){t(this._manipulator,El.TRANSLATE_XY)}createDragPipeline(t,e){let i=null,n=null,o=0,r=0,s=0;const{offsetX:a,offsetY:l,size:c}=Zl(this._graphic.symbol);return rl(this._manipulator,((h,u)=>{u.next((e=>{if("start"===e.action){const e=t();i=e.editGeometryOperations,n=e.constraints}return e})).next(sl(this._view)).next((t=>{const{x:h,y:u,z:d}=t.mapEnd;if(n&&(h+a<n.xmin||u+l-c<n.ymin||h+a>n.xmax||u+l-c>n.ymax))return t;("start"===t.action||0===o&&0===r&&0===s)&&(o=t.mapStart.x,r=t.mapStart.y,s=t.mapStart.z);const p=h-o,f=u-r,g=d-s;o=h,r=u,s=d;const _="start"===t.action?Sa.NEW_STEP:Sa.ACCUMULATE_STEPS,v=i.move(p,f,g,_);return e(t,v),t}))}))}_createManipulator(){const t=this._view,e=this._graphic;return new Il({view:t,graphic:e,selectable:!0,cursor:"move"})}}const zl="ArrowUp",Dl="ArrowDown",Nl="ArrowLeft",Ul="ArrowRight",Hl="t",Fl="Shift",ql=An.i,$l=new T.A("#009af2");let Kl=class extends Xs{constructor(t){super(t),this._isOpacityToggled=!1,this._isModifierActive=!1,this._factor=1,this._initialControlPoints=null,this._graphicsLayer=new _t.A({internal:!0,listMode:"hide",visible:!1,effect:"drop-shadow(0px, 0px, 3px)"}),this._undoStack=[],this._redoStack=[],this._sharedUndoStack=[],this._sharedRedoStack=[],this._highlightHandle=null,this.activeHandle=0,this.type="reshape"}initialize(){this._initialize()}destroy(){const{map:t}=this.view;this._controlPointManipulations.forEach((t=>t.destroy())),this._controlPointEditGeometryOperations.forEach((t=>t.destroy())),t.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,a.pR)(this._graphicsLayer),this._georeference=null,this._controlPointGraphics=null,this._controlPointManipulations=null,this._graphicsLayer=null,this._controlPointEditGeometryOperations=null,this._undoStack=null,this._redoStack=null,this._initialControlPoints=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _hasValidSpatialReference(){return(0,Zt.fn)(this.view.spatialReference)}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){const t=this._undoStack[this._undoStack.length-1];return null!=t&&this._controlPointEditGeometryOperations[t].canUndo}canRedo(){const t=this._redoStack[this._redoStack.length-1];return null!=t&&this._controlPointEditGeometryOperations[t].canRedo}undo(){if(this._undoStack.length>0){const t=this._undoStack.pop();this._controlPointEditGeometryOperations[t].undo(),this.updateGraphics(),this._redoStack.push(t)}}redo(){if(this._redoStack.length>0){const t=this._redoStack.pop();this._controlPointEditGeometryOperations[t].redo(),this.updateGraphics(),this._undoStack.push(t)}}refresh(){const{mediaElement:t}=this;if(null==t.georeference)return;const e=t.georeference;"control-points"===e.type&&null!=e.coords&&(this._georeference=e,this._georeference.controlPoints.forEach(((t,e)=>{let{mapPoint:i}=t;const n=this._controlPointEditGeometryOperations[e],o=n.data.components[0].vertices[0];n.setVertexPosition(o,n.data.coordinateHelper.pointToVector(i))})),this.updateGraphics())}reset(){this._georeference.controlPoints=this._initialControlPoints,this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const t=this._georeference,e=t.controlPoints,i=e[0].mapPoint.spatialReference,n=this._hasValidSpatialReference;this._georeference.controlPoints=this._controlPointEditGeometryOperations.map(((o,r)=>{const s=o.data.geometry;return this._controlPointGraphics[r].geometry=s,{mapPoint:(0,Ca.project)(s,i),sourcePoint:n?e[r].sourcePoint:t.toSource(s)}}))}updateActiveHandle(t){if(this.activeHandle===t)return;const e=this._controlPointGraphics[this.activeHandle].symbol.clone();(0,Sl.Fe)(e,this.view.effectiveTheme.accentColor),this._controlPointGraphics[this.activeHandle].symbol=e;const i=this._controlPointGraphics[t].symbol.clone();(0,Sl.Fe)(i,$l),this._controlPointGraphics[t].symbol=i,this.activeHandle=t,this.view.surface===document.activeElement&&this.highlightActiveHandle()}async highlightActiveHandle(){this.removeHighlightActiveHandle();const t=await this.view.whenLayerView(this._graphicsLayer);this._highlightHandle=t.highlight(this._controlPointGraphics[this.activeHandle])}removeHighlightActiveHandle(){this._highlightHandle&&this._highlightHandle.remove()}setSharedUndoStack(t){this._sharedUndoStack=t}setSharedRedoStack(t){this._sharedRedoStack=t}async _initialize(){const{view:t,mediaElement:e}=this;if(null==e.georeference)return;const i=e.georeference;"control-points"===i.type&&null!=i.coords&&(this._georeference=i,this._initialControlPoints=this._georeference.controlPoints,t.map.addMany([this._graphicsLayer]),t.focus(),this.visible=!1,this.finishToolCreation(),await this._loadProjectionEngine(),this._controlPointEditGeometryOperations=this._georeference.controlPoints.map((e=>{let{mapPoint:i}=e;return ol.fromGeometry((0,Ca.project)(i,t.spatialReference),ma.RT.Local)})),this._controlPointGraphics=this._controlPointEditGeometryOperations.map(((t,e)=>new r.default({symbol:new U.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,colorLocked:!0,anchorPoint:{x:0,y:-15.75},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:9,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:84.3,ymax:84.3},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[83.2,32.5],[84.3,40.7],[83.8,48.9],[81.7,56.9],[78.1,64.3],[73,70.9],[66.9,76.4],[59.7,80.5],[51.9,83.2],[43.7,84.3],[35.4,83.8],[27.4,81.7],[20,78],[13.4,73],[7.9,66.8],[3.8,59.7],[1.1,51.9],[0,43.7],[.5,35.4],[2.6,27.4],[6.3,20],[11.3,13.4],[17.5,7.9],[24.7,3.8],[32.5,1.1],[39.8,.1],[47.1,.3],[54.3,1.8],[61.1,4.5],[67.4,8.4],[72.9,13.3],[77.4,19.1],[80.9,25.5],[83.2,32.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[84.3,0],[84.3,84.3],[0,84.3],[0,0]]]}},rotation:0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-11.25},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:22.5,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:197.7,ymax:294.7},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[98.9,0],[119.4,23.2],[139.4,49.3],[156.8,75.2],[171.2,100.8],[182.4,125.3],[190.6,148.8],[195.7,171.4],[197.7,192.9],[197.7,195.8],[197.7,200.3],[197.6,202.5],[197.5,204.8],[197.3,207.1],[197,209.4],[196.7,211.7],[196.4,214.1],[196,216.4],[195.5,218.7],[195,221.1],[194.4,223.4],[193.7,225.8],[193,228.1],[192.2,230.5],[191.4,232.8],[190.5,235.1],[189.5,237.5],[188.5,239.7],[187.4,242],[186.2,244.3],[185,246.5],[183.7,248.7],[182.4,250.9],[181,253.1],[179.5,255.2],[178,257.3],[176.4,259.4],[174.7,261.4],[173.1,263.3],[171.3,265.3],[169.5,267.2],[167.7,269],[165.8,270.8],[163.9,272.5],[161.9,274.2],[159.9,275.8],[157.8,277.4],[155.7,278.9],[153.6,280.4],[151.4,281.7],[149.2,283.1],[147,284.4],[144.8,285.6],[142.5,286.7],[140.3,287.8],[138,288.8],[135.7,289.8],[133.4,290.7],[131,291.5],[128.7,292.3],[126.4,293],[124,293.6],[121.7,294.2],[119.4,294.7],[117,295.2],[114.7,295.6],[112.4,296],[110.1,296.3],[107.8,296.5],[105.5,296.7],[103.3,296.8],[101.1,296.9],[98.8,296.9],[83.1,295.7],[67.8,292],[53.3,285.9],[39.9,277.5],[28.1,267.2],[18,255.1],[10,241.5],[4.2,226.9],[.9,211.5],[0,195.8],[.1,192.9],[2.1,171.4],[7.2,148.8],[15.4,125.3],[26.6,100.8],[41,75.2],[58.4,49.3],[78.4,23.2],[98.9,0]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:e===this.activeHandle?$l.toArray():this.view.effectiveTheme.accentColor.toArray()}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[197.7,0],[197.7,294.7],[0,294.7],[0,0]]]}},rotation:0}],haloSize:1,scaleX:1,angleAlignment:"Display",angle:0}}}),geometry:t.data.geometry}))),this._graphicsLayer.graphics.addMany([...this._controlPointGraphics]),this._controlPointManipulations=this._controlPointGraphics.map((e=>new Gl({tool:this,view:t,graphic:e}))),this.addHandles([...this._controlPointManipulations.map(((t,e)=>t.createDragPipeline(this._getInfo.bind(this,e),((t,i)=>{"start"===t.action&&(this._undoStack.push(e),this._redoStack=[],this._sharedUndoStack.push({tool:this,operation:i}),this._sharedRedoStack.length=0),this.updateGraphics()})))),(0,l.watch)((()=>this.view.scale),(()=>this.active?this.updateGraphics():null))]),this._controlPointManipulations.forEach(((t,e)=>{t.forEachManipulator((t=>{this.addHandles([t.events.on(["click","grab-changed"],(t=>this.updateActiveHandle(e)))])}))})),this.addHandles([t.on("key-down",(i=>{t.activeTool===this&&(i.key!==Fl||i.repeat||(this._isModifierActive=!0,i.stopPropagation()),i.key!==Hl||i.repeat||(e.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled,i.stopPropagation()),i.key!==ql||i.repeat||(this._factor=10,i.stopPropagation()),this._isModifierActive&&(i.key===zl&&(this._move(0,this._factor),i.stopPropagation()),i.key===Dl&&(this._move(0,-this._factor),i.stopPropagation()),i.key===Nl&&(this._move(-this._factor,0),i.stopPropagation()),i.key===Ul&&(this._move(this._factor,0),i.stopPropagation())))})),t.on("key-up",(e=>{t.activeTool===this&&(e.key===Fl&&(this._isModifierActive=!1,e.stopPropagation()),e.key===ql&&(this._factor=1,e.stopPropagation()))}))]))}async _loadProjectionEngine(){const t=this._georeference.controlPoints[0].mapPoint;return(0,Ca.initializeProjection)(t.spatialReference,this.view.spatialReference)}_getInfo(t){return{editGeometryOperations:this._controlPointEditGeometryOperations[t],constraints:this._hasValidSpatialReference?null:{xmin:0,ymin:0,xmax:this._georeference.width,ymax:this._georeference.height}}}_move(t,e){const i=this._controlPointEditGeometryOperations[this.activeHandle].move(t*this.view.resolution,e*this.view.resolution,0,Sa.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:i}),this._sharedRedoStack.length=0,this.updateGraphics()}};(0,o._)([(0,c.MZ)()],Kl.prototype,"_hasValidSpatialReference",null),(0,o._)([(0,c.MZ)()],Kl.prototype,"activeHandle",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0,nonNullable:!0})],Kl.prototype,"mediaElement",void 0),(0,o._)([(0,c.MZ)({readOnly:!0})],Kl.prototype,"type",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0})],Kl.prototype,"view",void 0),Kl=(0,o._)([(0,h.$)("esri.views.2d.interactive.editingTools.ControlPointsTransformTool")],Kl);var jl=i(59784),Wl=i(79650),Bl=i(88321);function Yl(t,e){"start"===t.action?e.cursor="grabbing":e.cursor="grab"}class Xl{constructor(){this._lastDragEvent=null,this.next=new ll,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&null!=this._lastDragEvent){const e={...this._lastDragEvent,action:"update"};t&&this._adjustScaleFactors(e),this.next.execute(e)}this._enabled=t}createDragEventPipelineStep(){return this._lastDragEvent=null,t=>(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled&&this._adjustScaleFactors(t),t)}_adjustScaleFactors(t){const e=0!==t.direction[0]&&0!==t.direction[1]?Math.max(Math.abs(t.factor1),Math.abs(t.factor2)):0===t.direction[0]?Math.abs(t.factor2):Math.abs(t.factor1);t.factor1=t.factor1<0?-e:e,t.factor2=t.factor2<0?-e:e}}class Ql{constructor(){this._lastDragEvent=null,this.next=new ll,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&null!=this._lastDragEvent){const e={...this._lastDragEvent,action:"update"};t&&this._adjustRotateAngle(e),this.next.execute(e)}this._enabled=t}createDragEventPipelineStep(){return this._lastDragEvent=null,t=>(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled&&this._adjustRotateAngle(t),t)}_adjustRotateAngle(t){const e=(0,le.KJ)(t.rotateAngle);t.rotateAngle=(0,le.kU)(5*Math.round(e/5))}}i(2413),i(65391);function Jl(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o=Math.atan2(e.y-i.y,e.x-i.x)-Math.atan2(t.y-i.y,t.x-i.x),r=Math.atan2(Math.sin(o),Math.cos(o));return n?r:(0,le.KJ)(r)}var tc=i(75762);function ec(t,e){return ic(t,e,!1)}function ic(t,e,i){if(t instanceof Da){if(t.operation instanceof $a)return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=i?-1:1,o=(0,g.fA)(n*t.dx,n*t.dy,n*t.dz);(0,k.g)(e.origin,e.origin,o),(0,Wl.u)(e)}(t.operation,e,i),!0;if(t.operation instanceof Ja)return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=i?-t.angle:t.angle;(0,k.K)(e.basis1,e.basis1,g.uY,n),(0,k.K)(e.basis2,e.basis2,g.uY,n),(0,Wl.u)(e)}(t.operation,e,i),!0;if(t.operation instanceof tl)return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=i?1/t.factor1:t.factor1,o=i?1/t.factor2:t.factor2;(0,k.h)(e.basis1,e.basis1,n),(0,k.h)(e.basis2,e.basis2,o),(0,p.Vj)(e.origin,e.origin,t.origin,t.axis1,n),(0,p.Vj)(e.origin,e.origin,t.origin,t.axis2,o),(0,Wl.u)(e)}(t.operation,e,i),!0}return!1}class nc extends Pl{constructor(t){super(),this._handles=new Bl.A,this._originCache=(0,g.vt)(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._snapRotation=t.snapRotation,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",(t=>Yl(t,this._manipulator)))]),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this._handles.destroy(),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._snapRotation=null,this._graphic=null,this._handles=null,this._originCache=null}forEachManipulator(t){t(this._manipulator,El.ROTATE)}createDragPipeline(t,e){let i=null,n=null;return rl(this._manipulator,((o,r)=>{r.next((e=>{if("start"===e.action){o.cursor="grabbing";const e=t();i=e.plane,n=e.editGeometryOperations}return e})).next(sl(this._view)).next((t=>({...t,rotateAngle:Jl(t.mapStart,t.mapEnd,{x:i.origin[0],y:i.origin[1]},!0)}))).next(this._snapRotation.createDragEventPipelineStep(),this._snapRotation.next).next((t=>{const o=(0,k.c)(this._originCache,i.origin),r="start"===t.action?Sa.NEW_STEP:Sa.ACCUMULATE_STEPS,s=n.rotate(o,t.rotateAngle,r,Pa.REPLACE);return ec(s,i),e(t,s),t})).next((t=>("end"===t.action&&(o.cursor="grab"),t)))}))}_createManipulator(){const t=this._view,e=this._graphic;return new Il({view:t,graphic:e,selectable:!0,cursor:"grab"})}}const oc=1e-6;function rc(t){const e=(0,k.l)(t.basis1),i=(0,k.l)(t.basis2);return.3*Math.min(e,i)}class sc extends Pl{constructor(t){super(),this._handles=new Bl.A,this._planeStart=(0,Wl.a)(),this._displayPlaneStart=(0,Wl.a)(),this._originCache=(0,g.vt)(),this._axisCache=(0,f.vt)(),this._renderStartCache=(0,g.vt)(),this._renderEndCache=(0,g.vt)(),this._resizeOriginCache=(0,g.vt)(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._direction=t.direction,this._preserveAspectRatio=t.preserveAspectRatio,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",(t=>Yl(t,this._manipulator)))]),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this._handles.destroy(),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._graphic=null,this._manipulator=null,this._direction=null,this._handles=null,this._planeStart=null,this._displayPlaneStart=null,this._originCache=null,this._axisCache=null,this._renderStartCache=null,this._renderEndCache=null,this._resizeOriginCache=null,this._preserveAspectRatio=null}forEachManipulator(t){t(this._manipulator,El.SCALE)}createDragPipeline(t,e){let i=null,n=null,o=null,r=0,s=null,a=null;const l=this._planeStart,c=this._displayPlaneStart,h=this._direction;return rl(this._manipulator,((u,d)=>{d.next((e=>{if("start"===e.action){u.cursor="grabbing";const e=t();i=e.plane,n=e.displayPlane,o=e.editGeometryOperations,r=10*this._view.resolution,(0,Wl.c)(i,l),(0,Wl.c)(n,c);const a=(0,Zt.Vp)(o.data.spatialReference);s=a?a.valid[1]-a.valid[0]-30*this._view.resolution:null}return e})).next(sl(this._view)).next((t=>{const e=(0,k.c)(this._renderStartCache,[t.mapStart.x,t.mapStart.y,0]),i=(0,k.c)(this._renderEndCache,[t.mapEnd.x,t.mapEnd.y,0]),o=(0,k.c)(this._resizeOriginCache,c.origin);(0,k.b)(o,o,c.basis1,-h[0]),(0,k.b)(o,o,c.basis2,-h[1]),(0,k.d)(i,i,o),(0,k.d)(e,e,o);const s=0!==h[0]&&0!==h[1],a=rc(c),l=rc(n)/a,u=(t,n)=>{if(0===t)return 1;let o=(0,k.l)(n),a=.5*t*(0,k.f)(n,i)/o;const c=a<0?-1:1;s&&(a+=(o-.5*t*(0,k.f)(n,e)/o)*c*l);const h=o<1.5*r?1:oc;return o=Math.max(o-r,oc),c>0&&(a-=10*this._view.resolution),c*Math.max(c*(a/o),h)},d=u(h[0],c.basis1),p=u(h[1],c.basis2);return{...t,direction:h,factor1:d,factor2:p}})).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next((t=>{const n=(0,k.c)(this._originCache,l.origin);(0,k.b)(n,n,l.basis1,-h[0]),(0,k.b)(n,n,l.basis2,-h[1]);const r=(0,p.hZ)(this._axisCache,l.basis1[0],l.basis1[1]);(0,p.S8)(r,r);const c=o.data.allVertices,u="start"===t.action?Sa.NEW_STEP:Sa.ACCUMULATE_STEPS,d=o.scaleVertices(c,n,r,t.factor1,t.factor2,u,Pa.REPLACE);return s&&s<o.data.geometry.extent.width&&a?o.updateVertices(c,a):((0,Wl.c)(l,i),ec(d,i),a=d.operation,e(t,d)),t})).next((t=>("end"===t.action&&(u.cursor="grab"),t)))}))}_createManipulator(){return new Il({view:this._view,graphic:this._graphic,selectable:!0,cursor:"grab"})}}function ac(t){return"graphic"===t?.type}var lc=i(11500),cc=i(86875);An.i;const hc=[[1,1],[1,-1],[-1,-1],[-1,1],[1,0],[0,-1],[-1,0],[0,1]];let uc=class extends Xs{constructor(t){super(t),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._planeCache=(0,Wl.a)(),this._displayPlaneCache=(0,Wl.a)(),this._mainAxisCache=(0,f.vt)(),this._rotationHandleCache=(0,g.vt)(),this._cornerA=(0,g.vt)(),this._cornerB=(0,g.vt)(),this._cornerC=(0,g.vt)(),this._cornerD=(0,g.vt)(),this._avgAB=(0,g.vt)(),this._avgBC=(0,g.vt)(),this._avgCD=(0,g.vt)(),this._avgDA=(0,g.vt)(),this._preserveAspectRatio=new Xl,this._snapRotation=new Ql,this._graphicsLayer=new _t.A({internal:!0,listMode:"hide",visible:!1}),this._sharedUndoStack=[],this._sharedRedoStack=[],this._isOpacityToggled=!1,this._factor=1,this.preserveAspectRatio=null,this.snapRotation=null,this.type="transform"}initialize(){this._initialize()}destroy(){const{map:t}=this.view;this._dragManipulation.destroy(),this._rotateManipulation.destroy(),this._scaleManipulations.forEach((t=>t.destroy())),this._editGeometryOperations.destroy(),t.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,a.pR)(this._graphicsLayer),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._preserveAspectRatio=null,this._snapRotation=null,this._planeCache=null,this._displayPlaneCache=null,this._rotationHandleCache=null,this._mainAxisCache=null,this._cornerA=null,this._cornerB=null,this._cornerC=null,this._cornerD=null,this._avgAB=null,this._avgBC=null,this._avgCD=null,this._avgDA=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _plane(){const t=this._graphic.geometry;if(null==t)return null;const e=this._editGeometryOperations.data,i=e.components[0].edges[0],n=(0,p.Re)(this._mainAxisCache,i.leftVertex.pos,i.rightVertex.pos);(0,p.S8)(n,n);let o=80*this.view.resolution;const r=this.view.spatialReference;return(0,Zt.aI)(r,t.spatialReference)&&(o*=(0,Mt.GA)(r)/(0,Mt.GA)(t.spatialReference)),function(t,e,i,n){n||(n=(0,Wl.a)());const o=(0,p.hZ)(tc.oG.get(),t[1],-t[0]),r=(0,p.hZ)(tc.oG.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=(0,p.hZ)(tc.oG.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),a=tc.oG.get();e.components.forEach((e=>e.vertices.forEach((e=>{let{pos:i}=e;(0,p.hZ)(a,(0,p.Om)(t,i),(0,p.Om)(o,i)),(0,p.jk)(r,r,a),(0,p.T9)(s,s,a)}))));const l=1e-6,c=(0,p.hZ)(tc.oG.get(),s[0]-r[0]<l?i/2:0,s[1]-r[1]<l?i/2:0);return(0,p.Re)(r,r,c),(0,p.WQ)(s,s,c),(0,p.hs)(n.basis1,t,(s[0]-r[0])/2),(0,p.hs)(n.basis2,o,(s[1]-r[1])/2),(0,p.hZ)(n.origin,r[0]*t[0]+r[1]*o[0],r[0]*t[1]+r[1]*o[1]),(0,p.WQ)(n.origin,n.origin,n.basis1),(0,p.WQ)(n.origin,n.origin,n.basis2),(0,Wl.u)(n),n}(n,e,o,this._planeCache)}get _displayPlane(){const t=this._plane;if(!t)return null;const e=this._displayPlaneCache;(0,Wl.c)(t,e);const i=10*this.view.resolution;return(0,k.h)(e.basis1,e.basis1,1+i/(0,k.l)(e.basis1)),(0,k.h)(e.basis2,e.basis2,1+i/(0,k.l)(e.basis2)),e}get _backgroundGraphicGeometry(){const t=this._displayPlane;if(!t)return null;const e=this.view.spatialReference;return this._updateDisplayPlaneConrers(t),new Tt.A({spatialReference:e,rings:[[this._cornerA,this._cornerB,this._cornerC,this._cornerD,this._cornerA]]})}get _rotateGraphicGeometry(){const t=this._plane;if(!t)return null;const e=this._rotationHandleCache;return(0,k.n)(e,t.basis1),(0,k.h)(e,e,30*this.view.resolution),(0,k.g)(e,e,t.origin),(0,k.g)(e,e,t.basis1),new z.A({x:e[0],y:e[1],spatialReference:this.view.spatialReference})}get _scaleGraphicGeometries(){const t=this._displayPlane;if(!t)return[];const e=this.view.spatialReference;this._updateDisplayPlaneConrers(t);const{_cornerA:i,_cornerB:n,_cornerC:o,_cornerD:r}=this,s=(0,k.m)(this._avgAB,i,n,.5),a=(0,k.m)(this._avgBC,n,o,.5),l=(0,k.m)(this._avgCD,o,r,.5),c=(0,k.m)(this._avgDA,r,i,.5);return[new z.A({x:i[0],y:i[1],spatialReference:e}),new z.A({x:n[0],y:n[1],spatialReference:e}),new z.A({x:o[0],y:o[1],spatialReference:e}),new z.A({x:r[0],y:r[1],spatialReference:e}),new z.A({x:s[0],y:s[1],spatialReference:e}),new z.A({x:a[0],y:a[1],spatialReference:e}),new z.A({x:l[0],y:l[1],spatialReference:e}),new z.A({x:c[0],y:c[1],spatialReference:e})]}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){return this._editGeometryOperations.canUndo}canRedo(){return this._editGeometryOperations.canRedo}undo(){this._editGeometryOperations.undo(),this.updateGraphics()}redo(){this._editGeometryOperations.redo(),this.updateGraphics()}refresh(){const{view:t,target:e}=this,i="georeference"in e?e.georeference.coords:e.geometry,n=this._editGeometryOperations,o=n.data.components[0].vertices,r=Oa.fromGeometry((0,Ca.project)(i,t.spatialReference),ma.RT.Local).components[0].vertices;o.forEach(((t,e)=>{n.setVertexPosition(t,r[e].pos)})),this.updateGraphics()}reset(){const{target:t}=this;if("georeference"in t){const e=t.georeference;"control-points"===e.type&&(e.controlPoints=this._initialControlPoints)}else t.geometry=this._initialGeometry;this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const t=this._editGeometryOperations.data.geometry;"georeference"in this.target&&(this.target.georeference.coords=t),this._graphic.geometry=t,this._backgroundGraphic.geometry=this._backgroundGraphicGeometry,this._rotateGraphic.geometry=this._rotateGraphicGeometry,this._scaleGraphicGeometries.forEach(((t,e)=>{this._scaleGraphics[e].geometry=t}))}setSharedUndoStack(t){this._sharedUndoStack=t}setSharedRedoStack(t){this._sharedRedoStack=t}async _initialize(){const{view:t,target:e}=this;if("georeference"in e){const t=e.georeference;this._graphic=new r.default({geometry:t.coords}),this._initialControlPoints="control-points"===t.type?t.controlPoints:null}else this._graphic=e,this._initialGeometry=e.geometry;t.map.addMany([this._graphicsLayer]),t.focus(),this.visible=!1,this.finishToolCreation(),await this._loadProjectionEngine(),this._editGeometryOperations=ol.fromGeometry((0,Ca.project)(this._graphic.geometry,t.spatialReference),ma.RT.Local),this._backgroundGraphic=new r.default({symbol:new cc.A({color:"transparent",outline:{type:"simple-line",color:t.effectiveTheme.accentColor,width:2}}),geometry:this._backgroundGraphicGeometry}),this._rotateGraphic=new r.default({symbol:new H.A({color:(0,jl.bJ)(t.effectiveTheme.accentColor),outline:{type:"simple-line",color:t.effectiveTheme.accentColor,width:1}}),geometry:this._rotateGraphicGeometry}),this._scaleGraphics=this._scaleGraphicGeometries.map((e=>new r.default({symbol:new H.A({size:6,style:"square",color:(0,jl.bJ)(t.effectiveTheme.accentColor),outline:{type:"simple-line",color:t.effectiveTheme.accentColor,width:1}}),geometry:e}))),this._graphicsLayer.graphics.addMany([this._backgroundGraphic,this._rotateGraphic,...this._scaleGraphics]),this._dragManipulation=new Gl({tool:this,view:t,graphic:this._graphic}),this._rotateManipulation=new nc({tool:this,view:t,graphic:this._rotateGraphic,snapRotation:this._snapRotation}),this._scaleManipulations=this._scaleGraphics.map(((e,i)=>new sc({tool:this,view:t,graphic:e,direction:hc[i],preserveAspectRatio:this._preserveAspectRatio}))),this.addHandles([this._dragManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)),this._rotateManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)),...this._scaleManipulations.map((t=>t.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)))),(0,l.watch)((()=>this.view.scale),(()=>this.active?this.updateGraphics():null)),t.on("click",(async i=>{if(null!=t.activeTool&&t.activeTool!==this)return;const n=(0,lc.ZV)(i),o=[];t.map.allLayers.forEach((t=>{"vector-tile"!==t.type&&"imagery"!==t.type||o.push(t)}));const r=await this.view.hitTest(n,{exclude:o}),s=r.results;if(0===s.length)t.activeTool=null;else{const i=function(t){return t.find(ac)??null}(r.results),n="georeference"in e,o=s.map((t=>"media"===t.type?t.element:null)).filter(Boolean),a=new Set([...this._graphicsLayer.graphics,n?null:e].filter(Boolean));n&&o.includes(e)||null!=i&&a.has(i.graphic)?null==t.activeTool&&(t.activeTool=this):t.activeTool=null}}))]);const i=t=>{this.addHandles(t.events.on("grab-changed",(t=>{"georeference"in e&&("start"===t.action?e.opacity*=.5:"end"===t.action&&(e.opacity*=2))})))};this._dragManipulation.forEachManipulator(i),this._rotateManipulation.forEachManipulator(i),this._scaleManipulations.forEach((t=>t.forEachManipulator(i)));const n=new Zn;n.addToggle(Rn.preserveAspectRatio,(()=>{null==this.preserveAspectRatio&&(this._preserveAspectRatio.enabled=!this._preserveAspectRatio.enabled)})),n.addToggle(Rn.rotateIncrements,(()=>{null==this.snapRotation&&(this._snapRotation.enabled=!this._snapRotation.enabled)})),n.add(Rn.toggleOpacity,(()=>{"georeference"in e&&(e.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled)})),n.addToggle(Rn.factorModifier,(t=>this._factor="key-down"===t.type?10:1)),n.add(Rn.scaleUp,(()=>this._scale(this._factor))),n.add(Rn.scaleDown,(()=>this._scale(-this._factor))),n.add(Rn.moveUp,(()=>this._move(0,this._factor))),n.add(Rn.moveDown,(()=>this._move(0,-this._factor))),n.add(Rn.moveLeft,(()=>this._move(-this._factor,0))),n.add(Rn.moveRight,(()=>this._move(this._factor,0))),this.addHandles([t.on("key-down",(e=>{t.activeTool===this&&n.dispatch(t.inputManager,e)})),t.on("key-up",(e=>{t.activeTool===this&&n.dispatch(t.inputManager,e)}))])}async _loadProjectionEngine(){const t=this._graphic.geometry;return(0,Ca.initializeProjection)(t.spatialReference,this.view.spatialReference)}_updateDisplayPlaneConrers(t){const{basis1:e,basis2:i,origin:n}=t,o=this._cornerA;(0,k.g)(o,n,e),(0,k.g)(o,o,i);const r=this._cornerB;(0,k.g)(r,n,e),(0,k.d)(r,r,i);const s=this._cornerC;(0,k.d)(s,n,e),(0,k.d)(s,s,i);const a=this._cornerD;(0,k.d)(a,n,e),(0,k.g)(a,a,i)}_getInfo(){return{editGeometryOperations:this._editGeometryOperations,plane:this._plane,displayPlane:this._displayPlane}}_updateGraphics(t,e){"start"===t.action&&(this._sharedUndoStack.push({tool:this,operation:e}),this._sharedRedoStack.length=0),this.updateGraphics()}_scale(t){const e=this._editGeometryOperations,i=e.data.geometry.extent?.width,n=(i+t*this.view.resolution)/i,o=e.scale(this._plane.origin,f.Cw,n,n,Sa.NEW_STEP,Pa.REPLACE);this._sharedUndoStack.push({tool:this,operation:o}),this._sharedRedoStack.length=0,this.updateGraphics()}_move(t,e){const i=this._editGeometryOperations.move(t*this.view.resolution,e*this.view.resolution,0,Sa.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:i}),this._sharedRedoStack.length=0,this.updateGraphics()}};(0,o._)([(0,c.MZ)()],uc.prototype,"_plane",null),(0,o._)([(0,c.MZ)()],uc.prototype,"_backgroundGraphicGeometry",null),(0,o._)([(0,c.MZ)()],uc.prototype,"_rotateGraphicGeometry",null),(0,o._)([(0,c.MZ)()],uc.prototype,"_scaleGraphicGeometries",null),(0,o._)([(0,c.MZ)()],uc.prototype,"preserveAspectRatio",void 0),(0,o._)([(0,c.MZ)()],uc.prototype,"snapRotation",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0,nonNullable:!0})],uc.prototype,"target",void 0),(0,o._)([(0,c.MZ)({readOnly:!0})],uc.prototype,"type",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0})],uc.prototype,"view",void 0),uc=(0,o._)([(0,h.$)("esri.views.2d.interactive.editingTools.TransformTool")],uc);const dc="r",pc="z";let fc=class extends X.A{constructor(t){super(t),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=[],this._sharedRedoStack=[],this._originalOpacity=null,this.activeHandle=0}initialize(){const{view:t,mediaElement:e,preserveAspectRatio:i,snapRotation:n,advancedMode:o}=this;this._originalOpacity=e.opacity,this._transformTool=new uc({target:e,view:t,preserveAspectRatio:i,snapRotation:n}),this._controlPointsTransformTool=new Kl({mediaElement:e,view:t}),this._advancedModeTransformTool=new Kl({mediaElement:o.mediaElement,view:o.view}),this._transformTool.setSharedUndoStack(this._sharedUndoStack),this._transformTool.setSharedRedoStack(this._sharedRedoStack),this._controlPointsTransformTool.setSharedUndoStack(this._sharedUndoStack),this._controlPointsTransformTool.setSharedRedoStack(this._sharedRedoStack),this._advancedModeTransformTool.setSharedUndoStack(this._sharedUndoStack),this._advancedModeTransformTool.setSharedRedoStack(this._sharedRedoStack);const r=e.georeference,s=o.mediaElement.georeference;o.view.tools.addMany([this._advancedModeTransformTool]),"controlPoints"in s&&"controlPoints"in r&&this.addHandles([o.view.on("key-down",(t=>{t.key===pc&&this.canUndo()&&(this.undo(),t.stopPropagation()),t.key===dc&&this.canRedo()&&(this.redo(),t.stopPropagation())})),o.view.on("focus",(async t=>{this._controlPointsTransformTool.removeHighlightActiveHandle(),this._advancedModeTransformTool.highlightActiveHandle()})),(0,l.watch)((()=>s.controlPoints),(t=>{r.controlPoints=t.map(((t,e)=>{let{sourcePoint:i}=t;return{sourcePoint:i,mapPoint:r.controlPoints[e].mapPoint}})),this._activeTool?.refresh()})),(0,l.watch)((()=>this._controlPointsTransformTool.activeHandle),(t=>{this._advancedModeTransformTool.updateActiveHandle(t),this.activeHandle=t})),(0,l.watch)((()=>this._advancedModeTransformTool.activeHandle),(t=>{this._controlPointsTransformTool.updateActiveHandle(t),this.activeHandle=t}))]),this.addHandles([t.on("key-down",(t=>{t.key===pc&&this.canUndo()&&(this.undo(),t.stopPropagation()),t.key===dc&&this.canRedo()&&(this.redo(),t.stopPropagation())})),t.on("focus",(async t=>{this._advancedModeTransformTool.removeHighlightActiveHandle(),this._controlPointsTransformTool.highlightActiveHandle()}))]),t.tools.addMany([this._transformTool,this._controlPointsTransformTool]),t.activeTool=this._transformTool,this._activeTool=this._transformTool,t.focus()}destroy(){this._transformTool?.destroy(),this._controlPointsTransformTool?.destroy(),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=null,this._sharedRedoStack=null}canUndo(){return this._sharedUndoStack.length>0}canRedo(){return this._sharedRedoStack.length>0}undo(){if(this._sharedUndoStack.length>0){const{tool:t,operation:e}=this._sharedUndoStack.pop();t!==this._activeTool&&t.refresh(),e.undo(),t.updateGraphics(),this._sharedRedoStack.push({tool:t,operation:e}),this._activeTool!==t&&this._activeTool?.refresh()}}redo(){if(this._sharedRedoStack.length>0){const{tool:t,operation:e}=this._sharedRedoStack.pop();t!==this._activeTool&&t.refresh(),e.apply(),t.updateGraphics(),this._sharedUndoStack.push({tool:t,operation:e}),this._activeTool!==t&&this._activeTool?.refresh()}}refresh(){this._activeTool.refresh()}reset(){this._activeTool.reset(),this._advancedModeTransformTool.reset()}async enableAdvancedMode(){this.view.activeTool=this._controlPointsTransformTool,this._activeTool=this._controlPointsTransformTool,this._activeTool.refresh(),await this.advancedMode.view.when(),this.advancedMode.view.activeTool=this._advancedModeTransformTool,this._originalOpacity=this._controlPointsTransformTool.mediaElement.opacity,this._controlPointsTransformTool.mediaElement.opacity=.25*this._originalOpacity}disableAdvancedMode(){this.view.activeTool=this._transformTool,this._activeTool=this._transformTool,this._activeTool.refresh(),this.advancedMode.view.activeTool=null,this._controlPointsTransformTool.mediaElement.opacity=this._originalOpacity}};(0,o._)([(0,c.MZ)()],fc.prototype,"activeHandle",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0})],fc.prototype,"advancedMode",void 0),(0,o._)([(0,c.MZ)()],fc.prototype,"preserveAspectRatio",void 0),(0,o._)([(0,c.MZ)()],fc.prototype,"snapRotation",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0,nonNullable:!0})],fc.prototype,"mediaElement",void 0),(0,o._)([(0,c.MZ)({constructOnly:!0})],fc.prototype,"view",void 0),fc=(0,o._)([(0,h.$)("esri.views.2d.interactive.editingTools.MediaTransformToolsWrapper")],fc)},55754:(t,e,i)=>{i.d(e,{V:()=>s,t:()=>a});i(35238);var n=i(31633),o=i(4955),r=i(76797);function s(t,e,i){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new r.A,s=0;if("2d"===i.type)s=e*(i.resolution??0);else if("3d"===i.type){const o=i.overlayPixelSizeInMapUnits(t),r=i.basemapSpatialReference;s=null==r||r.equals(i.spatialReference)?e*o:(0,n.GA)(r)/(0,n.GA)(i.spatialReference)}const a=t.x-s,l=t.y-s,c=t.x+s,h=t.y+s,{spatialReference:u}=i;return o.xmin=Math.min(a,c),o.ymin=Math.min(l,h),o.xmax=Math.max(a,c),o.ymax=Math.max(l,h),o.spatialReference=u,o}function a(t,e,i){const n=i.toMap(t);return null!=n&&s(n,(0,o.o)(),i,l).intersects(e)}const l=new r.A}}]);
//# sourceMappingURL=52279.3a873149.chunk.js.map